
# Configuring PTP

## About PTP

Precision Time
Protocol (PTP) provides time synchronization among devices with submicrosecond
accuracy. It provides also precise frequency synchronization.

### Basic concepts

#### PTP profile

PTP profiles (PTP standards) include:

·     IEEE 1588 version 2—1588v2 defines high-accuracy clock synchronization mechanisms. It
can be customized, enhanced, or tailored as needed. 1588v2 is the latest
version.

·      

·     SMPTE ST 2059-2—ST2059-2 is introduced based on IEEE 1588\. It specifies a profile
specifically for time synchronization of audio or video equipment in a
professional broadcast environment. It includes a self-contained description of
parameters, their default values, and permitted ranges.

#### PTP domain

A PTP domain refers to a network or part of
a network that is enabled with PTP. A PTP domain has only one reference clock called
"grandmaster clock (GM)." All devices in the domain synchronize to
the clock.

#### Clock node and PTP port

A node in a PTP domain is a clock node. A
port enabled with PTP is a PTP port. PTP defines the following types of basic
clock nodes:

·     Ordinary Clock (OC)—A PTP clock with a single PTP port in a PTP domain for time
synchronization. It synchronizes time from its upstream clock node through the
port. If an OC operates as the clock source, it sends synchronization time
through a single PTP port to its downstream clock nodes.

·     Boundary Clock (BC)—A clock with more than one PTP port in a PTP domain for time
synchronization. A BC uses one of the ports to synchronize time from its
upstream clock node. It uses the other ports to synchronize time to the
relevant upstream clock nodes. If a BC operates as the clock source, such as BC
1 in [Figure 1](#_Ref269226259), it synchronizes
time through multiple PTP ports to its downstream clock nodes.

·     Transparent Clock (TC)—A TC does not keep time consistency with other clock nodes. A TC
has multiple PTP ports. It forwards PTP messages among these ports and performs
delay corrections for the messages, instead of performing time synchronization.
TCs include the following types:

¡     End-to-End Transparent Clock (E2ETC)—Forwards
all PTP packets in the network and supports calculation of the delay on the
entire link.

¡     Peer-to-Peer Transparent Clock (P2PTC)—Forwards only Sync, Follow\_Up, and Announce messages, terminates
other PTP messages, and supports calculation of the delay on the entire link.

[Figure 1](#_Ref269226259)
shows the positions of these types of clock nodes in a PTP domain.

Figure 1 Clock nodes in a PTP domain

![](https://resource.h3c.com/en/202407/12/20240712_11705721_x_Img_x_png_0_2216111_294551_0.png)

‌

In addition to these basic types of clock
nodes, PTP introduces hybrid clock nodes. For example, a TC\+OC has multiple PTP
ports in a PTP domain. One port is the OC type, and the others are the TC type.

A TC\+OC forwards PTP messages through
TC-type ports and performs delay corrections. In addition, it synchronizes time
through its OC-type port. TC\+OCs include these types: E2ETC\+OC and P2PTC\+OC. 

#### Master-member/subordinate relationship

The master-member/subordinate relationship
is automatically determined based on the Best Master Clock (BMC) algorithm. You
can also manually specify a role for the clock nodes.

The master-member/subordinate relationship
is defined as follows:

·     Master/Member node—A master node sends a synchronization message, and a member node
receives the synchronization message.

·     Master/Member clock—The clock on a master node is a master clock (parent clock) The
clock on a member node is a member clock.

·     Master/Subordinate port—A master port sends a synchronization message, and a subordinate
port receives the synchronization message. The master and subordinate ports can
be on a BC or an OC.

A port that neither receives nor sends
synchronization messages is a passive port.

#### Clock source type

A clock node supports the following clock
sources:

·     Local clock source—38.88 MHz clock signals generated by a crystal oscillator inside
the clock monitoring module.

·     External clock source—Clock signals generated by an external clock device. The signals
are received and sent by a 1PPS/ToD port on the device. It is also called a ToD
clock source.

#### Grandmaster clock

As shown in [Figure 1](#_Ref269226259), the
grandmaster clock (GM) is the ultimate source of time for clock synchronization
in a PTP domain. It is elected automatically by the clock nodes in the PTP
domain. The clock nodes exchange PTP messages and elect the GM by comparing the
clock priority, time class, and time accuracy carried in the PTP messages.

You can also specify a GM manually.

#### Clock source

The clock source used by clock nodes is 38.88
MHz clock signals generated by a crystal oscillator inside the clock monitoring
module of the device. 

### Grandmaster clock selection and master-member/subordinate relationship establishment

A GM can be manually specified. It can also
be elected through the BMC algorithm as follows:

**1\.**The clock nodes in a PTP domain exchange
announce messages and elect a GM by using the following rules in descending
order:

**a.**Clock node with higher priority 1\.

**b.**Clock node with higher time class.

**c.**Clock node with higher time accuracy.

**d.**Clock node with higher priority 2\.

**e.**Clock node with a smaller port ID
(containing clock number and port number).

The master nodes, member nodes, master
ports, and subordinate ports are determined during the process. Then a spanning
tree with the GM as the root is generated for the PTP domain.

**2\.**The master node periodically sends announce
messages to the member nodes. If the member nodes do not receive announce
messages from the master node, they determine that the master node is invalid,
and they start to elect another GM.

### Synchronization mechanism

After master-member relationships are
established between the clock nodes, the master and member clock nodes exchange
PTP messages and record the message transmit and receive time. Based on the
timestamps, each member clock calculates the path delay and time offset between
them and the master clock and adjusts their time accordingly for time
synchronization with the master clock.

PTP defines two path delay measurement
mechanisms: Request\_Response\_ and Peer Delay, both of which are based on network
symmetry.

#### Request\_Response

The Request\_Response mechanism measures the
average path delay between the master and member clock nodes by using the PTP messages
as shown in [Figure 2](#_Ref44169804). A
TC between master and member clock nodes does not calculate the path delay. It
forwards PTP messages and carries the Sync message residence time on it to the downstream
clock node.

This mechanism can be implemented in one of
the following two modes:

·     Two-step mode—t1 is carried in the Follow\_Up message as shown in [Figure 2](#_Ref44169804).

·     Single-step mode—t1 is carried in the Sync message, and no Follow\_Up message is
sent. 

[Figure 2](#_Ref44169804)
shows the Request\_Response mechanism in two-step mode.

**1\.**The master clock sends a Sync message to the
member clock, and records the sending time t1. Upon receiving the message, the
member clock records the receiving time t2.

**2\.**After sending the Sync message, the master
clock immediately sends a Follow\_Up message that carries time t1.

**3\.**The member clock sends a Delay\_Req message
to the master clock, and records the sending time t3. Upon receiving the
message, the master clock records the receiving time t4.

**4\.**The master clock returns a Delay\_Resp
message that carries time t4.

After this procedure, the member clock obtains
all the four timestamps and can make the following calculations:

·     Round-trip delay between the master and member
clocks:
(t2 – t1) \+ (t4 – t3)

·     One-way delay between the
master and member clocks: \[(t2 – t1) \+ (t4 – t3)] / 2

·     Offset between the member and master clocks: (t2
– t1) – \[(t2 – t1) \+ (t4 – t3)] / 2 or \[(t2 – t1) – (t4 – t3)] / 2

Figure 2 Request\_Response mechanism
(two-step node)

![](https://resource.h3c.com/en/202407/12/20240712_11705722_x_Img_x_png_1_2216111_294551_0.png)

 

#### Peer Delay

The Peer Delay mechanism measures the
average path delay between two clock nodes. The two clock nodes (BC, TC, or OC)
implementing this mechanism send Pdelay messages to each other, and calculate
the one-way link delay between them independently. The message interaction process
and delay calculation method are identical on the two nodes. TCs that exist
between master and member clock nodes divide the synchronization path into
multiple links and participate in delay calculation. The link delays and Sync
message residence time on the TCs are carried to downstream nodes.

This mechanism can be implemented in one of
the following two modes:

·     Two-step mode

As shown in [Figure 3](#_Ref44172452), Pdelay
messages include Pdelay\_Req, Pdelay\_Resp, and Pdelay\_Resp\_Follow\_Up messages.
t2 is carried in the Pdelay\_Resp message, and t3 is carried in the Pdelay\_Resp\_Follow\_Up
message.

·     Single-step mode:

Pdelay messages include Pdelay\_Req and
Pdelay\_Resp messages. t3 – t2 is carried in the Pdelay\_Resp, and no Pdelay\_Resp\_Follow\_Up
message is sent.

[Figure 3](#_Ref44172452) uses Clock
node B as an example to describe the Peer Delay mechanism.

**1\.**Clock node B sends a Pdelay\_Req message to
Clock node A, and records the sending time t1. Upon receiving the message,
Clock node A records the receiving time t2.

**2\.**Clock node A sends a Pdelay\_Req message that
carries t2 to Clock node B, and records the sending time t3. Upon receiving the
message, Clock node B records the receiving time t4.

**3\.**Clock node A immediately sends a Pdelay\_Resp\_Follow\_Up
message carrying t3 to Clock node B after sending the Pdelay\_Req message.

After this procedure, Clock node B obtains all
the four timestamps and can make the following calculations:

·     Round-trip
delay between Clock node A and Clock node B: (t2
– t1) \+ (t4 – t3)

·     One-way delay between Clock node A and
Clock node B: \[(t2
– t1) \+ (t4 – t3)]
/ 2 \= \[(t4 – t1) – (t3 – t2)] / 2

·     Time
offset between the member clock and the master clock: Sync message receiving
time on the member clock – Sync message
sending time on the master clock – Total one-way delays on all
links – Total Sync
message residence time on all TCs.

Figure 3 Peer Delay mechanism (two-step
mode)

![](https://resource.h3c.com/en/202407/12/20240712_11705724_x_Img_x_png_2_2216111_294551_0.png)

‌

### Protocols and standards

·     IEEE Std 1588-2008, IEEE
Standard for a Precision Clock Synchronization Protocol for Networked
Measurement and Control Systems, 2008

·     SMPTE ST 2059-2, SMPTE
Profile for Use of IEEE-1588 Precision Time Protocol in Professional Broadcast
Applications

## Restrictions and guidelines: PTP configuration

Before configuring PTP, determine the PTP
profile and define the scope of the PTP domain and the role of every clock
node.

In a PTP domain that runs the 1588 version
2 PTP profile, specify the BC or OC clock node type for the devices in the
domain as a best practice. A TC clock node is mainly used for forwarding PTP
messages. When receiving a PTP message, a TC multicasts the message from all
its PTP interfaces except the inbound interface of the PTP message. To deploy a
TC in the domain, plan the TC location and number and location of PTP
interfaces on the TC manually to prevent PTP forwarding loops.

## PTP tasks at a glance

### Configuring PTP (IEEE 1588 version 2\)

**1\.**[Specifying PTP for obtaining the time](#_Ref535328741)

**2\.**[Specifying a PTP profile](#_Ref535328902)

Specify the IEEE 1588 version 2 PTP
profile.

**3\.**[Configuring clock nodes](#_Ref462933011)

¡     [Specifying a clock node type](#_Ref462933070)

¡     (Optional.) [Configuring an OC to operate only as a
member clock](#_Ref462933073)

**4\.**[Specifying a PTP domain](#_Ref516249095)

**5\.**Enabling PTP.

For PTP to run on an interface, enable PTP globally and on
the interface.

¡     [Enabling PTP globally](#_Ref43474540)

¡     [Enabling PTP on a port](#_Ref476663272)

**6\.**[Configuring PTP ports](#_Ref462933207)

¡     (Optional.)
[Configuring the role of a PTP port](#_Ref462933218)

¡     [Configuring the mode for carrying
timestamps](#_Ref359242289)

¡     [Specifying a delay measurement mechanism
for a BC or an OC](#_Ref269463061)

¡     [Configuring one of the ports on a TC\+OC
clock as an OC-type port](#_Ref269471091)

**7\.**(Optional.) [Configuring PTP message transmission and
receipt](#_Ref476664179)

¡     [Setting the interval for sending
announce messages and the timeout multiplier for receiving announce messages](#_Ref462934073)

¡     [Setting the interval for sending
Pdelay\_Req messages](#_Ref359242291)

¡     [Setting the interval for sending Sync
messages](#_Ref359242292)

¡     [Setting the minimum interval for sending
Delay\_Req messages](#_Ref359242293)

**8\.**(Optional.) [Configuring parameters for PTP messages](#_Ref476663779)

¡     [Specifying the IPv4 UDP transport protocol for PTP messages](#_Ref119910878)

¡     [Configuring a source IP address for
multicast PTP messages transmitted over UDP](#_Ref476853761)

¡     [Configuring a destination IP address for
unicast PTP messages transmitted over UDP](#_Ref476853762)

¡     [Configuring the MAC address for non-Pdelay
messages](#_Ref359242294)

¡     [Setting a DSCP value for PTP messages
transmitted over UDP](#_Ref476900577)

¡     [Specifying a VLAN tag for PTP messages](#_Ref476663801)

**9\.**(Optional.) [Disabling PTP path tracing](#_Ref119910964)

**10\.**(Optional.) [Adjusting and correcting clock
synchronization](#_Ref462933409)

¡     [Setting the delay correction value](#_Ref462933417)

¡     [Calculating the TAI based on the UTC time](#_Ref97368482)

**11\.**(Optional.) [Configuring a priority for a clock](#_Ref463705245)

### Configuring PTP (SMPTE ST 2059-2)

**1\.**[Specifying PTP for obtaining the time](#_Ref535328741)

**2\.**[Specifying a PTP profile](#_Ref535328902)

Specify the SMPTE ST 2059-2 PTP profile.

**3\.**[Configuring clock nodes](#_Ref462933011)

¡     [Specifying a clock node type](#_Ref462933070)

¡     (Optional.)
[Configuring an OC to operate only as a
member clock](#_Ref462933073)

**4\.**(Optional.) [Specifying a PTP domain](#_Ref516249095)

**5\.**Enabling PTP.

For PTP to run on an interface, enable PTP globally and on
the interface.

¡     [Enabling PTP globally](#_Ref43474540)

¡     [Enabling PTP on a port](#_Ref476663272)

**6\.**[Configuring PTP ports](#_Ref462933207)

¡     (Optional.)
[Configuring the role of a PTP port](#_Ref462933218)

¡     [Configuring the mode for carrying
timestamps](#_Ref529376134)

¡     [Specifying a delay measurement mechanism
for a BC or an OC](#_Ref529376170)

**7\.**(Optional.) [Configuring PTP message transmission and
receipt](#_Ref476664179)

¡     [Setting the interval for sending
announce messages and the timeout multiplier for receiving announce messages](#_Ref462934073)

¡     [Setting the interval for sending
Pdelay\_Req messages](#_Ref359242291)

¡     [Setting the interval for sending Sync
messages](#_Ref359242292)

¡     [Setting the minimum interval for sending
Delay\_Req messages](#_Ref529376228)

**8\.**(Optional.) [Configuring parameters for PTP messages](#_Ref476663779)

¡     [Configuring a source IP address for
multicast PTP messages transmitted over UDP](#_Ref476853761)

¡     [Configuring a destination IP address for
unicast PTP messages transmitted over UDP](#_Ref476853762)

¡     [Setting a DSCP value for PTP messages
transmitted over UDP](#_Ref476900577)

¡     [Specifying a VLAN tag for PTP messages](#_Ref476663801)

**9\.**(Optional.) [Disabling PTP path tracing](#_Ref119910964)

**10\.**(Optional.) [Adjusting and correcting clock
synchronization](#_Ref462933409)

¡     [Setting the delay correction value](#_Ref462933417)

¡     [Calculating the TAI based on the UTC time](#_Ref97368482)

**11\.**(Optional.) [Configuring a priority for a clock](#_Ref463705245)

## Specifying PTP for obtaining the time

**1\.**Enter system view.

system-view

**2\.**Specify PTP for obtaining the time.

clock protocol ptp

By default, the device uses NTP to obtain
the system time.

For more information about the clock protocol command, see device management commands in Fundamentals
Command Reference.

## Specifying a PTPprofile

#### Restrictions and guidelines

You must specify a PTP profile before
configuring PTP settings. Changing the PTP profile clears all settings under
the profile.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Specify a PTP profile.

ptp profile { 1588v2 \| st2059-2 }

By default, no PTP profile is configured,
and PTP is not running on the device.

## Configuring clock nodes

### Specifying a clock node type

#### Restrictions and guidelines

Before you specify a clock node type,
specify a PTP profile.

Changing or removing the clock node type
restores the default settings of the PTP profile.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Specify a clock node type for the device.

IEEE 1588v2 PTP profile:

ptp mode { bc \| e2etc \| e2etc-oc \| oc \| p2ptc \| p2ptc-oc }

SMPTE ST 2059-2 PTP profile:

ptp mode { bc \| e2etc \| oc \| p2ptc }

By default, no clock node type is
specified.

### Configuring an OC to operate only as amember clock

#### About this task

An OC can operate either as a master clock
to send synchronization messages or as a member clock to receive
synchronization messages. This task allows you to configure an OC to operate only
as a member clock.

If an OC is operating only as a member
clock, you can use the ptp force-state command
to configure its PTP port as a master port or passive port.

#### Restrictions and guidelines

This task is applicable only to OCs.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Configure the OC to operate only as a member
clock.

ptp slave-only

By default, an OC operates as a master or
member clock.

## Specifying a PTP domain

#### About this task

Within a PTP domain, all devices follow the
same rules to communicate with each other. Devices in different PTP domains
cannot exchange PTP messages.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Specify a PTP domain for the device.

ptp domain value

By default, no PTP domain exists.

Do not configure the same domain on different
PTP instances.

## Enabling PTP globally

#### Restrictions and guidelines

For PTP to run on an interface, you must
enable PTP globally and on the interface.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enable PTP globally.

ptp global enable

By default, PTP is enabled globally.

## Enabling PTP on a port

#### About this task

A port enabled with PTP becomes a PTP port.

#### Restrictions and guidelines

You can enable PTP on only one port on an
OC.

To enable PTP on a Layer 3 Ethernet
interface that has been assigned to a VPN instance, you must specify this VPN
instance in the ptp source ip-address vpn-instance vpn-instance-name command
if PTP messages are to be transmitted in multicast mode over IPv4 UDP.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Enable PTP on the port.

ptp enable

By default, PTP is disabled on a port.

## Configuring PTP ports

### Configuring the role of a PTP port

#### About this task

You can configure the master, passive, or
slave role for a PTP port.

For an OC that operates in slave-only mode, you can perform this task to change its PTP port role to
master or slave.

#### Restrictions and guidelines

You can configure one subordinate port on
the device.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Configure the role of the PTP port.

ptp force-state { master \| passive \| slave }

By default, the PTP port role is
automatically calculated through BMC.

**4\.**Return to system view.

quit

**5\.**Activate the port role configuration.

ptp active force-state

By default, the port role configuration
is not activated.

### Configuring the mode for carrying timestamps

#### About this task

Timestamps can be carried in either of the
following modes:

·     Single-step mode—The Sync message (in the Request\_Response or Peer Delay mechanism)
and Pdelay\_Resp message (in the Peer Delay mechanism) carry their sending
timestamps by themselves.

·     Two-step mode—The Sync message (in the Request\_Response or Peer Delay mechanism)
and Pdelay\_Resp message (in the Peer Delay mechanism) do not carry their
sending timestamps by themselves. The subsequent messages carry their sending
timestamps.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Configure the mode for carrying timestamps.

ptp clock-step { one-step \| two-step }

By default, the two-step mode is used for
carrying  timestamps. 

### Specifying a delay measurement mechanism for a BC or an OC

#### About this task

PTP defines two transmission delay
measurement mechanisms: Request\_Response and Peer Delay. For correct
communication, ports on the same link must share the same delay measurement
mechanism.

#### Restrictions and guidelines

The device supports the  IEEE 1588 version
2 and SMPTE ST 2059-2 PTP profiles. After you specify the IEEE 1588 version 2
or SMPTE ST 2059-2 PTP profile, you can configure this task only for a BC or OC
clock node. The E2ETC, E2ETC\+OC, P2PTC, and P2PTC\+OC clock nodes do not support
this task. The E2ETC and E2ETC\+OC clock nodes support both the request-response
and peer delay measurement mechanisms. The P2PTC clock node supports only the
peer delay measurement mechanism.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Specify a delay measurement mechanism for a
BC or an OC.

ptp delay-mechanism { e2e \| p2p }

When the PTP profile is IEEE 1588 version 2 or SMPTE ST 2059-2, the request-response delay measurement mechanism applies.

### Configuring one of the ports on a TC\+OC clock as an OC-type port

#### About this task

All ports on a TC\+OC (E2ETC\+OC or P2PTC\+OC)
are TC-type ports by default. This feature allows you to configure one of the
ports on a TC\+OC clock as an OC-type port.

#### Restrictions and guidelines

This task is applicable only to E2ETC\+OCs
and P2PTC\+OCs.

This task is not available for an SMPTE ST
2059-2 PTP profile.

For time synchronization accuracy, the
OC-type port on an E2ETC\+OC or P2PTC\+OC must be specified as the master port.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Configure the port type as OC.

ptp port-mode oc

By default, the port type for all ports
on a TC\+OC is TC.

## Configuring PTP message transmission and receipt

### Setting the interval for sending announce messages and the timeout multiplier for receiving announce messages

#### About this task

A master node sends announce messages to
the member nodes at the specified interval. If a member node does not receive
any announce messages from the master node within the specified timeout, it determines
that the master node is invalid. The timeout \= timeout multiplier × interval at
which the master node sends announce messages.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Set the interval for sending announce
messages.

ptp announce-interval interval

The
default settings vary by PTP profile.

¡     IEEE 1588 version 2—The interval argument value is 1 and the interval for sending announce messages
is 2 (21) seconds.

¡     SMPTE ST 2059-2—The interval argument value is –2 and the interval for sending announce messages
is 1/4 (2-2) seconds.

**4\.**Set the number of intervals before a timeout
occurs.

ptp announce-timeout multiple-value

By default, a timeout occurs when three
intervals are reached.

### Setting the interval for sending Pdelay\_Req messages

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Set the interval for sending Pdelay\_Req
messages.

ptp pdelay-req-interval interval

By default, the interval argument value is 0 and the interval for sending peer delay request
messages is 1 (20) second.

For the SMPTE ST 2059-2 PTP profile, set
the interval argument to a value in the range of ptp
syn-interval interval to ptp syn-interval interval plus 5 as a best practice. 

### Setting the interval for sending Sync messages

#### About this task

The master node sends Sync messages to the
member nodes periodically. You can configure the interval for sending Sync
messages on the master node.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Set the interval for sending Sync messages.

ptp syn-interval interval

The default settings vary by PTP profile.

¡     IEEE 1588 version 2—The interval argument value is 0 and the interval for sending Sync messages is 1
(20) second.

¡     SMPTE ST 2059-2—The interval argument value is –3 and the interval for sending Sync messages is
1/8 (2-3) seconds.

### Setting the minimum interval for sending Delay\_Req messages

#### About this task

When receiving a Sync or Follow\_Up message,
an interface can send Delay\_Req messages only when the minimum interval is
reached. This task allows you to set the minimum interval for sending Delay\_Req
messages.

#### Restrictions and guidelines

In PTP multicast transport mode, this setting
takes effect only when configured on the master clock. The master clock sends
the value to a member clock through PTP messages to control the interval for
the member clock to send Delay\_Req messages. To view the interval, execute the display ptp
interface command on the member clock.

In PTP unicast transport mode, this setting
takes effect when configured on member clocks. It does not take effect when
configured on the master clock.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Set the minimum interval for sending
Delay\_Req messages.

ptp min-delayreq-interval interval

The interval argument
value is 0 and the minimum interval for sending delay request messages is 1 (20) second.

For the SMPTE ST 2059-2 PTP profile, set
the interval argument to a value in the range of ptp syn-interval interval to ptp syn-interval interval plus 5 as a
best practice.

## Configuring parameters for PTP messages

### Specifying the IPv4 UDP transport protocol for PTP messages

#### About this task

PTP messages can be transported over IEEE
802.3/Ethernet or IPv4 UDP.

#### Restrictions and guidelines

For the SMPTE ST 2059-2 PTP profile, PTP
messages can be encapsulated only in UDP packets. 

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Specify the IPv4 UDP transport protocol for
PTP messages.

ptp transport-protocol udp

By default, PTP messages are transported
over IEEE 802.3/Ethernet.

### Configuring a source IP address for multicast PTPmessages transmitted over UDP

#### About this task

To transport multicast PTP messages over
UDP, you must configure a source IP address for the messages.

#### Restrictions and guidelines

If both a source IP address for multicast
PTP messages transmitted over UDP and a destination address for unicast PTP messages
transmitted over UDP are configured, the system unicasts the messages.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Configure a source IP address for multicast
PTP messages transmitted over UDP.

ptp source ip-address \[ vpn-instance vpn-instance-name ] 

By default, no source IP address is configured
for multicast PTP messages transmitted over UDP.

### Configuring a destination IP address forunicast PTP messages transmitted over UDP

#### About this task

To transport unicast PTP messages over UDP,
you must configure a destination IP address for the messages.

#### Restrictions and guidelines

If both a source IP address for multicast
PTP messages transmitted over UDP and a destination address for unicast PTP messages
transmitted over UDP are configured, the system unicasts the messages.

#### Prerequisites

Configure an IP address for the current
interface, and make sure the interface and the peer PTP interface can reach
each other.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Configure a destination IP address for unicast
PTP messages transmitted over UDP.

ptp unicast-destination ip-address

By default, no destination IP address is
configured for unicast PTP messages transmitted over UDP.

### Configuring the MAC address for non-Pdelay messages

#### About this task

Pdelay messages include Pdelay\_Req,
Pdelay\_Resp, and Pdelay\_Resp\_Follow\_Up messages. The destination MAC address of
Pdelay messages is 0180-C200-000E by default, which cannot be modified. The
destination MAC address of non-Pdelay messages is either 0180-C200-000E or
011B-1900-0000.

#### Restrictions and guidelines

This feature takes effect only when PTP
messages are encapsulated in IEEE 802.3/Ethernet packets.

This task is not available for the SMPTE ST
2059-2 PTP profile. 

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

interface interface-type
interface-number

**3\.**Configure the destination MAC address for
non-Pdelay messages.

ptp destination-mac mac-address

The default destination MAC address is 011B-1900-0000.

### Setting a DSCP value for PTP messages transmitted over UDP

#### About this task

The DSCP value determines the sending
precedence of PTP messages
transmitted over UDP.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Set a DSCP value for PTP messages
transmitted over UDP.

ptp dscp dscp

By default, the DSCP value is 56\.

### Specifying a VLAN tag for PTP messages

#### About this task

Perform this task to configure the VLAN ID
and the 802.1p precedence in the VLAN tag carried by PTP messages.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view.

interface interface-type
interface-number

**3\.**Specify a VLAN tag for PTP messages.

ptp vlan vlan-id \[ dot1p dot1p-value ]

By default, PTP messages do not have a
VLAN tag.

### Disabling PTP path tracing

#### About this task

PTP path tracing traces the clock nodes
that the clock signals traverse from the GM to the device. The system can
obtain complete path tracing information only when all clock nodes on the path
are enabled with PTP path tracing. If a device on the path does not support PTP
path tracing, disable this feature to prevent PTP intercommunication issues.

#### Procedure

**1\.**Enter system view.

system-view 

**2\.**Disable PTP path tracing.

ptp path-trace disable

By default, PTP path tracing is enabled.

 

## Adjusting and correcting clock synchronization

### Setting the delay correction value

#### About this task

PTP performs time synchronization based on
the assumption that the delays in sending and receiving messages are the same.
However, this is not practical. If you know the offset between the delays in
sending and receiving messages, you can set the delay correction value for more
accurate time synchronization.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter Layer 2 Ethernet interface view or
Layer 3 Ethernet interface view.

interface interface-type
interface-number

**3\.**Set a delay correction value.

ptp asymmetry-correction { minus \| plus } value

The default is 0 nanoseconds. Delay
correction is not performed.

### Calculating the TAI based on the UTC time

#### About this task

International Atomic Time (TAI) is a
high-precision atomic coordinate time scale. Coordinated Universal Time (UTC)
is based on TAI and adjusted by leap seconds for synchronization with
astronomical time. 

UTC is constantly compared with UT1 (astronomical
time, reflecting the earth's rotation). The International Bureau of Weights and
Measures (BIPM) will notify to add or subtract one second from the UTC time
scale at the last minute on a specific date (typically June 30 or December 31\)
to ensure that the difference between UTC and UT1 is within one second. 

The BIPM publishes the difference between
UTC and TAI periodically. Till now, UTC is 37 seconds behind TAI.

Internet devices typically use the UTC
time. To provide more accurate time, PTP also uses TAI. If the device acts as a
subordinate clock node, it uses the UTC time and TAI time of the clock reference.
If the device acts as the clock reference, it will calculate the TAI time based
on the UTC time, and synchronize the UTC and TAI time to the subordinate clocks.
This task is used to calculate the TAI time based on the UTC time.

TAI \= Current UTC \+ cumulative offset \+ leap
second that might occur in the future. To get the correct TAI time from the UTC
time,

·     Set the accurate UTC time on the device.

·     Use the ptp utc offset command to set the cumulative offset of UTC relative to TAI as
published by BIPM. This command takes effect immediately. 

·     If the BIPM notifies to add or subtract
one second from the UTC time scale on a specific data after you use the ptp utc offset command to configure the cumulative offset of TAI relative to UTC,
use the ptp utc { leap59-date \| leap61-date } date command to change
the UTC time. The TAI time will be changed accordingly.

#### Restrictions and guidelines

This setting takes effect only when it is
configured on the master clock node and the local clock of the master clock
node is the GM.

Configure this feature on both the master
and member nodes for the new master clock to provide accurate TAI time after a
master/member node switchover.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Set the cumulative offset of UTC relative to
TAI.

ptp utc offset utc-offset

The default is 0 seconds.

**3\.**Add or subtract one second from the UTC time
scale at the last minute on the specified date.

ptp utc { leap59-date \| leap61-date } date

By default, no second is added or
subtracted from the UTC time.

## Configuring a priority for a clock

#### About this task

Priorities for clocks are used to elect the
GM. The smaller the priority value, the higher the priority.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Configure the priority for the specified
clock for GM election through BMC.

ptp priority clock-source local { priority1 priority1 \| priority2 priority2 }

The default value varies by PTP profile:

¡     IEEE 1588 version 2 or SMPTE ST 2059-2—The priority 1 and priority 2 values are both 128\.

## Display and maintenance commands for PTP

Execute display
commands in any view and the reset
command in user view.

 

| Task | Command |
| --- | --- |
| Display PTP clock information. | display ptp clock || Display the delay correction history. | display ptp corrections || Display information about foreign master nodes. | display ptp foreign-masters-record \[ interface interface-type interface-number ] || Display PTP information on an interface. | display ptp interface \[ interface-type interface-number ] || Display brief PTP information on all interfaces. | display ptp interface brief || Display brief information about the PTP synchronization path from the GM to the device. | display ptp path-trace || Display parent node information for the PTP device. | display ptp parent || Display historical role change information for PTP ports. | display ptp port-history \[ interface interface-type interface-number ] || Display PTP statistics. | display ptp statistics \[ interface interface-type interface-number ] || Display PTP clock time properties. | display ptp time-property || Clear PTP statistics. | reset ptp statistics \[ interface interface-type interface-number ] |











‌

## PTP configuration examples

### Example: Configuring PTP (IEEE 1588 version 2, IEEE 802.3/Ethernet transport, multicast transmission)

#### Network configuration

As shown in[Figure 4](#_Ref269474845), configure
PTP (IEEE 1588 version 2, IEEE 802.3/Ethernet transport, multicast
transmission) to enable time synchronization between the devices.

·     Specify the IEEE 1588 version 2 PTP profile and
the IEEE 802.3/Ethernet transport protocol for PTP messages on Device A, Device
B, and Device C.

·     Assign Device A, Device B, and Device C to the
same PTP domain. Specify the OC clock node type for Device A and Device C, and E2ETC
clock node type for Device B. All clock nodes elect a GM through BMC in the PTP
domain.

·     Use the default Request\_Response delay
measurement mechanism on Device A and Device C.

Figure 4 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705725_x_Img_x_png_3_2216111_294551_0.png)

‌

#### Procedure

**1\.**Configure Device A:

\# Specify the IEEE 1588 version 2 PTP
profile.

\<DeviceA\> system-view

\[DeviceA] ptp profile 1588v2

\# Specify the OC clock node type.

\[DeviceA] ptp mode oc

\# Create a PTP domain.

\[DeviceA] ptp domain 0

\# Enable PTP globally.

\[DeviceA] ptp global enable

\# Specify PTP for obtaining the time.

\[DeviceA] clock protocol ptp

\# Enable PTP on Ten-GigabitEthernet 1/0/1.

\[DeviceA] interface ten-gigabitethernet 1/0/1

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceA-Ten-GigabitEthernet1/0/1] quit

**2\.**Configure Device B:

\# Specify the IEEE 1588 version 2 PTP
profile.

\<DeviceB\> system-view

\[DeviceB] ptp profile 1588v2

\# Specify the E2ETC clock node type.

\[DeviceB] ptp mode e2etc

\# Create a PTP domain.

\[DeviceB] ptp domain 0

\# Enable PTP globally.

\[DeviceB] ptp global enable

\# Specify PTP for obtaining the time.

\[DeviceB] clock protocol ptp

\# Enable PTP on Ten-GigabitEthernet 1/0/1.

\[DeviceB] interface ten-gigabitethernet 1/0/1

\[DeviceB-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/1] quit

\# Enable PTP on Ten-GigabitEthernet 1/0/2.

\[DeviceB] interface ten-gigabitethernet 1/0/2

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/2] quit

**3\.**Configure Device C:

\# Specify the IEEE 1588 version 2 PTP
profile.

\<DeviceC\> system-view

\[DeviceC] ptp profile 1588v2

\# Specify the OC clock node type.

\[DeviceC] ptp mode oc

\# Create a PTP domain.

\[DeviceC] ptp domain 0

\# Enable PTP globally.

\[DeviceC] ptp global enable

\# Specify PTP for obtaining the time.

\[DeviceC] clock protocol ptp

\# Enable PTP on Ten-GigabitEthernet 1/0/1.

\[DeviceC] interface ten-gigabitethernet 1/0/1

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceC-Ten-GigabitEthernet1/0/1] quit

#### Verifying the configuration

When the network is stable, perform the
following tasks:

·     Use the display ptp clock command to display PTP clock information.

·     Use the display ptp interface brief command to display brief PTP running information for all PTP interfaces.

\# Display PTP clock information on Device
A.

\[DeviceA] display ptp clock

PTP global state    : Enabled

PTP profile         : IEEE 1588
Version 2

PTP mode            : OC

Slave only          : No

Clock ID            :
000FE2-FFFE-FF0000

Clock type          : Local

Clock domain        : 0

Number of PTP ports : 1

Priority1     : 128

Priority2     : 128

Clock quality :

 Class                 : 248

 Accuracy              : 254

 Offset (log variance) : 65535

Offset from master : 0 (ns)

Mean path delay    : 0 (ns)

Steps removed      : 0

Local clock time   : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information for
all PTP interfaces on Device A.

\[DeviceA] display ptp interface brief

Name           State         Delay
mechanism  Clock step  Asymmetry correction

XGE1/0/1      Master        E2E              Two        
0

\# Display PTP clock information on Device B.

\[DeviceB] display ptp clock

PTP global state    : Enabled

PTP profile         : IEEE 1588
Version 2

PTP mode            : E2ETC

Slave only          : No

Clock ID            :
000FE2-FFFE-FF0001

Clock type          : Local

Clock domain        : 0

Number of PTP ports : 2

Priority1     : 128

Priority2     : 128

Clock quality :

 Class                 : 248

 Accuracy              : 254

 Offset (log variance) : 65535

Offset from master  : N/A

Mean path delay     : N/A

Steps removed       : N/A

Local clock time    : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information for
all PTP interfaces on Device B.

\[DeviceB] display ptp interface brief

Name           State         Delay
mechanism  Clock step  Asymmetry correction

XGE1/0/1      N/A           E2E              Two        
0

XGE1/0/1      N/A           E2E              Two        
0

The command outputs show that Device A is
elected as the GM and Ten-GigabitEthernet1/0/1 on Device A is the
master port.

### Example: Configuring PTP (IEEE 1588 version 2, IPv4 UDP transport, multicast transmission)

#### Network configuration

As shown in [Figure 5](#_Ref391038942), configure
PTP (IEEE 1588 version 2, IPv4 UDP transport, multicast transmission) to enable
time synchronization between the devices.

·     Specify the IEEE 1588 version 2 PTP profile for Device
A, Device B, and Device C.

·     Specify multicast IPv4 UDP transport for PTP
messages.

·     Assign Device A, Device B, and Device C to the
same PTP domain. Specify the OC clock node type for Device A and Device C, and P2PTC
clock node type for Device B. All clock nodes elect a GM through BMC in the PTP
domain.

·     Specify the peer delay measurement mechanism (p2p)
for Device A and Device C.

Figure 5 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705726_x_Img_x_png_4_2216111_294551_0.png)

‌

#### Procedure

**1\.**Configure Device A:

\# Specify the IEEE 1588 version 2 PTP
profile.

\<DeviceA\> system-view

\[DeviceA] ptp profile 1588v2

\# Specify the OC clock node type.

\[DeviceA] ptp mode oc

\# Create a PTP domain.

\[DeviceA] ptp domain 0

\# Enable PTP globally.

\[DeviceA] ptp global enable

\# Configure the source IP address for multicast
PTP messages transmitted over IPv4 UDP.

\[DeviceA] ptp source 10.10.1.1

\# Specify PTP for obtaining the time.

\[DeviceA] clock protocol ptp

\# On Ten-GigabitEthernet 1/0/1, specify the IPv4
UDP transport protocol for PTP messages, specify the delay measurement
mechanism as p2p, and enable PTP.

\[DeviceA] interface ten-gigabitethernet 1/0/1

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp transport-protocol
udp \[DeviceA-Ten-GigabitEthernet1/0/1] ptp
delay-mechanism p2p

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceA-Ten-GigabitEthernet1/0/1] quit

**2\.**Configure Device B:

\# Specify the IEEE 1588 version 2 PTP
profile.

\<DeviceB\> system-view

\[DeviceB] ptp profile 1588v2

\# Specify the P2PTC clock node type.

\[DeviceB] ptp mode p2ptc

\# Create a PTP domain.

\[DeviceB] ptp domain 0

\# Enable PTP globally.

\[DeviceB] ptp global enable

\# Configure the source IP address for multicast
PTP messages transmitted over UDP.

\[DeviceB] ptp source 10.10.2.1

\# Specify PTP for obtaining the time.

\[DeviceB] clock protocol ptp

\# On Ten-GigabitEthernet 1/0/1, specify the IPv4
UDP transport protocol for PTP messages and enable PTP.

\[DeviceB] interface ten-gigabitethernet 1/0/1

DeviceB-Ten-GigabitEthernet1/0/1] ptp
transport-protocol udp

\[DeviceB-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/1] quit

\# On Ten-GigabitEthernet 1/0/2, specify the IPv4
UDP transport protocol for PTP messages and enable PTP.

\[DeviceB] interface ten-gigabitethernet 1/0/2

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp
transport-protocol udp

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/2] quit

**3\.**Configure Device C:

\# Specify the IEEE 1588 version 2 PTP
profile.

\<DeviceC\> system-view

\[DeviceC] ptp profile 1588v2

\# Specify the OC clock node type.

\[DeviceC] ptp mode oc

\# Create a PTP domain.

\[DeviceC] ptp domain 0

\# Enable PTP globally.

\[DeviceC] ptp global enable

\# Configure the source IP address for multicast
PTP messages transmitted over UDP.

\[DeviceC] ptp source 10.10.3.1

\# Specify PTP for obtaining the time.

\[DeviceC] clock protocol ptp

\# On Ten-GigabitEthernet 1/0/1, specify the IPv4
UDP transport protocol for PTP messages, specify the delay measurement
mechanism as p2p, and enable PTP.

\[DeviceC] interface ten-gigabitethernet 1/0/1

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp
transport-protocol udp \[DeviceC-Ten-GigabitEthernet1/0/1] ptp
delay-mechanism p2p

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceC-Ten-GigabitEthernet1/0/1] quit

#### Verifying the configuration

When the network is stable, perform the
following tasks:

·     Use the display ptp clock command to display PTP clock information.

·     Use the display ptp interface brief command to display brief PTP running information for all PTP
interfaces.

\# Display PTP clock information on Device
A.

\[DeviceA] display ptp clock

PTP global state    : Enabled

PTP profile         : IEEE 1588
Version 2

PTP mode            : OC

Slave only          : No

Clock ID            :
000FE2-FFFE-FF0000

Clock type          : Local

Clock domain        : 0

Number of PTP ports : 1

Priority1     : 128

Priority2     : 128

Clock quality :

 Class                 : 248

 Accuracy              : 254

 Offset (log variance) : 65535

Offset from master : 0 (ns)

Mean path delay    : 0 (ns)

Steps removed      : 0

Local clock time   : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information for
all PTP interfaces on Device A.

\[DeviceA] display ptp interface brief

Name            State         Delay
mechanism  Clock step  Asymmetry correction

XGE1/0/1        Master        P2P              Two        
0

\# Display PTP clock information on Device B.

\[DeviceB] display ptp clock

PTP global state    : Enabled

PTP profile         : IEEE 1588
Version 2

PTP mode            : P2PTC

Slave only          : No

Clock ID            :
000FE2-FFFE-FF0001

Clock type          : Local

Clock domain        : 0

Number of PTP ports : 2

Priority1     : 128

Priority2     : 128

Clock quality :

 Class                 : 248

 Accuracy              : 254

 Offset (log variance) : 65535

Offset from master  : N/A

Mean path delay     : N/A

Steps removed       : N/A

Local clock time    : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information for
all PTP interfaces on Device B.

\[DeviceB] display ptp interface brief

Name            State         Delay
mechanism  Clock step  Asymmetry correction

XGE1/0/1          N/A           P2P              Two        
0

XGE1/0/2          N/A          
P2P              Two         0

The command outputs show that Device A is
elected as the GM and Ten-GigabitEthernet1/0/1 on Device A is the
master port.

### Example: Configuring PTP (IEEE 1588 version 2, IPv4 UDP transport, unicast transmission)

#### Network configuration

As shown in [Figure 6](#_Ref391049392), configure
PTP (IEEE 1588 version 2, IPv4 UDP transport, unicast transmission) to enable
Device A, Device B, Device C, and the base station to synchronize the time with
the ToD clock source.

·     Specify the IEEE 1588 version 2 PTP profile and
unicast IPv4 UDP transport of PTP messages for Device A, Device B, and Device
C.

·     Assign Device A, Device B, Device C, and the
base station to PTP domain 0\. Specify the BC clock node type for Device A,
Device B, and Device C. 

·     Connect Device A to the ToD clock source and
Device C to the base station.

·     Use the default Request\_Response delay
measurement mechanism on all clock nodes in the PTP domain.

Figure 6 Network
diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705727_x_Img_x_png_5_2216111_294551_0.png)

‌

#### Procedure

 

| IMPORTANT | IMPORTANT:  The device does not provide ToD interfaces. It can be deployed as Device B or Device C but not Device A. |
| --- | --- |

‌

**1\.**Assign IP addresses to the interfaces, and
make sure the devices can reach each other, as shown in [Figure 6](#_Ref391049392).
(Details not shown.)

**2\.**Configure Device A:

\# Specify the IEEE 1588 version 2 PTP
profile.

\<DeviceA\> system-view

\[DeviceA] ptp profile 1588v2

\# Specify the BC clock node type.

\[DeviceA] ptp mode bc

\# Create a PTP domain.

\[DeviceA] ptp domain 0

\# Enable PTP globally.

\[DeviceA] ptp global enable

\# Configure the delay time correction as
1000 nanoseconds for receiving ToD 0 clock signals.

\[DeviceA] ptp tod0 input delay
1000

\# Set priority 1 to 0 for the ToD 0
clock.

\[DeviceA] ptp priority
clock-source tod0 priority1 0

\# On Ten-GigabitEthernet 1/0/1, configure the destination
IP address for unicast PTP messages transmitted over IPv4 UDP, and enable PTP.

\[DeviceA] interface ten-gigabitethernet 1/0/1

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp
transport-protocol udp

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp
unicast-destination 10.10.10.2

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceA-Ten-GigabitEthernet1/0/1] quit

**3\.**Configure Device B:

\# Specify the IEEE 1588 version 2 PTP
profile.

\<DeviceB\> system-view

\[DeviceB] ptp profile 1588v2

\# Specify the BC clock node type.

\[DeviceB] ptp mode bc

\# Create a PTP domain.

\[DeviceB] ptp domain 0

\# Enable PTP globally.

\[DeviceB] ptp global enable

\# Specify PTP for obtaining the time.

\[DeviceB] clock protocol ptp

\# On Ten-GigabitEthernet 1/0/1, configure the destination
IP address for unicast PTP messages transmitted over IPv4 UDP, and enable PTP.

\[DeviceB] interface ten-gigabitethernet 1/0/1

\[DeviceB-Ten-GigabitEthernet1/0/1] ptp
transport-protocol udp

\[DeviceB-Ten-GigabitEthernet1/0/1] ptp
unicast-destination 10.10.10.1

\[DeviceB-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/1] quit

\# On Ten-GigabitEthernet 1/0/2, configure the destination
IP address for unicast PTP messages transmitted over IPv4 UDP, and enable PTP.

\[DeviceB] interface ten-gigabitethernet 1/0/2

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp
transport-protocol udp

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp
unicast-destination 11.10.10.1

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/2] quit

**4\.**Configure Device C:

\# Specify the IEEE 1588 version 2 PTP
profile.

\<DeviceC\> system-view

\[DeviceC] ptp profile 1588v2

\# Specify the BC clock node type.

\[DeviceC] ptp mode bc

\# Create a PTP domain.

\[DeviceC] ptp domain 0

\# Enable PTP globally.

\[DeviceC] ptp global enable

\# Configure the delay time correction as
100 nanoseconds for sending ToD 0 clock signals.

\[DeviceC] ptp tod0 output delay
100

\# Specify PTP for obtaining the time.

\[DeviceC] clock protocol ptp

\# On Ten-GigabitEthernet 1/0/1, configure the destination
IP address for unicast PTP messages transmitted over IPv4 UDP, and enable PTP.

\[DeviceC] interface ten-gigabitethernet 1/0/1

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp
transport-protocol udp

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp
unicast-destination 11.10.10.2

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceC-Ten-GigabitEthernet1/0/1] quit

\# On Ten-GigabitEthernet1/0/2, specify IPv4 UDP
transport of PTP messages, configure the destination IP address for unicast PTP
messages, and enable PTP.

\[DeviceC] interface ten-gigabitethernet 1/0/2

\[DeviceC-Ten-GigabitEthernet1/0/2] ptp
transport-protocol udp

\[DeviceC-Ten-GigabitEthernet1/0/2] ptp
unicast-destination 12.10.10.1

\[DeviceC-Ten-GigabitEthernet1/0/2] ptp enable

\[DeviceC-Ten-GigabitEthernet1/0/2] quit

**5\.**Configure the base station.

\# Specify PTP domain 0\.

\# Specify IPv4 UDP transport of PTP
messages.

\# Set the destination IP address of
unicast PTP messages to 12.10.10.2.

\# Specify the Request\_Response delay
measurement mechanism.

For more information, see the
configuration guide for the base station.

#### Verifying the configuration

When the network is stable, perform the
following tasks:

·     Use the display ptp clock command to display PTP clock information.

·     Use the display ptp interface brief command to display brief PTP running information for all PTP
interfaces.

\# Display PTP clock information on Device
A.

\[DeviceA] display ptp clock

PTP global state    : Enabled

PTP profile         : IEEE 1588
Version 2

PTP mode            : BC

Slave only          : No

Lock status         : Unlocked

Clock ID            :
000FE2-FFFE-FF0000

Clock type          : ToD0

 ToD direction  : In

 ToD delay time : 1000 (ns)

Clock domain        : 0

Number of PTP ports : 1

Priority1     : 0

Priority2     : 128

Clock quality :

 Class                 : 6

 Accuracy              : 32

 Offset (log variance) : 65535

Offset from master : 0 (ns)

Mean path delay    : 0 (ns)

Steps removed      : 0

Local clock time   : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information for
all PTP interfaces on Device A.

\[DeviceA] display ptp interface brief

Name           State         Delay
mechanism  Clock step  Asymmetry correction

XGE1/0/1       Master        E2E              Two        
0

\# Display PTP clock information on Device C.

\[DeviceC] display ptp clock

PTP global state    : Enabled

PTP profile         : IEEE 1588
Version 2

PTP mode            : BC

Slave only          : No

Lock status         : Locked

Clock ID            :
000FE2-FFFE-FF0001

Clock type          : Local

Clock domain        : 0

Number of PTP ports : 2

Priority1     : 128

Priority2     : 128

Clock quality :

 Class                 : 248

 Accuracy              : 254

 Offset (log variance) : 65535

Offset from master  : 50 (ns)

Mean path delay     : 2791 (ns)

Steps removed       : 2

Local clock time   : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information for
all PTP interfaces on Device C.

\[DeviceC] display ptp interface brief

Name           State         Delay
mechanism  Clock step  Asymmetry correction

XGE1/0/1       Slave         E2E              Two        
0

XGE1/0/2       Master       
E2E              Two         0

### Example: Configuring PTP (SMPTE ST 2059-2, IPv4 UDP transport, multicast transmission)

#### Network configuration

As shown in [Figure 7](#_Ref529385072), configure
PTP (SMPTE ST 2059-2, IPv4 UDP transport, multicast transmission) to enable
time synchronization between Device A and Device C:

·     Specify the SMPTE ST 2059-2 PTP profile and multicast
IPv4 UDP transport of PTP messages for Device A, Device B, and Device C.

·     Specify the OC clock node type for Device A and
Device C, and the P2PTC clock node type for Device B. All clock nodes elect a
GM through BMC.

·     Use the peer delay measurement mechanism on all
clock nodes in the PTP domain.

Figure 7 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705729_x_Img_x_png_7_2216111_294551_0.png)

‌

#### Procedure

| IMPORTANT | IMPORTANT:  The SMPTE ST 2059-2 PTP profile transports PTP messages over IPv4 UDP rather than IEEE 802.3/Ethernet. The profile supports both multicast and unicast transmission modes. |
| --- | --- |

 

**1\.**Configure Device A:

\# Specify the SMPTE ST 2059-2 PTP profile.

\<DeviceA\> system-view

\[DeviceA] ptp profile st2059-2

\# Specify the OC clock node type.

\[DeviceA] ptp mode oc

\# Create a PTP domain.

\[DeviceA] ptp domain 0

\# Enable PTP globally.

\[DeviceB] ptp global enable

\# Configure the source IP address for multicast
PTP messages transmitted over IPv4 UDP.

\[DeviceA] ptp source 10.10.1.1

\# Specify PTP for obtaining the time.

\[DeviceA] clock protocol ptp

\# On Ten-GigabitEthernet 1/0/1, specify the peer delay
measurement mechanism and enable PTP.

\[DeviceA] interface ten-gigabitethernet 1/0/1

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp
transport-protocol udp \[DeviceA-Ten-GigabitEthernet1/0/1] ptp
delay-mechanism p2p

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceA-Ten-GigabitEthernet1/0/1] quit

**2\.**Configure Device B:

\# Specify the SMPTE ST 2059-2 PTP profile.

\<DeviceB\> system-view

\[DeviceB] ptp profile st2059-2

\# Specify the P2PTC clock node type.

\[DeviceB] ptp mode p2ptc

\# Create a PTP domain.

\[DeviceB] ptp domain 0

\# Enable PTP globally.

\[DeviceB] ptp global enable

\# Configure the source IP address for multicast
PTP messages transmitted over IPv4 UDP.

\[DeviceB] ptp source 10.10.2.1

\# Specify PTP for obtaining the time.

\[DeviceB] clock protocol ptp

\# Enable PTP on Ten-GigabitEthernet 1/0/1.

\[DeviceB] interface ten-gigabitethernet 1/0/1

DeviceB-Ten-GigabitEthernet1/0/1] ptp
transport-protocol udp

\[DeviceB-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/1] quit

\# Enable PTP on Ten-GigabitEthernet 1/0/2.

\[DeviceB] interface ten-gigabitethernet 1/0/2

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp
transport-protocol udp

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/2] quit

**3\.**Configure Device C:

\# Specify the SMPTE ST 2059-2 PTP profile.

\<DeviceC\> system-view

\[DeviceC] ptp profile st2059-2

\# Specify the OC clock node type.

\[DeviceC] ptp mode oc

\# Create a PTP domain.

\[DeviceC] ptp domain 0

\# Enable PTP globally.

\[DeviceC] ptp global enable

\# Configure the source IP address for multicast
PTP messages transmitted over IPv4 UDP.

\[DeviceC] ptp source 10.10.3.1

\# Specify PTP for obtaining the time.

\[DeviceC] clock protocol ptp

\# On Ten-GigabitEthernet 1/0/1, specify the peer delay
measurement mechanism and enable PTP.

\[DeviceC] interface ten-gigabitethernet 1/0/1

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp delay-mechanism
p2p

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceC-Ten-GigabitEthernet1/0/1] quit

#### Verifying the configuration

When the network is stable, perform the
following tasks to verify the PTP configuration:

·     Use the display ptp clock command to display PTP clock information.

·     Use the display ptp interface brief command to display brief PTP running information for all PTP
interfaces.

\# Display PTP clock information on Device
A.

\[DeviceA] display ptp clock

PTP global state    : Enabled

PTP profile         : SMPTE ST 2059-2

PTP mode            : OC

Slave only          : No

Clock ID            :
000FE2-FFFE-FF0000

Clock type          : Local

Clock domain        : 0

Number of PTP ports : 1

Priority1     : 128

Priority2     : 128

Clock quality :

 Class                 : 248

 Accuracy              : 254

 Offset (log variance) : 65535

Offset from master  : 106368539000
(ns)

Mean path delay     : 2791000 (ns)

Steps removed       : 1

Local clock time    : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information for
all PTP interfaces on Device A.

\[DeviceA] display ptp interface brief

Name           State         Delay
mechanism  Clock step  Asymmetry correction

XXGE1/0/1      Master        P2P              Two        
0

\# Display PTP clock information on Device B.

\[DeviceB] display ptp clock

PTP global state    : Enabled

PTP profile         : SMPTE ST 2059-2

PTP mode            : P2PTC

Slave only          : No

Clock ID            :
000FE2-FFFE-FF0001

Clock type          : Local

Clock domain        : 0

Number of PTP ports : 2

Priority1     : 128

Priority2     : 128

Clock quality :

 Class                 : 248

 Accuracy              : 254

 Offset (log variance) : 65535

Offset from master  : N/A

Mean path delay     : N/A

Steps removed       : N/A

Local clock time   : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information for
all PTP interfaces on Device B.

\[DeviceB] display ptp interface brief

Name            State         Delay
mechanism  Clock step  Asymmetry correction

XGE1/0/1        N/A           P2P              Two        
0

XGE1/0/2        N/A          
P2P              Two         0

The output shows that Device A is elected
as the GM and Ten-GigabitEthernet1/0/1 on Device A sends
time synchronization information to its downstreams as a master port.

### Example: Configuring PTP (SMPTE ST 2059-2, IPv4 UDP transport, unicast transmission)

#### Network configuration

As shown in [Figure 8](#_Ref529385938), configure
PTP (SMPTE ST 2059-2, IPv4 UDP transport, unicast transmission) to enable
Device A, Device B, Device C, and the base station to synchronize time with the
ToD clock source .

·     Specify the SMPTE ST 2059-2 PTP profile and
unicast IPv4 UDP transport of PTP messages for Device A, Device B, and Device
C.

·     Assign Device A, Device B, Device C, and the
base station to PTP domain 0\. Specify the BC clock node type for Device A,
Device B, and Device C.

·     Connect Device A to the ToD clock source and
Device C to the base station.

·     Use the default Request\_Response delay
measurement mechanism on all clock nodes in the PTP domain.

Figure 8 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705731_x_Img_x_png_9_2216111_294551_0.png)

‌

#### Procedure

 

| IMPORTANT | IMPORTANT:  The SMPTE ST 2059-2 PTP profile supports IPv4 UDP transport rather than IEEE 802.3/Ethernet transport of PTP messages. It supports both multicast and unicast transmission of PTP messages. |
| --- | --- |

 

**1\.**Assign IP addresses to the interfaces, and
make sure the devices can reach each other, as shown in [Figure 8](#_Ref529385938).
(Details not shown.)

**2\.**Configure Device A:

The device does not provide ToD interfaces.
It can be used as Device B or Device C but not Device A.

\# Specify the SMPTE ST 2059-2 PTP profile.

\<DeviceA\> system-view

\[DeviceA] ptp profile st2059-2

\# Specify the BC clock node type.

\[DeviceA] ptp mode bc

\# Create a PTP domain.

\[DeviceA] ptp domain 0

\# Enable PTP globally.

\[DeviceA] ptp global enable

\# Configure the device to receive ToD 0
clock signals and set the delay correction value to 1000 nanoseconds.

\[DeviceA] ptp tod0 input delay
1000

\# Set priority 1 to 0 for the ToD 0
clock.

\[DeviceA] ptp priority
clock-source tod0 priority1 0

\# On Ten-GigabitEthernet 1/0/1, configure the destination
IP address for unicast PTP messages and enable PTP. (The SMPTE ST 2059-2 PTP
profile transports PTP messages over IPv4 UDP by default.)

\[DeviceA] interface ten-gigabitethernet 1/0/1

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp
transport-protocol udp

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp
unicast-destination 10.10.10.2

\[DeviceA-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceA-Ten-GigabitEthernet1/0/1] quit

**3\.**Configure Device B:

\# Specify the SMPTE ST 2059-2 PTP
profile.

\<DeviceB\> system-view

\[DeviceB] ptp profile st2059-2

\# Specify the BC clock node type.

\[DeviceB] ptp mode e2etc

\# Create a PTP domain.

\[DeviceB] ptp domain 0

\# Enable PTP globally.

\[DeviceB] ptp global enable

\# Specify PTP for obtaining the time.

\[DeviceA] clock protocol ptp

\# On Ten-GigabitEthernet 1/0/1, configure the destination
IP address for unicast PTP messages and enable PTP. (The SMPTE ST 2059-2 PTP
profile transports PTP messages over IPv4 UDP by default.)

\[DeviceB] interface ten-gigabitethernet 1/0/1

\[DeviceB-Ten-GigabitEthernet1/0/1] ptp
unicast-destination 10.10.10.1

\[DeviceB-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/1] quit

\# On Ten-GigabitEthernet 1/0/2, configure the destination
IP address for unicast PTP messages and enable PTP. (The SMPTE ST 2059-2 PTP
profile transports PTP messages over IPv4 UDP by default.)

\[DeviceB] interface ten-gigabitethernet 1/0/2

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp
unicast-destination 11.10.10.1

\[DeviceB-Ten-GigabitEthernet1/0/2] ptp enable

\[DeviceB-Ten-GigabitEthernet1/0/2] quit

**4\.**Configure Device C:

\# Specify the SMPTE ST 2059-2 PTP profile.

\<DeviceC\> system-view

\[DeviceC] ptp profile st2059-2

\# Specify the BC clock node type.

\[DeviceC] ptp mode bc

\# Create a PTP domain.

\[DeviceC] ptp domain 0

\# Enable PTP globally.

\[DeviceC] ptp global enable

\# Specify PTP for obtaining the time.

\[DeviceC] clock protocol ptp

\# On Ten-GigabitEthernet 1/0/1, configure the destination
IP address for unicast PTP messages and enable PTP.

\[DeviceC] interface ten-gigabitethernet 1/0/1

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp
transport-protocol udp

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp
unicast-destination 11.10.10.2

\[DeviceC-Ten-GigabitEthernet1/0/1] ptp enable

\[DeviceC-Ten-GigabitEthernet1/0/1] quit

\# On Ten-GigabitEthernet1/0/2, configure the destination
IP address for unicast PTP messages and enable PTP. (The SMPTE ST 2059-2 PTP
profile transports PTP messages over IPv4 UDP by default.)

\[DeviceC] interface ten-gigabitethernet 1/0/2

\[DeviceC-Ten-GigabitEthernet1/0/2] ptp
unicast-destination 12.10.10.1

\[DeviceC-Ten-GigabitEthernet1/0/2] ptp enable

\[DeviceC-Ten-GigabitEthernet1/0/2] quit

**5\.**Configure the base station.

\# Specify PTP domain 0\.

\# Specify IPv4 UDP transport of PTP
messages.

\# Set the destination IP address of
unicast PTP messages to 12.10.10.2.

\# Specify the Request\_Response delay
measurement mechanism.

For more information, see the
configuration guide for the base station.

#### Verifying the configuration

When the network is stable, perform the
following tasks to verify the PTP configuration:

·     Use the display ptp clock command to display PTP clock information.

·     Use the display ptp interface brief command to display brief PTP running information.

\# Display PTP clock information on Device
A.

\[DeviceA] display ptp clock

PTP global state    : Enabled

PTP profile         : SMPTE ST 2059-2

PTP mode            : BC

Slave only          : No

Clock ID            :
000FE2-FFFE-FF0000

Clock type          : ToD0

 ToD direction  : In

 ToD delay time : 1000 (ns)

Clock domain        : 0

Number of PTP ports : 1

Priority1     : 0

Priority2     : 128

Clock quality :

 Class                 : 6

 Accuracy              : 32

 Offset (log variance) : 65535

Offset from master : 0 (ns)

Mean path delay    : 0 (ns)

Steps removed      : 0

Local clock time   : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information on
Device A.

\[DeviceA] display ptp interface brief

Name                State        
Delay mechanism  Clock step  Asymmetry correction

XGE1/0/1            Master        E2E        
     Two         0

\# Display PTP clock information on Device C.

\[DeviceC] display ptp clock

PTP global state    : Enabled

PTP profile         : SMPTE ST 2059-2

PTP mode            : BC

Slave only          : No

Clock ID            :
000FE2-FFFE-FF0001

Clock type          : Local

Clock domain        : 0

Number of PTP ports : 2

Priority1     : 128

Priority2     : 128

Clock quality :

 Class                 : 248

 Accuracy              : 254

 Offset (log variance) : 65535

Offset from master  : 50 (ns)

Mean path delay     : 2780 (ns)

Steps removed       : 2

Local clock time    : Sun Jan 15
20:57:29 2019

\# Display brief PTP running information on
Device C.

\[DeviceC] display ptp interface brief

Name            State         Delay
mechanism  Clock step  Asymmetry correction

XGE1/0/1        Slave         E2E              Two        
0

XGE1/0/2        Master       
E2E              Two         0

 

