
# IPv6 PIM overview

IPv6 Protocol Independent Multicast (IPv6 PIM) provides IPv6
multicast forwarding by leveraging IPv6 unicast static routes or IPv6 unicast
routing tables generated by any IPv6 unicast routing protocol. IPv6 PIM uses
the underlying IPv6 unicast routing to generate an IPv6 multicast routing table
without relying on any particular IPv6 unicast routing protocol.

IPv6 PIM uses the RPF mechanism to
implement IPv6 multicast forwarding. For more information about RPF, see
"Configuring IPv6 multicast routing and forwarding."

## IPv6 PIM modes

Based on the implementation mechanism, IPv6
PIM includes the following modes:

·     IPv6 Protocol Independent Multicast–Dense Mode (IPv6
PIM-DM).

·     IPv6 Protocol Independent Multicast–Sparse Mode
(IPv6 PIM-SM).

·     IPv6 Bidirectional Protocol Independent
Multicast (IPv6 BIDIR-PIM).

·     IPv6 Protocol Independent Multicast
Source-Specific Multicast (IPv6 PIM-SSM).

In this document, an IPv6 PIM domain refers
to a network composed of IPv6 PIM devices. 

## IPv6 PIM-DM

IPv6 PIM-DM uses the push mode for
multicast forwarding and is suitable for small networks with densely
distributed IPv6 multicast members.

IPv6 PIM-DM assumes that all downstream
nodes want to receive IPv6 multicast data from a source, so IPv6 multicast data
is flooded to all downstream nodes on the network. Branches without downstream receivers
are pruned from the forwarding trees, leaving only those branches that contain
receivers. When the pruned branch has new receivers, the graft mechanism turns
the pruned branch into a forwarding branch.

In IPv6 PIM-DM, the multicast forwarding
paths for an IPv6 multicast group constitute a forwarding tree. The forwarding
tree is rooted at the IPv6 multicast source and has multicast group members as
its "leaves." Because the forwarding tree consists of the shortest
paths from the IPv6 multicast source to the receivers, it is also called a "shortest
path tree (SPT)."

IPv6 PIM-DM mechanisms include neighbor
discovery, SPT building, graft, and assert.

### Neighbor discovery

In an IPv6 PIM domain, each IPv6 PIM interface
periodically multicasts IPv6 PIM hello messages to all other IPv6 PIM devices
on the local subnet. Through the exchanging of hello messages, all IPv6 PIM devices
determine their IPv6 PIM neighbors, maintain IPv6 PIM neighboring relationship
with other devices, and build and maintain SPTs.

### SPT building

The process of building an SPT is the
flood-and-prune process: 

**1\.**In an IPv6 PIM-DM domain, the IPv6 multicast
data from the IPv6 multicast source S to the IPv6 multicast group G is flooded
throughout the domain. A device performs an RPF check on the IPv6 multicast
data. If the check succeeds, the device creates an (S, G) entry and forwards
the data to all downstream nodes in the network. In the flooding process, all
the devices in the IPv6 PIM-DM domain create the (S, G) entry.

**2\.**The nodes without downstream receivers are
pruned. A device that has no downstream receivers multicasts a prune message to
all IPv6 PIM devices on the subnet. When the upstream node receives the prune
message, it removes the receiving interface from the (S, G) entry. In this way,
the upstream stream node stops forwarding subsequent packets addressed to that IPv6
multicast group down to this node.

 

|  | NOTE:  An (S, G) entry contains an IPv6 multicast source address S, an IPv6 multicast group address G, an outgoing interface list, and an incoming interface. |
| --- | --- |

 

A prune process is initiated by a leaf device.
As shown in [Figure 1](#_Ref206410272), the device interface that does not have any downstream receivers initiates
a prune process by sending a prune message toward the IPv6 multicast source.
This prune process goes on until only necessary branches are left in the IPv6
PIM-DM domain, and these necessary branches constitute an SPT. 

Figure 1 SPT building

![](https://resource.h3c.com/en/202407/12/20240712_11705045_x_Img_x_png_0_2216043_294551_0.png)

 

The pruned state of a branch has a finite holdtime
timer. When the timer expires, IPv6 multicast data is again forwarded to the
pruned branch. The flood-and-prune cycle takes place periodically to maintain
the forwarding branches.

### Graft

A previously pruned branch might have new
downstream receivers. To reduce the latency for resuming the forwarding
capability of this branch, a graft mechanism is used as follows:

**1\.**The node that needs to receive the IPv6
multicast data sends a graft message to its upstream node, telling it to rejoin
the SPT. 

**2\.**After receiving this graft message on an
interface, the upstream node adds the receiving interface to the outgoing
interface list of the (S, G) entry. It also sends a graft-ack message to the
graft sender. 

**3\.**If the graft sender receives a graft-ack
message, the graft process finishes. Otherwise, the graft sender continues to
send graft messages at a graft retry interval until it receives an
acknowledgment from its upstream node.

### Assert

On a subnet with more than one multicast device,
the assert mechanism shuts off duplicate multicast flows to the network. It
does this by electing a unique multicast forwarder for the subnet.

Figure 2 Assert mechanism

![](https://resource.h3c.com/en/202407/12/20240712_11705046_x_Img_x_png_1_2216043_294551_0.png)

 

As shown in [Figure 2](#_Ref206410575), after
Device A and Device B receive an (S, G) packet from the upstream node, they
both forward the packet to the local subnet. As a result, the downstream node Device
C receives two identical multicast packets. In addition, both Device A and Device
B, on their downstream interfaces, receive a duplicate packet forwarded by the
other. After detecting this condition, both devices send an assert message to
all IPv6 PIM devices on the local subnet through the interface that received the
packet. The assert message contains the IPv6 multicast source address (S), the IPv6
multicast group address (G), and the metric preference and metric of the IPv6 unicast
route/MBGP route/static multicast route to the IPv6 multicast source. By
comparing these parameters, either Device A or Device B becomes the unique
forwarder of the subsequent (S, G) packets on the subnet. The comparison
process is as follows:

**1\.**The device with a higher metric preference
to the IPv6 multicast source wins. 

**2\.**If both devices have the same metric preference
to the IPv6 multicast source, the device with a smaller metric to the IPv6
multicast source wins.

**3\.**If both devices have the same metric, the device
with a higher IPv6 link-local address on the downstream interface wins.

## IPv6 PIM-SM

IPv6 PIM-DM uses the flood-and-prune cycles
to build SPTs for IPv6 multicast data forwarding. Although an SPT has the
shortest paths from the IPv6 multicast source to the receivers, it is built
with a low efficiency. Therefore, IPv6 PIM-DM is not suitable for large- and
medium-sized networks.

IPv6 PIM-SM uses the pull mode for IPv6 multicast
forwarding, and it is suitable for large-sized and medium-sized networks with
sparsely and widely distributed IPv6 multicast group members.

IPv6 PIM-SM assumes that no hosts need IPv6
multicast data. A multicast receiver must express its interest in the IPv6
multicast data for an IPv6 multicast group before the data is forwarded to it. A
rendezvous point (RP) is the core of an IPv6 PIM-SM domain. Relying on the RP,
SPTs and rendezvous point trees (RPTs) are established and maintained to
implement IPv6 multicast data forwarding. An SPT is rooted at the IPv6 multicast
source and has the RPs as its leaves. An RPT is rooted at the RP and has the receiver
hosts as its leaves.

IPv6 PIM-SM mechanisms include neighbor
discovery, DR election, RP discovery, Anycast RP, RPT building, multicast
source registration, switchover to SPT, and assert.

### Neighbor discovery

IPv6 PIM-SM uses the
same neighbor discovery mechanism as IPv6 PIM-DM does. For more information,
see "[Neighbor
discovery](#_Ref160955222)." 

### DRelection

A designated router (DR) is required on both
the source-side network and receiver-side network. A source-side DR acts on
behalf of the IPv6 multicast source to send register messages to the RP. The
receiver-side DR acts on behalf of the receiver hosts to send join messages to
the RP. 

 

| IMPORTANT | IMPORTANT:  MLD must be enabled on the device that acts as the receiver-side DR. Otherwise, the receiver hosts attached to the DR cannot join any IPv6 multicast groups. For more information about MLD, see "Configuring MLD." |
| --- | --- |

 

Figure 3 DR election

![](https://resource.h3c.com/en/202407/12/20240712_11705064_x_Img_x_png_3_2216043_294551_0.png)

 

As shown in [Figure 3](#_Ref89263906), the DR
election process is as follows:

**1\.**The devices on the shared-media LAN send
hello messages to one another. The hello messages contain the DR priority for
DR election. The device with the highest DR priority is elected as the DR.

**2\.**The device with the highest IPv6 link-local address
wins the DR election under one of the following conditions:

¡     All
the devices have the same DR election priority.

¡     A device
does not support carrying the DR priority in hello messages.

If the DR fails, its IPv6 PIM neighbor
lifetime expires, and the other devices initiate a new DR election. 

### RP discovery

An RP is the core of an IPv6 PIM-SM domain.
An IPv6 multicast group can have only one RP for IPv6 multicast forwarding, and
an RP can be designated to multiple IPv6 multicast groups. 

#### RP selection mechanism

An RP can be statically configured,
dynamically elected, or extracted from an IPv6 multicast address with embedded
RP. The embedded RP takes precedence over the static RP and the dynamic RP. The
priorities of the static RP and the dynamic RP depend on whether the static RP
is preferred when the static RP is configured.

·     If the static RP is preferred, the static RP
takes precedence over the dynamic RP. The dynamic RP takes services over only
when the static RP fails.

·     If the static RP is not preferred, the dynamic
RP takes precedence over the static RP. The static RP takes services over only
when the dynamic RP fails.

#### Static RPs

A static RP can avoid a single point of
failure and save network bandwidth that is consumed by frequent communications
between C-RPs and the BSR.

#### Dynamic RP election

Dynamic RP election is implemented through
the BSR mechanism. BSR mechanism includes the following roles:

·     Candidate-RPs (C-RPs)—An RP is dynamically elected from C-RPs to provide services to an
IPv6 multicast group.

·     BSR—A BSR is the core of the administrative core of the IPv6 PIM-SM
domain. It is responsible for collecting and advertising RP information in the
whole domain. An IPv6 PIM-SM domain has only one BSR, and the BSR is elected
from C-BSRs.

·     Candidate-BSRs (C-BSRs)—Any devices in the IPv6 PIM-SM domain can act as C-BSRs and the BSR
is elected from the C-BSRs. Once the BSR fails, a new BSR is elected from the
C-BSRs to avoid multicast traffic interruption. 

 

|  | NOTE:  A device can act as a C-RP and a C-BSR at the same time. |
| --- | --- |

 

Figure 4 Information exchange between C-RPs
and BSR

![](https://resource.h3c.com/en/202407/12/20240712_11705065_x_Img_x_png_4_2216043_294551_0.png)

 

As shown in [Figure 4](#_Ref458705296), an RP
is elected as follows:

**1\.**Each C-BSR sends a BSM to other devices in
the IPv6 PIM-SM domain.

**2\.**When a C-BSR receives a BSM from another
C-BSR, it compares its own priority with the priority carried in the message.
The C-BSR with a higher priority wins the BSR election. If a tie exists in the
priority, the C-BSR with a higher IPv6 address wins. The loser uses the
winner's BSR address to replace its own BSR address and no longer regards
itself as the BSR. The winner retains its own BSR address and continues to
regard itself as the BSR.

**3\.**Each C-RP periodically unicasts an
advertisement message to the BSR. An advertisement message contains the address
of the advertising C-RP and the IPv6 multicast group range to which it is
designated.

**4\.**The BSR collects these advertisement
messages and organizes the C-RP information into an RP-set, which is a database
of mappings between IPv6 multicast groups and RPs. The BSR encapsulates the
RP-set information in the BSMs and advertises the BSMs to the entire IPv6 PIM-SM
domain.

**5\.**All devices in the IPv6 PIM-SM domain select
an RP for an IPv6 multicast group based on the following rules:

**a.**The C-RP that is designated to the smallest IPv6
multicast group range wins.

**b.**If the C-RPs are designated to the same
group ranges, the C-RP with the highest priority wins.

**c.**If the C-RPs have the same priority, the
C-RP with the largest hash value wins. The hash value is calculated through the
hash algorithm.

**d.**If the C-RPs have the same hash value, the
C-RP with the highest IP address wins.

### Embedded RP

The embedded RP mechanism enables a device
to resolve the RP address from an IPv6 multicast group address to map the IPv6
multicast group to an RP. This RP can take the place of the configured static RP
or the RP dynamically elected by the bootstrap mechanism. A DR does not need to
learn the RP address beforehand. [Figure 5](#_Ref498952517) shows
the format of an IPv6 multicast group address with embedded RP.

Figure 5 Format of an IPv6 multicast address
with embedded RP

![http://www.h3c.com/cn/res/200803/05/20080305_333537_image004_336046_30003_0.gif](/en/res/202407/12/20240712_11705044_x_Img_x_gif_5_2216043_294551_0.gif)

 

As shown in [Figure 5](#_Ref498952517), the
requirements for each field are as follows:

·     First 8 bits—Fixed to 0xFF.

·     Flags—The R, P, and T bits must be set to 1\.

·     Reserved—Contains 4 bits and must be set to 0\.

·     RIID—Contains 4 bits and indicates the RP interface ID.

·     Plen—Contains 8 bits and indicates the valid length (in bits) of the RP
address prefix. This field value cannot be greater than 64 and cannot be 0\.

·     Network prefix—Contains 64 bits and indicates the prefix of the RP address. The
valid length of the prefix is determined by the Plen field.

·     Group ID—Reduced to 32 bits and indicates the ID of the IPv6 multicast
group.

The process of discovering an embedded RP
is as follows: 

·     At the receiver side, a receiver host initiates
an MLD report to join an IPv6 multicast group. Upon receiving the MLD report, the
receiver-side DR resolves the RP address embedded in the IPv6 multicast group
address and uses the RP for the IPv6 multicast group.

·     At the IPv6 multicast source side, the IPv6
multicast source sends an IPv6 multicast packet to an IPv6 multicast group.
Upon receiving the IPv6 multicast packet, the source-side DR resolves the RP
address embedded in the IPv6 multicast address and uses the RP for the IPv6
multicast group.

### Anycast RP

IPv6 PIM-SM requires only one active RP to
serve each IPv6 multicast group. If the active RP fails, the multicast traffic
might be interrupted. The Anycast RP mechanism enables redundancy backup among
RPs by configuring multiple RPs with the same IPv6 address for one multicast
group. An IPv6 multicast source registers with the closest RP or a receiver-side
DR joins the closest RP to implement source information synchronization.

Anycast RP has the following benefits:

·     Optimal RP path—An IPv6 multicast source registers with the closest RP to build an
optimal SPT. A receiver joins the closest RP to build an optimal RPT.

·     Redundancy backup among RPs—When an RP fails, the RP-related sources will register with the
closest available RPs and the receiver-side DRs will join the closest available
RPs. This provides redundancy backup among RPs.

Anycast RP is implemented by using either
of the following methods:

·     Anycast RP through MSDP—In this method, you can configure multiple RPs with the same IP
address for one multicast group and configure MSDP peering relationships
between them. For more information about Anycast RP through MSDP, see
"Configuring MSDP."

·     Anycast RP through IPv6 PIM-SM—In this method, you can configure multiple RPs for one IPv6
multicast group and add them to an Anycast RP set. This method introduces the
following concepts:

¡     Anycast RP set—A set of RPs that are
designated to the same IPv6 multicast group.

¡     Anycast RP member—Each RP in the
Anycast RP set.

¡     Anycast RP member address—IPv6 address
of each Anycast RP member for communication among the RP members.

¡     Anycast RP address—IPv6 address of
the Anycast RP set for communication within the IPv6 PIM-SM domain. It is also
known as RPA.

As shown in [Figure 6](#_Ref365893364), RP 1,
RP 2, and RP 3 are members of an Anycast RP set.

Figure 6 Anycast
RP through IPv6 PIM-SM

![](https://resource.h3c.com/en/202407/12/20240712_11705066_x_Img_x_png_6_2216043_294551_0.png)

 

The following describes how Anycast RP
through IPv6 PIM-SM is implemented:

**a.**RP 1 receives a register message destined to
RPA. Because the message is not from other Anycast RP members (RP 2 or RP 3),
RP 1 considers that the register message is from the DR. RP 1 changes the
source IPv6 address of the register message to its own IPv6 address and sends the
message to the other members (RP 2 and RP 3). 

If a device acts as both a DR and an RP, it
creates a register message, and then forwards the message to the other RP members.

**b.**After receiving the register message, RP 2
and RP 3 find out that the source address of the register message is an Anycast
RP member address. They stop forwarding the message to other devices.

In Anycast RP implementation, an RP must
forward the register message from the DR to other Anycast RP members to synchronize
IPv6 multicast source information.

### RPT building

Figure 7 RPT building in an IPv6 PIM-SM
domain

![](https://resource.h3c.com/en/202407/12/20240712_11705067_x_Img_x_png_7_2216043_294551_0.png)

 

As shown in [Figure 7](#_Ref206410607), the
process of building an RPT is as follows:

**1\.**When a receiver wants to join the IPv6
multicast group G, it uses an MLD message to inform the receiver-side DR.

**2\.**After getting the receiver information, the
DR sends a join message, which travels hop by hop to the RP for the IPv6
multicast group.

**3\.**The devices along the path from the DR to
the RP form an RPT branch. Each device on this branch adds to its forwarding
table a (\*, G) entry, where the asterisk (\*) represents any IPv6 multicast
source. The RPT is rooted at the RP and has the DR as its leaf.

When the IPv6 multicast data addressed to
the IPv6 multicast group G reaches the RP, the RP forwards the data to the DR
along the established RPT. Finally, the DR forwards the IPv6 multicast data to
the receiver hosts.

When a receiver is no longer interested in
the IPv6 multicast data addressed to the IPv6 multicast group G, the receiver-side
DR sends a prune message. The prune message goes hop by hop along the RPT to
the RP. After receiving the prune message, the upstream node deletes the
interface that connects to this downstream node from the outgoing interface
list. At the same time, the upstream device checks for the existence of
receivers for that IPv6 multicast group. If no receivers for the IPv6 multicast
group exist, the device continues to forward the prune message to its upstream device.

### IPv6 multicast source registration

The IPv6 multicast source uses the registration
process to inform an RP of its presence.

Figure 8 IPv6 multicast source registration

![](https://resource.h3c.com/en/202407/12/20240712_11705068_x_Img_x_png_8_2216043_294551_0.png)

 

As shown in [Figure 8](#_Ref206410623), the IPv6
multicast source registers with the RP as follows:

**1\.**The IPv6 multicast source S sends the first
multicast packet to the IPv6 multicast group G. When receiving the multicast
packet, the source-side DR that directly connects to the IPv6 multicast source
encapsulates the packet into a register message and unicasts the message to the
RP.

**2\.**After the RP receives the register message,
it decapsulates it and forwards it down to the RPT. Meanwhile, it sends an (S,
G) source-specific join message toward the IPv6 multicast source. The devices
along the path from the RP to the IPv6 multicast source constitute an SPT
branch. Each device on this branch creates an (S, G) entry in its forwarding
table.

**3\.**The subsequent IPv6 multicast data from the IPv6
multicast source are forwarded to the RP along the SPT. When the IPv6 multicast
data reaches the RP along the SPT, the RP forwards the data to the receivers
along the RPT. Meanwhile, it unicasts a register-stop message to the
source-side DR to prevent the DR from unnecessarily encapsulating the data. 

### Switchover to SPT

In an IPv6 PIM-SM domain, only one RP and
one RPT provide services for a specific IPv6 multicast group. Before the
switchover to SPT occurs, the source-side DR encapsulates all IPv6 multicast
data in register messages and sends them to the RP. After receiving these
register messages, the RP decapsulates them and forwards them to the
receiver-side DR along the RPT. 

IPv6 multicast forwarding along the RPT has
the following weaknesses:

·     Encapsulation and decapsulation are complex on the
source-side DR and the RP.

·     The path for an IPv6 multicast packet might not
be the shortest one.

·     The RP might be overloaded by IPv6 multicast
traffic bursts.

To eliminate these weaknesses, IPv6 PIM-SM
allows an RP or the receiver-side DR to initiate the switchover to SPT when the
RP or DR receives IPv6 multicast traffic:

·     The RP initiates the switchover to SPT:

If the RP receives IPv6 multicast traffic,
it sends an (S, G) source-specific join message toward the IPv6 multicast
source. The devices along the path from the RP to the IPv6 multicast source
constitute an SPT branch. The subsequent IPv6 multicast data is forwarded to
the RP along the SPT without being encapsulated into register messages. 

For more information about the switchover
to SPT initiated by the RP, see "[IPv6 multicast source registration](#_Ref217376882)."

·     The receiver-side DR initiates the switchover to
SPT:

If the receiver-side DR receives IPv6
multicast traffic, it initiates the switchover to SPT as follows: 

**a.**The receiver-side DR sends an (S, G) source-specific
join message toward the IPv6 multicast source. The devices along the path create
an (S, G) entry in their forwarding table to constitute an SPT branch.

**b.**When the multicast packets reach the device
where the RPT and the SPT branches, the device drops the multicast packets that
travel along the RPT. It then sends a prune message with the RP bit toward the
RP. 

**c.**After receiving the prune message, the RP forwards
it toward the IPv6 multicast source (supposed only one receiver exists). Thus, the
switchover to SPT is completed. The subsequent IPv6 multicast packets for the IPv6
multicast group travel along the SPT from the IPv6 multicast source to the
receiver hosts. 

With the switchover to SPT, IPv6 PIM-SM
builds SPTs more economically than IPv6 PIM-DM does.

### Assert

IPv6 PIM-SM uses a similar assert mechanism
as IPv6 PIM-DM does. For more information, see "[Assert](#_Ref160955347)."

## IPv6 BIDIR-PIM

In some many-to-many applications, such as a
multi-side video conference, multiple receivers of an IPv6 multicast group might
be interested in the IPv6 multicast data from multiple IPv6 multicast sources.
With IPv6 PIM-DM or IPv6 PIM-SM, each device along the SPT must create an (S,
G) entry for each IPv6 multicast source, consuming a lot of system resources. 

IPv6 BIDIR-PIM addresses the problem. Derived
from IPv6 PIM-SM, IPv6 BIDIR-PIM builds and maintains a bidirectional RPT,
which is rooted at the RP and connects the IPv6 multicast sources and the
receivers. Along the bidirectional RPT, the IPv6 multicast sources send IPv6
multicast data to the RP, and the RP forwards the data to the receivers. Each device
along the bidirectional RPT needs to maintain only one (\*, G) entry, saving
system resources.

IPv6 BIDIR-PIM is suitable for a network
with dense IPv6 multicast sources and receivers. 

IPv6 BIDIR-PIM mechanisms include neighbor
discovery, RP discovery, DF election, and bidirectional RPT building.

### Neighbor discovery

IPv6 BIDIR-PIM uses the same neighbor
discovery mechanism as IPv6 PIM-SM does. For more information, see "[Neighbor discovery](#_Ref319506670)."

### RP discovery

IPv6 BIDIR-PIM supports static RPs and
dynamic RP election, and uses the same RP discovery mechanism as IPv6 PIM-SM,
except that IPv6 BIDIR-PIM does not support embedded RP. For more information,
see "[RP discovery](#_Ref274580045)." In IPv6 BIDIR-PIM, an RPF interface is the interface toward
an RP, and an RPF neighbor is the address of the next hop to the RP. 

### DF election

On a subnet with multiple multicast devices,
duplicate multicast packets might be forwarded to the RP. To address this
issue, IPv6 BIDIR-PIM uses a designated forwarder (DF) election mechanism to
elect a unique DF on each subnet. Only the DFs can forward IPv6 multicast data
to the RP. 

DF election is not necessary for an RPL.

Figure 9 DF election

![](https://resource.h3c.com/en/202407/12/20240712_11705069_x_Img_x_png_9_2216043_294551_0.png)

 

As shown in [Figure 9](#_Ref319506540), without
the DF election mechanism, both Device B and Device C can receive IPv6 multicast
packets from Device A. They also can forward the packets to downstream devices
on the local subnet. As a result, the RP (Device E) receives duplicate IPv6 multicast
packets.

With the DF election mechanism, once receiving
the RP information, Device B and Device C multicast a DF election message to
all IPv6 PIM devices on the subnet to initiate a DF election process. The
election message carries the RP's address, and the route preference and metric
of the unicast route to the RP. A DF is elected as follows:

**1\.**The device with higher route preference becomes
the DF. 

**2\.**If the devices have the same route
preference, the device with lower metric becomes the DF. 

**3\.**If the devices have the same metric, the device
with the higher IP address becomes the DF.

### Bidirectional RPT building

A bidirectional RPT
comprises a receiver-side RPT and a source-side RPT. The receiver-side RPT is
rooted at the RP and takes the devices that directly connect to the receivers as
leaves. The source-side RPT is also rooted at the RP but takes the devices that
directly connect to the IPv6 multicast sources as leaves. The processes for
building these two RPTs are different.

Figure 10 RPT building at the receiver side

![](https://resource.h3c.com/en/202407/12/20240712_11705047_x_Img_x_png_10_2216043_294551_0.png)

 

As shown in [Figure 10](#_Ref319506560), the
process for building a receiver-side RPT is the same as the process for
building an RPT in IPv6 PIM-SM:

**1\.**When a receiver wants to join the IPv6
multicast group G, it uses an MLD message to inform the directly connected device.

**2\.**After receiving the message, the device
sends a join message, which is forwarded hop by hop to the RP for the IPv6
multicast group.

**3\.**The devices along the path from the receiver's
directly connected device to the RP form an RPT branch. Each device on this
branch adds a (\*, G) entry to its forwarding table. 

After a receiver host leaves the IPv6
multicast group G, the directly connected device multicasts a prune message to
all IPv6 PIM devices on the subnet. The prune message goes hop by hop along the
reverse direction of the RPT to the RP. After receiving the prune message, an
upstream node removes the interface that connects to the downstream node from
the outgoing interface list. At the same time, the upstream device checks the
existence of receivers for that IPv6 multicast group. If no receivers for the
IPv6 multicast group exist, the device continues to forward the prune message
to its upstream device.

Figure 11 RPT building at the IPv6 multicast
source side

![](https://resource.h3c.com/en/202407/12/20240712_11705048_x_Img_x_png_11_2216043_294551_0.png)

 

As shown in [Figure 11](#_Ref264545011), the
process for building a source-side RPT is relatively simple:

**1\.**When an IPv6 multicast source sends
multicast packets to the IPv6 multicast group G, the DF in each subnet
unconditionally forwards the packets to the RP.

**2\.**The devices along the path from the source's
directly connected device to the RP constitute an RPT branch. Each device on
this branch adds a (\*, G) entry to its forwarding table.

After a bidirectional RPT is built, the IPv6
multicast sources send multicast traffic to the RP along the source-side RPT.
Then, the RP forwards the traffic to the receivers along the receiver-side RPT.

 

| IMPORTANT | IMPORTANT:  If a receiver and a source are at the same side of the RP, the source-side RPT and the receiver-side RPT might meet at a node before reaching the RP. In this case, the multicast packets from the IPv6 multicast source to the receiver are directly forwarded by the node, instead of by the RP. |
| --- | --- |

 

## IPv6 administrative scoping

Typically, an IPv6 PIM-SM domain or an IPv6
BIDIR-PIM domain contains only one BSR, which is responsible for advertising
RP-set information within the entire domain. Information about all IPv6
multicast groups is forwarded within the network that the BSR administers. This
is called the "IPv6 non-scoped BSR mechanism."

### IPv6 administrative scoping mechanism

To implement refined management, you can
divide an IPv6 PIM-SM domain or IPv6 BIDIR-PIM domain into an IPv6 global-scoped
zone and multiple IPv6 administratively-scoped zones (admin-scoped zones). This
is called the "IPv6 administrative scoping mechanism."

The administrative scoping mechanism
effectively releases stress on the management in a single-BSR domain and
enables provision of zone-specific services through private group addresses.

An IPv6 admin-scoped zone is designated to particular
IPv6 multicast groups with the same scope field value in their group addresses.
Zone border routers (ZBRs) form the boundary of an IPv6 admin-scoped zone. Each
IPv6 admin-scoped zone maintains one BSR for IPv6 multicast groups with the
same scope field value. IPv6 multicast protocol packets, such as assert
messages and BSMs, of these IPv6 multicast groups cannot cross the boundary of
the IPv6 admin-scoped zone for the group range. The IPv6 multicast group ranges
to which different IPv6 admin-scoped zones are designated can have
intersections. However, the IPv6 multicast groups in an IPv6 admin-scoped zone are
valid only within its local zone, and theses IPv6 multicast groups are regarded
as private group addresses. 

The IPv6 global-scoped zone can be regarded
as a special IPv6 admin-scoped zone, and it maintains a BSR for the IPv6
multicast groups with the scope field value as 14\.

### Relationship between IPv6 admin-scoped zones and the IPv6 global-scoped zone

The IPv6 global-scoped zone and each IPv6 admin-scoped
zone have their own C-RPs and BSRs. These devices are effective only on their
respective zones, and the BSR election and the RP election are implemented
independently. Each IPv6 admin-scoped zone has its own boundary. The IPv6 multicast
information within a zone cannot cross this boundary in either direction. You
can have a better understanding of the IPv6 global-scoped zone and IPv6 admin-scoped
zones based on geographical locations and the scope field values.

·     In view of geographical locations:

An IPv6 admin-scoped zone is a logical
zone for particular IPv6 multicast groups with the same scope field value. The IPv6
multicast packets for such IPv6 multicast groups are confined within the local IPv6
admin-scoped zone and cannot cross the boundary of the zone. 

Figure 12 Relationship
in view of geographical locations

![](https://resource.h3c.com/en/202407/12/20240712_11705050_x_Img_x_png_13_2216043_294551_0.png)

 

As shown in [Figure 12](#_Ref319506575), for the
IPv6 multicast groups with the same scope field value, the IPv6 admin-scoped
zones must be geographically separated and isolated. The IPv6 global-scoped
zone includes all devices in the IPv6 PIM-SM domain or IPv6 BIDIR-PIM domain. IPv6
multicast packets that do not belong to any IPv6 admin-scoped zones are
forwarded in the entire IPv6 PIM-SM domain or IPv6 BIDIR-PIM domain.

·     In view of the scope field values:

In terms of the scope field values, the
scope field in an IPv6 multicast group address shows the zone to which the IPv6
multicast group belongs.

Figure 13 IPv6
multicast address format

![](https://resource.h3c.com/en/202407/12/20240712_11705051_x_Img_x_png_14_2216043_294551_0.png)

 

An IPv6 admin-scoped zone with a larger
scope field value contains an IPv6 admin-scoped zone with a smaller scope field
value. The zone with the scope field value of E is the IPv6 global-scoped zone.
[Table 1](#_Ref141616568) lists the possible values of the scope field. 

Table 1 Values of the Scope field

| Value | Meaning | Remarks |
| --- | --- | --- |
| 0, F | Reserved | N/A || 1 | Interface-local scope | N/A || 2 | Link-local scope | N/A || 3 | Subnet-local scope | IPv6 admin-scoped zone. || 4 | Admin-local scope | IPv6 admin-scoped zone. || 5 | Site-local scope | IPv6 admin-scoped zone. || 6, 7, 9 through D | Unassigned | IPv6 admin-scoped zone. || 8 | Organization-local scope | IPv6 admin-scoped zone. || E | Global scope | IPv6 global-scoped zone. |









 

## IPv6 PIM-SSM

The ASM model includes IPv6 PIM-DM and IPv6
PIM-SM. The SSM model can be implemented by leveraging part of the IPv6 PIM-SM
technique. It is also called "IPv6 PIM-SSM."

The SSM model provides a solution for
source-specific multicast. It maintains the relationship between hosts and devices
through MLDv2.

In actual applications, part of MLDv2 and IPv6
PIM-SM techniques are adopted to implement the SSM model. In the SSM model, because
receivers have located an IPv6 multicast source, no RP or RPT is required. No
source registration process is required for discovering IPv6 multicast sources
in other IPv6 PIM domains.

IPv6 PIM-SSM mechanisms include neighbor
discovery, DR election, and SPT building.

### Neighbor discovery

IPv6 PIM-SSM uses the same neighbor
discovery mechanism as IPv6 PIM-SM. For more information, see "[Neighbor discovery](#_Ref160955222)."

### DR election

IPv6 PIM-SSM uses the same DR election
mechanism as IPv6 PIM-SM. For more information, see "[DR election](#_Ref320027017)."

### SPT building

The decision to build an RPT for IPv6 PIM-SM
or an SPT for IPv6 PIM-SSM depends on whether the IPv6 multicast group that the
receiver host joins is in the IPv6 SSM group range. The IPv6 SSM group range
reserved by IANA is FF3x::/32, where "x" represents any legal address
scope.

Figure 14 SPT building in IPv6 PIM-SSM

![](https://resource.h3c.com/en/202407/12/20240712_11705052_x_Img_x_png_15_2216043_294551_0.png)

 

As shown in [Figure 14](#_Ref206410671), Host
B and Host C are receivers. They send MLDv2 report messages to their DRs to
express their interest in the multicast information that the IPv6 multicast
source S sends to the IPv6 multicast group G. 

After receiving a report message, the DR
first checks whether the group address in the message is in the IPv6 SSM group range
and does the following:

·     If the group address is in the IPv6 SSM group
range, the DR sends a subscribe message hop by hop toward the IPv6 multicast
source S. All devices along the path from the DR to the IPv6 multicast source
create an (S, G) entry to build an SPT. The SPT is rooted the IPv6 multicast
source S and has the receivers as its leaves. This SPT is the transmission
channel in IPv6 PIM-SSM.

·     If the group address is not in the IPv6 SSM
group range, the receiver-side DR sends a (\*, G) join message to the RP. The IPv6
multicast source registers with the source-side DR.

In IPv6 PIM-SSM, the term "subscribe message" refers to a join message.

## Relationship among IPv6 PIM protocols

In an IPv6 PIM network, IPv6 PIM-DM cannot run
together with IPv6 PIM-SM, IPv6 BIDIR-PIM, or IPv6 PIM-SSM. However, IPv6
PIM-SM, IPv6 BIDIR-PIM, and IPv6 PIM-SSM can run together. [Figure 15](#_Ref319506590) shows
how the device selects one protocol from among them for a receiver trying to
join a group.

For more information about MLD SSM mapping,
see "Configuring MLD."

Figure 15 Relationship among IPv6 PIM protocols

![](https://resource.h3c.com/en/202407/12/20240712_11705053_x_Img_x_png_16_2216043_294551_0.png)

 

## M-LAG for Layer 3 IPv6 multicast

On a Layer 3 IPv6 multicast network that
supports multichassis link aggregation (M-LAG), M-LAG virtualizes two physical
devices into one system, which connects to a remote aggregation system and then
to a multicast source or multicast receivers. This avoids multicast
interruption caused by a single point of failure and improves the reliability
of the multicast network. For more information about M-LAG, see M-LAG configuration
in Layer 2—LAN Switching Configuration Guide.

M-LAG for Layer 3 multicast can be
implemented through multicast source-connected M-LAG or multicast
receiver-connected M-LAG.

### Multicast source-connectedM-LAG

As shown in [Figure 16](#_Ref45118019), the peer
link of the M-LAG system is established between M-LAG member devices (Switch A
and Switch B), which are connected to the remote aggregation system (Switch C).
Switch C is connected to the multicast source. The peer link and M-LAG
interfaces belong to the same VLAN. 

Figure 16 Multicast source-connectedM-LAG

![](https://resource.h3c.com/en/202407/12/20240712_11705054_x_Img_x_png_17_2216043_294551_0.png)

 

The following describes the forwarding
process of multicast traffic in the Layer 3 multicast network:

**1\.**The multicast source sends multicast data of
a multicast group.

**2\.**Switch C distributes the multicast data to
the M-LAG interfaces.

**3\.**Switch A and Switch B each forwards the received
multicast data to the peer. In this way, both Switch A and Switch B receive the
complete multicast data from the multicast source.

**4\.**Based on the PIM configuration, Switch A and
Switch B choose one of the following methods to forward the multicast data to
the multicast receiver:

¡     Switch
A alone forwards the multicast data.

¡     Switch
B alone forwards the multicast data.

¡     Switch
A and Switch B load balance the multicast data. In this example, this method is
used.

### Multicast receiver-connectedM-LAG

As shown in [Figure 17](#_Ref45118757), the peer
link of the M-LAG system is established between M-LAG member devices (Switch A
and Switch B), which are connected to the remote aggregation system (Switch C).
Switch C is connected to a multicast receiver. MLD and IPv6 PIM passive mode
are configured on the M-LAG interfaces of Switch A and Switch B.

Figure 17 Multicast source-connectedM-LAG

![](https://resource.h3c.com/en/202407/12/20240712_11705055_x_Img_x_png_18_2216043_294551_0.png)

 

The following describes the forwarding
process of multicast traffic in the Layer 3 multicast network:

**1\.**The multicast receiver sends an IGMP report
to join a multicast group.

**2\.**Switch A or Switch B whoever receives the MLD
report sends the report to the peer over the peer link. In this way, Switch A
and Switch B maintain the same MLD group memberships.

**3\.**When the multicast source sends multicast
data of the multicast group to the M-LAG system, IPv6 PIM passive mode ensures that
both Switch A and Switch B receive the complete multicast data.

**4\.**The M-LAG system distributes the multicast
data to Switch A and Switch B. The multicast data is forwarded out of the M-LAG
interfaces. 

**5\.**Switch C forwards the multicast data to the
multicast receiver.

## Protocols and standards

·     RFC 3973, Protocol
Independent Multicast-Dense Mode (PIM-DM): Protocol Specification(Revised)

·     RFC 4601, Protocol
Independent Multicast-Sparse Mode (PIM-SM): Protocol Specification (Revised)

·     RFC 4610, Anycast-RP
Using Protocol Independent Multicast (PIM)

·     RFC 3956, Embedding the
Rendezvous Point (RP) Address in an IPv6 Multicast Address

·     RFC 5015, Bidirectional
Protocol Independent Multicast (BIDIR-PIM)

·     RFC 5059, Bootstrap
Router (BSR) Mechanism for Protocol Independent Multicast (PIM)

·     RFC 4607, Source-Specific
Multicast for IP

·     Draft-ietf-ssm-overview-05, An Overview of Source-Specific Multicast (SSM)

