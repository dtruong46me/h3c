
# PIM overview

Protocol Independent Multicast (PIM)
provides IP multicast forwarding by leveraging unicast static routes or unicast
routing tables generated by any unicast routing protocol. PIM uses the
underlying unicast routing to generate a multicast routing table without
relying on any particular unicast routing protocol. PIM uses the RPF mechanism
to implement multicast forwarding. For more information about RPF, see
"Configuring multicast routing and forwarding."

## PIM modes

Based on the implementation mechanism, PIM includes
the following modes:

·     Protocol Independent Multicast–Dense Mode
(PIM-DM).

·     Protocol Independent Multicast–Sparse Mode
(PIM-SM).

·     Bidirectional Protocol Independent Multicast
(BIDIR-PIM).

·     Protocol Independent Multicast Source-Specific
Multicast (PIM-SSM).

In this document, a PIM domain refers to a
network that contains PIM devices. 

## PIM-DM

PIM-DM uses the push mode for multicast
forwarding, and is suitable for small-sized networks with densely distributed
multicast members.

PIM-DM assumes that all downstream nodes want
to receive multicast data from a source, so multicast data is flooded to all downstream
nodes on the network. Branches without downstream receivers are pruned from the
forwarding trees. When a pruned branch has new receivers, the graft mechanism
turns the pruned branch into a forwarding branch.

In PIM-DM, the multicast forwarding paths for
a multicast group constitutes a forwarding tree. The forwarding tree is rooted
at the multicast source and has multicast group members as its
"leaves." Because the forwarding tree consists of the shortest paths
from the multicast source to the receivers, it is also called a "shortest
path tree (SPT)."

PIM-DM mechanisms include neighbor
discovery, SPT building, graft, and assert.

### Neighbor discovery

In a PIM domain, each PIM interface on a device
periodically multicasts PIM hello messages to all other PIM devices (identified
by the address 224.0.0.13) on the local subnet. Through the exchanging of hello
messages, all PIM devices on the subnet determine their PIM neighbors, maintain
PIM neighboring relationship with other devices, and build and maintain SPTs.

### SPT building

The process of building an SPT is the
flood-and-prune process: 

**1\.**In a PIM-DM domain, the multicast data from
the multicast source S to the multicast group G is flooded throughout the
domain. A device performs an RPF check on the multicast data. If the RPF check
succeeds, the device creates an (S, G) entry and forwards the data to all
downstream nodes on the network. In the flooding process, all the devices in
the PIM-DM domain create the (S, G) entry.

**2\.**The nodes without downstream receivers are
pruned. A device that has no downstream receivers multicasts a prune message to
all PIM devices on the subnet. When an upstream node receives the prune
message, it removes the receiving interface from the (S, G) entry. In this way,
the upstream stream node stops forwarding subsequent packets addressed to that
multicast group down to this node.

 

|  | NOTE:  An (S, G) entry contains a multicast source address S, a multicast group address G, an outgoing interface list, and an incoming interface. |
| --- | --- |

‌

A prune process is initiated by a leaf device.
As shown in [Figure 1](#_Ref206410272), the device interface that does not have any downstream receivers initiates
a prune process by sending a prune message toward the multicast source. This
prune process goes on until only necessary branches are left in the PIM-DM
domain, and these necessary branches constitute an SPT. 

Figure 1 SPT building

![](https://resource.h3c.com/en/202407/12/20240712_11704974_x_Img_x_png_0_2216036_294551_0.png)

‌

The pruned state of a branch has a finite holdtime
timer. When the timer expires, multicast data is again forwarded to the pruned
branch. The flood-and-prune cycle takes place periodically to maintain the
forwarding branches.

### Graft

A previously pruned branch might have new
downstream receivers. To reduce the latency for resuming the forwarding
capability of this branch, a graft mechanism is used as follows:

**1\.**The node that needs to receive the multicast
data sends a graft message to its upstream node, telling it to rejoin the SPT. 

**2\.**After receiving this graft message on an
interface, the upstream node adds the receiving interface to the outgoing
interface list of the (S, G) entry. It also sends a graft-ack message to the
graft sender. 

**3\.**If the graft sender receives a graft-ack
message, the graft process finishes. Otherwise, the graft sender continues to
send graft messages at a graft retry interval until it receives an acknowledgment
from its upstream node.

### Assert

On a subnet with more than one multicast device,
the assert mechanism shuts off duplicate multicast flows to the network. It
does this by electing a unique multicast forwarder for the subnet.

Figure 2 Assert mechanism

![](https://resource.h3c.com/en/202407/12/20240712_11704975_x_Img_x_png_1_2216036_294551_0.png)

‌

As shown in [Figure 2](#_Ref206410575), after
Device A and Device B receive an (S, G) packet from the upstream node, they
both forward the packet to the local subnet. As a result, the downstream node Device
C receives two identical multicast packets. In addition, both Device A and Device
B, on their downstream interfaces, receive a duplicate packet forwarded by the
other. After detecting this condition, both devices send an assert message to
all PIM devices (224.0.0.13) on the local subnet through the interface that
received the packet. The assert message contains the multicast source address
(S), the multicast group address (G), and the metric preference and metric of
the unicast route/MBGP route/static multicast route to the multicast source. By
comparing these parameters, either Device A or Device B becomes the unique
forwarder of the subsequent (S, G) packets on the shared-media LAN. The
comparison process is as follows:

**1\.**The device with a higher metric preference
to the multicast source wins. 

**2\.**If both devices have the same metric preference,
the device with a smaller metric wins.

**3\.**If both devices have the same metric, the device
with a higher IP address on the downstream interface wins.

## PIM-SM

PIM-DM uses the flood-and-prune cycles to
build SPTs for multicast data forwarding. Although an SPT has the shortest paths
from the multicast source to the receivers, it is built with a low efficiency.
Therefore, PIM-DM is not suitable for large and medium-sized networks. PIM-SM
uses the pull mode for multicast forwarding, and it is suitable for large- and
medium-sized networks with sparsely and widely distributed multicast group
members. 

PIM-SM assumes that no hosts need multicast
data. A multicast receiver must express its interest in the multicast data for
a multicast group before the data is forwarded to it. A rendezvous point (RP)
is the core of a PIM-SM domain. Relying on the RP, SPTs and rendezvous point
trees (RPTs) are established and maintained to implement multicast data
forwarding. An SPT is rooted at the multicast source and has the RPs as its
leaves. An RPT is rooted at the RP and has the receiver hosts as its leaves.

PIM-SM mechanisms include neighbor
discovery, DR election, RP discovery, Anycast RP, RPT building, multicast
source registration, switchover to SPT, and assert.

### Neighbor discovery

PIM-SM uses the
same neighbor discovery mechanism as PIM-DM does. For more information, see
"[Neighbor discovery](#_Ref160955222)." 

### DRelection

A designated router (DR) is required on both
the source-side network and receiver-side network. A source-side DR acts on
behalf of the multicast source to send register messages to the RP. The
receiver-side DR acts on behalf of the multicast receivers to send join
messages to the RP. 

PIM-DM does not require a DR. However, if
IGMPv1 runs on any shared-media LAN in a PIM-DM domain, a DR must be elected to
act as the IGMPv1 querier for the LAN. For more information about IGMP, see
"Configuring IGMP."

 

| IMPORTANT | IMPORTANT:  IGMP must be enabled on the device that acts as the receiver-side DR. Otherwise, the receiver hosts attached to the DR cannot join any multicast groups. |
| --- | --- |

‌

Figure 3 DR election

![](https://resource.h3c.com/en/202407/12/20240712_11704993_x_Img_x_png_3_2216036_294551_0.png)

‌

As shown in [Figure 3](#_Ref89263906), the DR
election process is as follows:

**1\.**The devices on the shared-media LAN send
hello messages to one another. The hello messages contain the DR priority for
DR election. The device with the highest DR priority is elected as the DR.

**2\.**The device with the highest IP address wins
the DR election under one of following conditions:

¡     All
the devices have the same DR election priority.

¡     A device
does not support carrying the DR priority in hello messages.

If the DR fails, its PIM neighbor lifetime
expires and the other devices will initiate to elect a new DR.

### RP discovery

An RP is the core of a PIM-SM domain. A
multicast group can have only one RP for multicast forwarding, and an RP can be
designated to multiple multicast groups. 

#### RP selection

An RP can be statically configured or
dynamically elected. The priorities of the static RP and the dynamic RP depend
on whether the static RP is preferred when the static RP is configured.

·     If the static RP is preferred, the static RP
takes precedence over the dynamic RP. The dynamic RP takes services over only
when the static RP fails.

·     If the static RP is not preferred, the dynamic
RP takes precedence over the static RP. The static RP takes services over only
when the dynamic RP fails.

#### Static RPs

A static RP can avoid a single point of
failure and save network bandwidth that is consumed by frequent communications
between C-RPs and the BSR.

#### Dynamic RP election

Dynamic RP election is implemented through
the BSR mechanism. BSR mechanism includes the following roles:

·     Candidate-RPs (C-RPs)—An RP is dynamically elected from C-RPs to provide services to a
multicast group.

·     BSR—A BSR is the core of the administrative core of the PIM-SM domain. It
is responsible for collecting and advertising RP information in the whole domain.
A PIM-SM domain has only one BSR, and the BSR is elected from C-BSRs.

·     Candidate-BSRs (C-BSRs)—Any devices in the PIM-SM domain can act as C-BSRs and the BSR is
elected from the C-BSRs. Once the BSR fails, a new BSR is elected from the
C-BSRs to avoid multicast traffic interruption.

Figure 4 Information exchange between C-RPs
and BSR

![](https://resource.h3c.com/en/202407/12/20240712_11704994_x_Img_x_png_4_2216036_294551_0.png)

‌

As shown in [Figure 4](#_Ref458427852), an RP
is elected as follows:

**1\.**Each C-BSR sends a bootstrap message (BSM)
to other devices in the PIM-SM domain. 

**2\.**When a C-BSR receives a BSM from another
C-BSR, it compares its own priority with the priority carried in the message. The
C-BSR with a higher priority wins the BSR election. If a tie exists in the
priority, the C-BSR with a higher IP address wins. The loser uses the winner's
BSR address to replace its own BSR address and no longer regards itself as the
BSR. The winner retains its own BSR address and continues to regard itself as
the BSR.

**3\.**Each C-RP periodically unicasts an
advertisement message to the BSR. An advertisement message contains the address
of the advertising C-RP and the multicast group range to which it is designated.

**4\.**The BSR collects these advertisement
messages and organizes the C-RP information into an RP-set, which is a database
of mappings between multicast groups and RPs. The BSR encapsulates the RP-set
information in the bootstrap messages (BSMs) and floods the BSMs to the entire
PIM-SM domain.

**5\.**All devices in the PIM-SM domain select an
RP for a multicast group based on the following rules:

**a.**The C-RP that is designated to the smallest multicast
group range wins.

**b.**If the C-RPs are designated to the same
group ranges, the C-RP with the highest priority wins.

**c.**If the C-RPs have the same priority, the
C-RP with the largest hash value wins. The hash value is calculated through the
hash algorithm.

**d.**If the C-RPs have the same hash value, the
C-RP with the highest IP address wins.

### Anycast RP

PIM-SM requires only one active RP to serve
each multicast group. If the active RP fails, the multicast traffic might be interrupted.
The Anycast RP mechanism enables redundancy backup among RPs by configuring
multiple RPs with the same IP address. A multicast source registers with the closest
RP or a receiver joins the closest RP to implement source information
synchronization.

Anycast RP has the following benefits:

·     Optimal RP path—A multicast source registers with the closest RP to build an optimal
SPT. A receiver joins the closest RP to build an optimal RPT.

·     Redundancy backup among RPs—When an RP fails, the RP-related sources will register with the
closest available RPs and the receiver-side DRs will join the closest available
RPs. This provides redundancy backup among RPs.

Anycast RP is implemented in either of the
following methods:

·     Anycast RP through MSDP—In this method, you can configure multiple RPs with the same IP
address for one multicast group and configure MSDP peering relationships
between them. For more information about Anycast RP through MSDP, see
"Configuring MSDP."

·     Anycast RP through PIM-SM—In this method, you can configure multiple RPs for one multicast
group and add them to an Anycast RP set. This method introduces the following
concepts:

¡     Anycast RP set—A set of RPs that are
designated to the same multicast group.

¡     Anycast RP member—Each RP in the
Anycast RP set.

¡     Anycast RP member address—IP address
of each Anycast RP member for communication among the RP members.

¡     Anycast RP address—IP address of the
Anycast RP set for communication within the PIM-SM domain. It is also known as
RPA.

As shown in [Figure 5](#_Ref365015504), RP 1,
RP 2, and RP 3 are members of an Anycast RP set.

Figure 5 Anycast
RP through PIM-SM

![](https://resource.h3c.com/en/202407/12/20240712_11704995_x_Img_x_png_5_2216036_294551_0.png)

‌

The following describes how Anycast RP
through PIM-SM is implemented:

**a.**RP 1 receives a register message destined to
RPA. Because the message is not from other Anycast RP members (RP 2 or RP 3),
RP 1 considers that the register message is from the DR. RP 1 changes the
source IP address of the register message to its own address and sends the
message to the other members (RP 2 and RP 3). 

If a device acts as both a DR and an RP, it
creates a register message, and then forwards the message to the other RP members.

**b.**After receiving the register message, RP 2
and RP 3 find out that the source address of the register message is an Anycast
RP member address. They stop forwarding the message to other devices.

In Anycast RP implementation, an RP must
forward the register message from the DR to other Anycast RP members to synchronize
multicast source information.

### RPT building

Figure 6 RPT building in a PIM-SM domain

![](https://resource.h3c.com/en/202407/12/20240712_11704996_x_Img_x_png_6_2216036_294551_0.png)

‌

As shown in [Figure 6](#_Ref206410607), the
process of building an RPT is as follows:

**1\.**When a receiver wants to join the multicast
group G, it uses an IGMP message to inform the receiver-side DR.

**2\.**After getting the receiver information, the
DR sends a join message, which travels hop by hop to the RP for the multicast
group.

**3\.**The devices along the path from the DR to
the RP form an RPT branch. Each device on this branch adds to its forwarding
table a (\*, G) entry, where the asterisk (\*) represents any multicast source.
The RP is the root of the RPT, and the DR is a leaf of the RPT.

When the multicast data addressed to the
multicast group G reaches the RP, the RP forwards the data to the DR along the
established RPT, and finally to the receiver.

When a receiver is no longer interested in
the multicast data addressed to the multicast group G, the receiver-side DR
sends a prune message. The prune message goes hop by hop along the RPT to the
RP. After receiving the prune message, the upstream node deletes the interface that
connects to this downstream node from the outgoing interface list. At the same
time, the upstream device checks for the existence of receivers for that
multicast group. If no receivers for the multicast group exist, the device
continues to forward the prune message to its upstream device.

### Multicast source registration

The multicast source uses the registration process
to inform an RP of its presence.

Figure 7 Multicast source registration

![](https://resource.h3c.com/en/202407/12/20240712_11704997_x_Img_x_png_7_2216036_294551_0.png)

‌

As shown in [Figure 7](#_Ref206410623), the
multicast source registers with the RP as follows:

**1\.**The multicast source S sends the first
multicast packet to the multicast group G. When receiving the multicast packet,
the source-side DR encapsulates the packet into a PIM register message and unicasts
the message to the RP.

**2\.**After the RP receives the register message,
it decapsulates the register message and forwards the register message down to the
RPT. Meanwhile, it sends an (S, G) source-specific join message toward the
multicast source. The devices along the path from the RP to the multicast
source constitute an SPT branch. Each device on this branch creates an (S, G)
entry in its forwarding table.

**3\.**The subsequent multicast data from the
multicast source are forwarded to the RP along the established SPT. When the
multicast data reaches the RP along the SPT, the RP forwards the data to the
receivers along the RPT. Meanwhile, it unicasts a register-stop message to the
source-side DR to prevent the DR from unnecessarily encapsulating the data. 

### Switchover to SPT

This section takes a router as an example. As
compared with the switchover to SPT on a router, switchover to SPT is
implemented in a simpler way on a switch.

In a PIM-SM domain, only one RP and one RPT
provide services for a specific multicast group. Before the switchover to SPT
occurs, the source-side DR encapsulates all multicast data in register messages
and sends them to the RP. After receiving these register messages, the RP decapsulates
them and forwards them to the receiver-side DR along the RPT.

Multicast forwarding along the RPT has the following
weaknesses: 

·     Encapsulation and decapsulation are complex on the
source-side DR and the RP. 

·     The path for a multicast packet might not be the
shortest one.

·     The RP might be overloaded by multicast traffic bursts.

To eliminate these weaknesses, PIM-SM
allows an RP or the receiver-side DR to initiate the switchover to SPT when the
RP or DR receives multicast traffic.

·     The RP initiates the switchover to SPT:

If the RP receives multicast traffic, it
sends an (S, G) source-specific join message toward the multicast source. The
routers along the path from the RP to the multicast source constitute an SPT. The
subsequent multicast data is forwarded to the RP along the SPT without being
encapsulated into register messages.

For more information about the switchover
to SPT initiated by the RP, see "[Multicast source registration](#_Ref217376882)." 

·     The receiver-side DR initiates the switchover to
SPT:

If the receiver-side DR receives
multicast traffic, it initiates the switchover to SPT as follows: 

**a.**The receiver-side DR sends an (S, G) source-specific
join message toward the multicast source. The routers along the path create an
(S, G) entry in their forwarding table to constitute an SPT branch.

**b.**When the multicast packets reach the router
where the RPT and the SPT branches, the router drops the multicast packets that
travel along the RPT. It then sends a prune message with the RP bit toward the
RP.

**c.**After receiving the prune message, the RP forwards
it toward the multicast source (supposed only one receiver exists). Thus, the
switchover to SPT is completed. The subsequent multicast packets travel along
the SPT from the multicast source to the receiver hosts. 

With the switchover to SPT, PIM-SM builds
SPTs more economically than PIM-DM does.

### Assert

PIM-SM uses a similar assert mechanism as
PIM-DM does. For more information, see "[Assert](#_Ref160955347)."

## BIDIR-PIM

In some many-to-many applications, such as a
multi-side video conference, multiple receivers of a multicast group might be interested
in the multicast data from multiple multicast sources. With PIM-DM or PIM-SM,
each device along the SPT must create an (S, G) entry for each multicast
source, consuming a lot of system resources. 

BIDIR-PIM addresses the problem. Derived
from PIM-SM, BIDIR-PIM builds and maintains a bidirectional RPT, which is
rooted at the RP and connects the multicast sources and the receivers. Along the
bidirectional RPT, the multicast sources send multicast data to the RP, and the
RP forwards the data to the receivers. Each device along the bidirectional RPT needs
to maintain only one (\*, G) entry, saving system resources.

BIDIR-PIM is suitable for a network with
dense multicast sources and receivers.

BIDIR-PIM mechanisms include neighbor
discovery, RP discovery, DF election, and bidirectional RPT building.

### Neighbor discovery

BIDIR-PIM uses the same neighbor discovery
mechanism as PIM-SM does. For more information, see "[Neighbor discovery](#_Ref319503826)."

### RP discovery

BIDIR-PIM uses the same RP discovery
mechanism as PIM-SM does. For more information, see "[RP discovery](#_Ref274580045)."
In BIDIR-PIM, an RPF interface is the interface toward an RP, and an RPF
neighbor is the address of the next hop to the RP. 

### DF election

On a subnet with multiple multicast devices,
duplicate multicast packets might be forwarded to the RP. To address this
issue, BIDIR-PIM uses a designated forwarder (DF) election mechanism to elect a
unique DF for each RP on a subnet. Only the DFs can forward multicast data to
the RP. 

DF election is not necessary for an RPL.

Figure 8 DF election

![](https://resource.h3c.com/en/202407/12/20240712_11704998_x_Img_x_png_8_2216036_294551_0.png)

‌

As shown in [Figure 8](#_Ref319503631),
without the DF election mechanism, both Device B and Device C can receive
multicast packets from Route A. They also can forward the packets to downstream
devices on the local subnet. As a result, the RP (Device E) receives duplicate
multicast packets. 

With the DF election mechanism, once receiving
the RP information, Device B and Device C multicast a DF election message to
all PIM devices (224.0.0.13) to initiate a DF election process. The election
message carries the RP's address, and the route preference and the metric of
the unicast route or static multicast route to the RP. A DF is elected as
follows:

**1\.**The device with a higher route preference
becomes the DF. 

**2\.**If the devices have the same route
preference, the device with a lower metric becomes the DF.

**3\.**If the devices have the same metric, the device
with a higher IP address becomes the DF.

### Bidirectional RPT building

A bidirectional RPT
comprises a receiver-side RPT and a source-side RPT. The receiver-side RPT is
rooted at the RP and takes the devices that directly connect to the receivers as
leaves. The source-side RPT is also rooted at the RP but takes the devices that
directly connect to the sources as leaves. The processes for building these two
RPTs are different.

Figure 9 RPT building at the receiver side

![](https://resource.h3c.com/en/202407/12/20240712_11704999_x_Img_x_png_9_2216036_294551_0.png)

‌

As shown in [Figure 9](#_Ref319503646), the
process for building a receiver-side RPT is the same as the process for
building an RPT in PIM-SM:

**1\.**When a receiver wants to join the multicast
group G, it uses an IGMP message to inform the directly connected device.

**2\.**After receiving the message, the device
sends a join message, which is forwarded hop by hop to the RP for the multicast
group.

**3\.**The devices along the path from the
receiver's directly connected device to the RP form an RPT branch. Each device
on this branch adds a (\*, G) entry to its forwarding table. 

After a receiver host leaves the multicast
group G, the directly connected device multicasts a prune message to all PIM devices
on the subnet. The prune message goes hop by hop along the reverse direction of
the RPT to the RP. After receiving the prune message, an upstream node removes
the interface that connects to the downstream node from the outgoing interface
list. At the same time, the upstream device checks the existence of receivers
for that multicast group. If no receivers for the multicast group exist, the device
continues to forward the prune message to its upstream device.

Figure 10 RPT building at the multicast
source side

![](https://resource.h3c.com/en/202407/12/20240712_11704976_x_Img_x_png_10_2216036_294551_0.png)

‌

As shown in [Figure 10](#_Ref264545011), the
process for building a source-side RPT is relatively simple:

**1\.**When a multicast source sends multicast
packets to the multicast group G, the DF in each subnet unconditionally
forwards the packets to the RP.

**2\.**The devices along the path from the source's
directly connected device to the RP constitute an RPT branch. Each device on
this branch adds to its forwarding table a (\*, G) entry.

After a bidirectional RPT is built, the
multicast sources send multicast traffic to the RP along the source-side RPT.
Then, the RP forwards the traffic to the receivers along the receiver-side RPT.

 

| IMPORTANT | IMPORTANT:  If a receiver and a multicast source are at the same side of the RP, the source-side RPT and the receiver-side RPT might meet at a node before reaching the RP. In this case, the multicast packets from the multicast source to the receiver are directly forwarded by the node, instead of by the RP. |
| --- | --- |

‌

## Administrative scoping

Typically, a PIM-SM domain or a BIDIR-PIM
domain contains only one BSR, which is responsible for advertising RP-set
information within the entire domain. The information about all multicast
groups is forwarded within the network that the BSR administers. This is called
the "non-scoped BSR mechanism."

### Administrative scoping mechanism

To implement refined management, you can
divide a PIM-SM domain or BIDIR-PIM domain into a global-scoped zone and
multiple administratively-scoped zones (admin-scoped zones). This is called the
"administrative scoping mechanism."

The administrative scoping mechanism
effectively releases stress on the management in a single-BSR domain and
enables provision of zone-specific services through private group addresses.

Admin-scoped zones are divided for multicast
groups. Zone border devices (ZBRs) form the boundary of an admin-scoped zone.
Each admin-scoped zone maintains one BSR for multicast groups within a specific
range. Multicast protocol packets, such as assert messages and BSMs, for a
specific group range cannot cross the boundary of the admin-scoped zone for the
group range. Multicast group ranges that are associated with different
admin-scoped zones can have intersections. However, the multicast groups in an admin-scoped
zone are valid only within the local zone, and theses multicast groups are
regarded as private group addresses. 

The global-scoped zone maintains a BSR for
the multicast groups that do not belong to any admin-scoped zones.

### Relationship between admin-scoped zones and the global-scoped zone

The global-scoped zone and each admin-scoped
zone have their own C-RPs and BSRs. These devices are effective only on their
respective zones, and the BSR election and the RP election are implemented
independently. Each admin-scoped zone has its own boundary. The multicast
information within a zone cannot cross this boundary in either direction. You
can have a better understanding of the global-scoped zone and admin-scoped zones
based on geographical locations and multicast group address ranges.

·     In view of geographical locations: 

An admin-scoped zone is a logical zone for
particular multicast groups. The multicast packets for such multicast groups
are confined within the local admin-scoped zone and cannot cross the boundary
of the zone. 

Figure 11 Relationship
in view of geographical locations

![](https://resource.h3c.com/en/202407/12/20240712_11704978_x_Img_x_png_12_2216036_294551_0.png)

‌

As shown in [Figure 11](#_Ref319503664), for the
multicast groups in a specific group address range, the admin-scoped zones must
be geographically separated and isolated. A device cannot belong to multiple admin-scoped
zones. An admin-scoped zone cannot contain a device that belongs to any other admin-scoped
zone. However, the global-scoped zone includes all devices in the PIM-SM domain
or BIDIR-PIM domain. Multicast packets that do not belong to any admin-scoped
zones are forwarded in the entire PIM-SM domain or BIDIR-PIM domain.

·     In view of multicast group address ranges:

Each admin-scoped zone is designated to
specific multicast groups, of which the multicast group addresses are valid
only within the local zone. The multicast groups of different admin-scoped
zones might have intersections. All the multicast groups other than those of the
admin-scoped zones use the global-scoped zone. 

Figure 12 Relationship
in view of multicast group address ranges

![](https://resource.h3c.com/en/202407/12/20240712_11704979_x_Img_x_png_13_2216036_294551_0.png)

‌

As shown in [Figure 12](#_Ref319503680), the admin-scoped
zones 1 and 2 have no intersection, but the admin-scoped zone 3 is a subset of the
admin-scoped zone 1\. The global-scoped zone provides services for all the
multicast groups that are not covered by the admin-scoped zones 1 and 2, G—G1—G2
in this case.

## PIM-SSM

The ASM model includes PIM-DM and PIM-SM.
The SSM model can be implemented by leveraging part of the PIM-SM technique. It
is also called "PIM-SSM."

The SSM model provides a solution for
source-specific multicast. It maintains the relationship between hosts and devices
through IGMPv3.

In actual applications, part of IGMPv3 and
PIM-SM techniques are adopted to implement the SSM model. In the SSM model,
because receivers have located a multicast source, no RP or RPT is required.
Multicast sources do not register with the RP, and the MSDP is not needed for
discovering multicast sources in other PIM domains.

PIM-SSM mechanisms include neighbor
discovery, DR election, and SPT building.

### Neighbor discovery

PIM-SSM uses the same neighbor discovery
mechanism as PIM-SM. For more information, see "[Neighbor discovery](#_Ref160955222)."

### DR election

PIM-SSM uses the same DR election mechanism
as PIM-SM. For more information, see "[DR election](#_Ref319914253)."

### SPT building

The decision to build an RPT for PIM-SM or
an SPT for PIM-SSM depends on whether the multicast group that the receiver
joins is in the SSM group range. The SSM group range reserved by IANA is
232.0.0.0/8.

Figure 13 SPT building in PIM-SSM

![](https://resource.h3c.com/en/202407/12/20240712_11704980_x_Img_x_png_14_2216036_294551_0.png)

‌

As shown in [Figure 13](#_Ref206410671), Host
B and Host C are receivers. They send IGMPv3 report messages to their DRs to
express their interest in the multicast information that the multicast source S
sends to the multicast group G. 

After receiving a report message, the DR
first checks whether the group address in this message is in the SSM group
range and does the following:

·     If the group address is in the SSM group range,
the DR sends a subscribe message hop by hop toward the multicast source S. All devices
along the path from the DR to the source create an (S, G) entry to build an SPT.
The SPT is rooted at the multicast source S and has the receivers as its
leaves. This SPT is the transmission channel in PIM-SSM.

·     If the group address is not in the SSM group
range, the receiver-side DR sends a (\*, G) join message to the RP. The
multicast source registers with the source-side DR.

In PIM-SSM, the term "subscribe message" refers to a join message.

## Relationship among PIM protocols

In a PIM network, PIM-DM cannot run together
with PIM-SM, BIDIR-PIM, or PIM-SSM. However, PIM-SM, BIDIR-PIM, and PIM-SSM can
run together. [Figure 14](#_Ref319503694) shows how the device selects one protocol from among them for a
receiver trying to join a group.

For more information about IGMP SSM mapping,
see "Configuring IGMP."

Figure 14 Relationship among PIM protocols

![](https://resource.h3c.com/en/202407/12/20240712_11704981_x_Img_x_png_15_2216036_294551_0.png)

‌

## PIM support for VPNs

To support PIM for VPNs, a multicast device
that runs PIM maintains an independent set of PIM neighbor table, multicast
routing table, BSR information, and RP-set information for each VPN.

After receiving a multicast data packet,
the multicast device checks which VPN the data packet belongs to. Then, the device
forwards the packet according to the multicast routing table for that VPN or
creates a multicast routing entry for that VPN.

## M-LAG for Layer 3 multicast

On a Layer 3 multicast network that
supports multichassis link aggregation (M-LAG) M-LAG virtualizes two physical
devices into one system, which connects to a remote aggregation system and then
to a multicast source or multicast receivers. This avoids multicast
interruption caused by a single point of failure and improves the reliability
of the multicast network. For more information about M-LAG, see M-LAG configuration
in Layer 2—LAN Switching Configuration Guide.

M-LAG for Layer 3 multicast can be
implemented through multicast source-connected M-LAG or multicast
receiver-connected M-LAG.

### Multicast source-connected M-LAG

As shown in [Figure 15](#_Ref45118019), the peer
link of the M-LAG system is established between M-LAG member devices (Switch A
and Switch B), which are connected to the remote aggregation system (Switch C).
Switch C is connected to the multicast source. The peer link and M-LAG
interfaces belong to the same VLAN. 

Figure 15 Multicast source-connectedM-LAG

![](https://resource.h3c.com/en/202407/12/20240712_11704982_x_Img_x_png_16_2216036_294551_0.png)

 

The following describes the forwarding
process of multicast traffic in the Layer 3 multicast network:

**1\.**The multicast source sends multicast data of
a multicast group.

**2\.**Switch C distributes the multicast data to the
M-LAG interfaces.

**3\.**Switch A and Switch B each forwards the received
multicast data to the peer. In this way, both Switch A and Switch B receive the
complete multicast data from the multicast source.

**4\.**Based on the PIM configuration, Switch A and
Switch B choose one of the following methods to forward the multicast data to
the multicast receiver:

¡     Switch
A alone forwards the multicast data.

¡     Switch
B alone forwards the multicast data.

¡     Switch
A and Switch B load balance the multicast data. In this example, this method is
used.

### Multicast receiver-connected M-LAG

As shown in [Figure 16](#_Ref45118757), the peer
link of the M-LAG system is established between M-LAG member devices (Switch A
and Switch B), which are connected to the remote aggregation system (Switch C).
Switch C is connected to a multicast receiver. IGMP and PIM passive mode are
configured on the M-LAG interfaces of Switch A and Switch B.

Figure 16 Multicast source-connectedM-LAG

![](https://resource.h3c.com/en/202407/12/20240712_11704983_x_Img_x_png_17_2216036_294551_0.png)

 

The following describes the forwarding
process of multicast traffic in the Layer 3 multicast network:

**1\.**The multicast receiver sends an IGMP report
to join a multicast group.

**2\.**Switch A or Switch B whoever receives the
IGMP report sends the report to the peer over the peer link. In this way,
Switch A and Switch B maintain the same IGMP group memberships.

**3\.**When the multicast source sends multicast data
of the multicast group to the M-LAG system, PIM passive mode ensures that both
Switch A and Switch B receive the complete multicast data.

**4\.**The M-LAG system distributes the multicast
data to Switch A and Switch B. The multicast data is forwarded out of the M-LAG
interfaces. 

**5\.**Switch C forwards the multicast data to the
multicast receiver.

## Protocols and standards

·     RFC 3973, Protocol
Independent Multicast-Dense Mode (PIM-DM): Protocol Specification(Revised)

·     RFC 4601, Protocol
Independent Multicast-Sparse Mode (PIM-SM): Protocol Specification (Revised)

·     RFC 4610, Anycast-RP
Using Protocol Independent Multicast (PIM)

·     RFC 5015, Bidirectional
Protocol Independent Multicast (BIDIR-PIM)

·     RFC 5059, Bootstrap
Router (BSR) Mechanism for Protocol Independent Multicast (PIM)

·     RFC 4607, Source-Specific
Multicast for IP

·     Draft-ietf-ssm-overview-05, An Overview of Source-Specific Multicast (SSM)

