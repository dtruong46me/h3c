
# Configuring AAA

## About AAA

### AAA implementation

Authentication, Authorization, and
Accounting (AAA) provides a uniform framework for implementing network access
management. This feature specifies the following security functions:

·     Authentication—Identifies users and verifies their validity.

·     Authorization—Grants different users different rights, and controls the users'
access to resources and services. For example, you can permit office users to
read and print files and prevent guests from accessing files on the device.

·     Accounting—Records network usage details of users, including the service type,
start time, and traffic. This function enables time-based and traffic-based
charging and user behavior auditing.

### AAA network diagram

AAA uses a client/server model. The client
runs on the access device, or the network access server (NAS), which
authenticates user identities and controls user access. The server maintains
user information centrally. See [Figure 1](#_Ref302113783).

Figure 1 AAA
networkdiagram

![](https://resource.h3c.com/en/202407/12/20240712_11705257_x_Img_x_png_0_2216062_294551_0.png)

 

To access networks or resources beyond the
NAS, a user sends its identity information to the NAS. The NAS transparently
passes the user information to AAA servers and waits for the authentication,
authorization, and accounting result. Based on the result, the NAS determines
whether to permit or deny the access request.

AAA has various implementations, including
HWTACACS, LDAP, and RADIUS. RADIUS is most often used.

You can use different servers to implement
different security functions. For example, you can use an HWTACACS server for
authentication and authorization, and use a RADIUS server for accounting.

You can choose the security functions
provided by AAA as needed. For example, if your company wants employees to be
authenticated before they access specific resources, you would deploy an
authentication server. If network usage information is needed, you would also
configure an accounting server.

The device performs dynamic password
authentication.

### RADIUS

Remote Authentication Dial-In User Service
(RADIUS) is a distributed information interaction protocol that uses a
client/server model. The protocol can protect networks against unauthorized
access and is often used in network environments that require both high
security and remote user access.

The RADIUS authorization process is
combined with the RADIUS authentication process, and user authorization
information is piggybacked in authentication responses. RADIUS uses UDP port
1812 for authentication and UDP port 1813 for accounting.

RADIUS was originally designed for dial-in
user access, and has been extended to support additional access methods, such
as Ethernet and ADSL.

#### Client/servermodel

The RADIUS client runs on the NASs located
throughout the network. It passes user information to RADIUS servers and acts
on the responses to, for example, reject or accept user access requests.

The RADIUS server runs on the computer or
workstation at the network center and maintains information related to user
authentication and network service access.

The RADIUS server operates using the
following process:

**1\.**Receives authentication, authorization, and
accounting requests from RADIUS clients.

**2\.**Performs user authentication, authorization,
or accounting.

**3\.**Returns user access control information (for
example, rejecting or accepting the user access request) to the clients.

The RADIUS server can also act as the
client of another RADIUS server to provide authentication proxy services.

The RADIUS server maintains the following
databases:

·     Users—Stores user information, such as the usernames, passwords, applied
protocols, and IP addresses.

·     Clients—Stores information about RADIUS clients, such as shared keys and IP
addresses.

·     Dictionary—Stores RADIUS protocol attributes and their values.

Figure 2 RADIUS server databases

![](https://resource.h3c.com/en/202407/12/20240712_11705258_x_Img_x_png_1_2216062_294551_0.png)

 

#### Information exchange security mechanism

The RADIUS client and server exchange
information between them with the help of shared keys, which are preconfigured
on the client and server. A RADIUS packet has a 16-byte field called
Authenticator. This field includes a signature generated by using the MD5
algorithm, the shared key, and some other information. The receiver of the
packet verifies the signature and accepts the packet only when the signature is
correct. This mechanism ensures the security of information exchanged between
the RADIUS client and server.

The shared keys are also used to encrypt
user passwords that are included in RADIUS packets.

#### User authentication methods

The RADIUS server supports multiple user
authentication methods, such as PAP, CHAP, and EAP.

#### Basic RADIUS packet exchange process

[Figure 3](#_Ref302122123) illustrates the interactions between a user host, the RADIUS
client, and the RADIUS server.

Figure 3 Basic
RADIUS packet exchange process

![](https://resource.h3c.com/en/202407/12/20240712_11705269_x_Img_x_png_2_2216062_294551_0.png)

 

RADIUS uses in the following workflow:

**1\.**The host sends a connection request that
includes the user's username and password to the RADIUS client.

**2\.**The RADIUS client sends an authentication
request (Access-Request) to the RADIUS server. The request includes the user's
password, which has been processed by the MD5 algorithm and shared key.

**3\.**The RADIUS server authenticates the username
and password. If the authentication succeeds, the server sends back an
Access-Accept packet that contains the user's authorization information. If the
authentication fails, the server returns an Access-Reject packet.

**4\.**The RADIUS client permits or denies the user
according to the authentication result. If the result permits the user, the
RADIUS client sends a start-accounting request (Accounting-Request) packet to
the RADIUS server.

**5\.**The RADIUS server returns an acknowledgment
(Accounting-Response) packet and starts accounting.

**6\.**The user accesses the network resources.

**7\.**The host requests the RADIUS client to tear
down the connection.

**8\.**The RADIUS client sends a stop-accounting
request (Accounting-Request) packet to the RADIUS server.

**9\.**The RADIUS server returns an acknowledgment
(Accounting-Response) and stops accounting for the user.

**10\.**The RADIUS client notifies the user of the
termination.

#### RADIUS packetformat

RADIUS uses UDP to transmit packets. The
protocol also uses a series of mechanisms to ensure smooth packet exchange
between the RADIUS server and the client. These mechanisms include the timer
mechanism, the retransmission mechanism, and the backup server mechanism.

Figure 4 RADIUS packet format

![](https://resource.h3c.com/en/202407/12/20240712_11705280_x_Img_x_png_3_2216062_294551_0.png)

 

Descriptions of the fields are as follows:

·     The Code field (1 byte long) indicates the type
of the RADIUS packet. [Table 1](#_Ref261342054)
gives the main values and their meanings.

Table 1 Main values of the Code field

| Code | Packet type | Description |
| --- | --- | --- |
| 1 | Access-Request | From the client to the server. A packet of this type includes user information for the server to authenticate the user. It must contain the User-Name attribute and can optionally contain the attributes of NAS-IP-Address, User-Password, and NAS-Port. || 2 | Access-Accept | From the server to the client. If all attribute values included in the Access-Request are acceptable, the authentication succeeds, and the server sends an Access-Accept response. || 3 | Access-Reject | From the server to the client. If any attribute value included in the Access-Request is unacceptable, the authentication fails, and the server sends an Access-Reject response. || 4 | Accounting-Request | From the client to the server. A packet of this type includes user information for the server to start or stop accounting for the user. The Acct-Status-Type attribute in the packet indicates whether to start or stop accounting. || 5 | Accounting-Response | From the server to the client. The server sends a packet of this type to notify the client that it has received the Accounting-Request and has successfully recorded the accounting information. |





 

·     The Identifier field (1 byte long) is used to
match response packets with request packets and to detect duplicate request
packets. The request and response packets of the same exchange process for the
same purpose (such as authentication or accounting) have the same identifier. 

·     The Length field (2 bytes long) indicates the
length of the entire packet (in bytes), including the Code, Identifier, Length,
Authenticator, and Attributes fields. Bytes beyond this length are considered
padding and are ignored by the receiver. If the length of a received packet is
less than this length, the packet is dropped.

·     The Authenticator field (16 bytes long) is used
to authenticate responses from the RADIUS server and to encrypt user passwords.
There are two types of authenticators: request authenticator and response
authenticator.

·     The Attributes field (variable in length)
includes authentication, authorization, and accounting information. This field
can contain multiple attributes, each with the following subfields:

¡     Type—Type of the attribute. 

¡     Length—Length of the attribute in
bytes, including the Type, Length, and Value subfields.

¡     Value—Value of the attribute. Its
format and content depend on the Type subfield.

#### Extended RADIUSattributes

The RADIUS protocol features excellent
extensibility. The Vendor-Specific attribute (attribute 26\) allows a vendor to
define extended attributes. The extended attributes can implement functions
that the standard RADIUS protocol does not provide.

A vendor can encapsulate multiple
subattributes in the TLV format in attribute 26 to provide extended functions.
As shown in [Figure 5](#_Ref261342189), a subattribute encapsulated in attribute 26 consists of the
following parts:

·     Vendor-ID—ID of the vendor. The most significant byte is 0\. The other three
bytes contains a code compliant to RFC 1700\.

·     Vendor-Type—Type of the subattribute.

·     Vendor-Length—Length of the subattribute.

·     Vendor-Data—Contents of the subattribute.

The device supports private RADIUS
subattributes with a vendor ID of 25506\. For more information, see "[Appendix C  RADIUS subattributes (vendor ID
25506\)](#_Ref454545686)."

Figure 5 Format of attribute 26

![](https://resource.h3c.com/en/202407/12/20240712_11705284_x_Img_x_png_4_2216062_294551_0.png)

 

### HWTACACS

HW Terminal Access
Controller Access Control System (HWTACACS) is an enhanced security protocol
based on TACACS (RFC 1492). HWTACACS is similar to RADIUS, and uses a
client/server model for information exchange between the NAS and the HWTACACS
server.

HWTACACS typically provides AAA services
for PPP, VPDN, and terminal users. In a typical HWTACACS scenario, terminal
users need to log in to the NAS. Working as the HWTACACS client, the NAS sends
users' usernames and passwords to the HWTACACS server for authentication. After
passing authentication and obtaining authorized rights, a user logs in to the
device and performs operations. The HWTACACS server records the operations that
each user performs.

#### Differences between HWTACACS and RADIUS

HWTACACS and RADIUS have many features in
common, such as using a client/server model, using shared keys for data
encryption, and providing flexibility and scalability. [Table 2](#_Ref304908167)
lists the primary differences between HWTACACS and RADIUS.

Table 2 Primary differences between HWTACACS
and RADIUS

| HWTACACS | RADIUS |
| --- | --- |
| Uses TCP, which provides reliable network transmission. | Uses UDP, which provides high transport efficiency. || Encrypts the entire packet except for the HWTACACS header. | Encrypts only the user password field in an authentication packet. || Protocol packets are complicated and authorization is independent of authentication. Authentication and authorization can be deployed on different HWTACACS servers. | Protocol packets are simple and the authorization process is combined with the authentication process. || Supports authorization of configuration commands. Access to commands depends on both the user's roles and authorization. A user can use only commands that are permitted by the user roles and authorized by the HWTACACS server. | Does not support authorization of configuration commands. Access to commands solely depends on the user's roles. For more information about user roles, see Fundamentals Configuration Guide. |




 

#### Basic HWTACACS packet exchange process

[Figure 6](#_Ref325470085) describes how HWTACACS performs user authentication, authorization,
and accounting for a Telnet user.

Figure 6 Basic HWTACACS packet exchange process for a Telnet user

![](https://resource.h3c.com/en/202407/12/20240712_11705285_x_Img_x_png_5_2216062_294551_0.png)

 

HWTACACS operates using in the following
workflow:

**1\.**A Telnet user requests to Telnet to the
device and provides the username and password as instructed by the system.

**2\.**The HWTACACS client sends a
start-authentication request that includes the username to the HWTACACS server
when it receives the Telnet request.

**3\.**The HWTACACS server sends back an
authentication response to request the login password.

**4\.**Upon receipt of the response, the HWTACACS
client sends the HWTACACS server a continue-authentication packet that includes
the login password.

**5\.**If the authentication succeeds, the HWTACACS
server sends back an authentication response to indicate that the user has
passed authentication.

**6\.**The HWTACACS client sends a user
authorization request packet to the HWTACACS server.

**7\.**If the authorization succeeds, the HWTACACS
server sends back an authorization response, indicating that the user is now
authorized.

**8\.**Knowing that the user is now authorized, the
HWTACACS client pushes its CLI to the user and permits the user to log in.

**9\.**The HWTACACS client sends a start-accounting
request to the HWTACACS server.

**10\.**The HWTACACS server sends back an accounting
response, indicating that it has received the start-accounting request.

**11\.**The user logs off.

**12\.**The HWTACACS client sends a stop-accounting
request to the HWTACACS server.

**13\.**The HWTACACS server sends back a
stop-accounting response, indicating that the stop-accounting request has been
received.

### LDAP

The Lightweight Directory Access Protocol
(LDAP) provides standard multiplatform directory service. LDAP was developed on
the basis of the X.500 protocol. It improves the following functions of X.500:

·     Read/write interactive access.

·     Browse.

·     Search.

LDAP is suitable for storing data that does
not often change. The protocol is used to store user information. For example,
LDAP server software Active Directory Server is used in Microsoft Windows
operating systems. The software stores the user information and user group
information for user login authentication and authorization.

#### LDAP directoryservice

LDAP uses directories to maintain the
organization information, personnel information, and resource information. The
directories are organized in a tree structure and include entries. An entry is
a set of attributes with distinguished names (DNs). The attributes are used to
store information such as usernames, passwords, emails, computer names, and
phone numbers.

LDAP uses a client/server model, and all
directory information is stored in the LDAP server. Commonly used LDAP server
products include Microsoft Active Directory Server, IBM Tivoli Directory
Server, and Sun ONE Directory Server. 

#### LDAP authentication andauthorization

AAA can use LDAP to provide authentication
and authorization services for users. LDAP defines a set of operations to
implement its functions. The main operations for authentication and
authorization are the bind operation and search operation.

·     The bind operation allows an LDAP client to
perform the following operations:

¡     Establish
a connection with the LDAP server.

¡     Obtain
the access rights to the LDAP server.

¡     Check
the validity of user information.

·     The search operation constructs search
conditions and obtains the directory resource information of the LDAP server.

In LDAP authentication, the client
completes the following tasks:

**1\.**Uses the LDAP server administrator DN to
bind with the LDAP server. After the binding is created, the client establishes
a connection to the server and obtains the right to search.

**2\.**Constructs search conditions by using the
username in the authentication information of a user. The specified root
directory of the server is searched and a user DN list is generated.

**3\.**Binds with the LDAP server by using each
user DN and password. If a binding is created, the user is considered legal.

In LDAP authorization, the client performs
the same tasks as in LDAP authentication. When the client constructs search
conditions, it obtains both authorization information and the user DN list.

#### Basic LDAP authentication process

The following example illustrates the basic
LDAP authentication process for a Telnet user.

Figure 7 Basic LDAP authentication process
for a Telnet user

![](https://resource.h3c.com/en/202407/12/20240712_11705286_x_Img_x_png_6_2216062_294551_0.png)

 

The following shows the basic LDAP
authentication process:

**1\.**A Telnet user initiates a connection request
and sends the username and password to the LDAP client. 

**2\.**After receiving the request, the LDAP client
establishes a TCP connection with the LDAP server. 

**3\.**To obtain the right to search, the LDAP
client uses the administrator DN and password to send an administrator bind
request to the LDAP server. 

**4\.**The LDAP server processes the request. If
the bind operation is successful, the LDAP server sends an acknowledgment to
the LDAP client. 

**5\.**The LDAP client sends a user DN search
request with the username of the Telnet user to the LDAP server. 

**6\.**After receiving the request, the LDAP server
searches for the user DN by the base DN, search scope, and filtering
conditions. If a match is found, the LDAP server sends a response to notify the
LDAP client of the successful search. There might be one or more user DNs
found.

**7\.**The LDAP client uses the obtained user DN
and the entered user password as parameters to send a user DN bind request to
the LDAP server. The server will check whether the user password is correct.

**8\.**The LDAP server processes the request, and
sends a response to notify the LDAP client of the bind operation result. If the
bind operation fails, the LDAP client uses another obtained user DN as the
parameter to send a user DN bind request to the LDAP server. This process
continues until a DN is bound successfully or all DNs fail to be bound. If all
user DNs fail to be bound, the LDAP client notifies the user of the login
failure and denies the user's access request. 

**9\.**The LDAP client saves the user DN that has
been bound and exchanges authorization packets with the authorization server.

¡     If
LDAP authorization is used, see the authorization process shown in [Figure 8](#_Ref407284672).

¡     If
another method is expected for authorization, the authorization process of that
method applies.

**10\.**After successful authorization, the LDAP
client notifies the user of the successful login. 

#### Basic LDAP authorization process

The following example illustrates the basic
LDAP authorization process for a Telnet user.

Figure 8 Basic LDAP authorization process
for a Telnet user

![](https://resource.h3c.com/en/202407/12/20240712_11705287_x_Img_x_png_7_2216062_294551_0.png)

 

The following shows the basic LDAP
authorization process:

**1\.**A Telnet user initiates a connection request
and sends the username and password to the device. The device will act as the
LDAP client during authorization.

**2\.**After receiving the request, the device
exchanges authentication packets with the authentication server for the user:

¡     If
LDAP authentication is used, see the authentication process shown in [Figure 7](#_Ref187136819).

\-     If the device (the LDAP client) uses the same LDAP server for
authentication and authorization, skip to step 6\.

\-     If the device (the LDAP client) uses different LDAP servers for
authentication and authorization, skip to step 4\.

¡     If
another authentication method is used, the authentication process of that
method applies. The device acts as the LDAP client. Skip to step 3\.

**3\.**The LDAP client establishes a TCP connection
with the LDAP authorization server.

**4\.**To obtain the right to search, the LDAP
client uses the administrator DN and password to send an administrator bind
request to the LDAP server.

**5\.**The LDAP server processes the request. If the
bind operation is successful, the LDAP server sends an acknowledgment to the
LDAP client.

**6\.**The LDAP client sends an authorization
search request with the username of the Telnet user to the LDAP server. If the
user uses the same LDAP server for authentication and authorization, the client
sends the request with the saved user DN of the Telnet user to the LDAP server.

**7\.**After receiving the request, the LDAP server
searches for the user information by the base DN, search scope, filtering
conditions, and LDAP attributes. If a match is found, the LDAP server sends a
response to notify the LDAP client of the successful search.

**8\.**After successful authorization, the LDAP
client notifies the user of the successful login.

### User management based on ISP domains and user access types

AAA manages users based on the users' ISP
domains and access types. 

On a NAS, each user belongs to one ISP
domain. The NAS determines the ISP domain to which a user belongs based on the
username entered by the user at login.

Figure 9 Determining the ISP domain for a
user by username 

![](https://resource.h3c.com/en/202407/12/20240712_11705288_x_Img_x_png_8_2216062_294551_0.png)

 

AAA manages users in the same ISP domain
based on the users' access types. The device supports the following user access
types:

·     LAN—LAN users must pass 802.1X or MAC authentication to come online.

·     Login—Login users include SSH, Telnet, FTP, and terminal users that log
in to the device. Terminal users can access through a console port.

·     Portal—Portal users must pass portal authentication to access the network.

·     HTTP/HTTPS—Users log in to the device through HTTP or HTTPS.

The device also provides authentication
modules (such as 802.1X) for implementation of user authentication management
policies. If you configure these authentication modules, the ISP domains for
users of the access types depend on the configuration of the authentication
modules.

The device provides the following types of
ISP domains for you to control access of wired 802.1, Web authentication, and
MAC authentication users to network resources at different phases of
authentication:

·     Preauthentication domain—The domain to which users belong before authentication starts for
them. For example, users are placed in the preauthentication domain in the
following situations:

¡     Before
they authenticate to the network for the first time. 

¡     When
they fail authentication in an ISP domain that does not have an auth-fail
domain.

¡     When
no authentication servers are available, they are assigned to the specified
critical domain. However, the specified critical domain does not exist. 

The preauthentication domain is
applicable only to 802.1X and Web authentication users.

·     Authentication domain—The ISP domain in which users are authenticated and come online.

·     Auth-fail domain—The ISP domain specified to accommodate users that have failed
authentication in an authentication domain.

·     Critical domain—The ISP domain specified to accommodate users that access an
authentication domain when all RADIUS servers in that authentication domain are
unavailable.

·     Recovery domain—The ISP domain to which users in the critical domain are moved
after a RADIUS authentication server in their authentication domain becomes
available.

 

| IMPORTANT | IMPORTANT:  In the current version, you must specify the authentication domain as the recovery domain. |
| --- | --- |

 

Figure 10 Movement of users between different types of ISP domains

![](https://resource.h3c.com/en/202407/12/20240712_11705259_x_Img_x_png_10_2216062_294551_0.png)

 

### Authentication, authorization, and accounting methods

As shown in [Figure 11](#_Ref102393311), an ISP domain
represents a set of authentication, authorization, and accounting methods for
different types of users in an ISP domain. The NAS determines the ISP domain
and access type of a user. The NAS also uses the methods configured for the
access type in the domain to control the user's access.

AAA also supports configuring a set of
default methods for an ISP domain. These default methods are applied to users
for whom no AAA methods are configured.

Figure 11 AAA configuration structure for an
ISP domain

![](https://resource.h3c.com/en/202407/12/20240712_11705260_x_Img_x_png_11_2216062_294551_0.png)

 

#### Authentication methods

The device supports the following
authentication methods:

·     No authentication—This method trusts all users and does not perform authentication.
For security purposes, do not use this method.

·     Local authentication—The NAS authenticates users by itself, based on the locally
configured user information including the usernames, passwords, and attributes.
Local authentication allows high speed and low cost, but the amount of
information that can be stored is limited by the size of the storage space.

·     Remote authentication—The NAS works with a remote server to authenticate users. The NAS
communicates with the remote server through the RADIUS, LDAP, or HWTACACS
protocol. The server manages user information in a centralized manner. Remote
authentication provides high capacity, reliable, and centralized authentication
services for multiple NASs. You can configure backup methods to be used when
the remote server is not available.

#### Authorization methods

The device supports the following
authorization methods:

·     No authorization—The NAS performs no authorization exchange. The following default
authorization information applies after users pass authentication:

¡     Login
users obtain the level-0 user role. For more information about the level-0 user
role, see RBAC configuration in Fundamentals
Configuration Guide.

¡     The
working directory for FTP, SFTP, and SCP login users is the root directory of
the NAS. However, the users do not have permission to access the root
directory.

¡     Non-login
users can access the network. 

·     Local authorization—The NAS performs authorization according to the user attributes
locally configured for users.

·     Remote authorization—The NAS works with a remote server to authorize users. RADIUS
authorization is bound with RADIUS authentication. RADIUS authorization can
work only after RADIUS authentication is successful, and the authorization
information is included in the Access-Accept packet. HWTACACS or LDAP
authorization is separate from authentication, and the authorization
information is included in the authorization response after successful
authentication. You can configure backup methods to be used when the remote
server is not available.

#### Accounting methods

The device supports the following
accounting methods: 

·     No accounting—The NAS does not perform accounting for the users.

·     Local accounting—Local accounting is implemented on the NAS. It counts and controls
the number of concurrent users that use the same local user account, but does
not provide statistics for charging.

·     Remote accounting—The NAS works with a RADIUS server or HWTACACS server for
accounting. You can configure backup methods to be used when the remote server
is not available.

#### Authorization attribute configuration methods

You can configure authorization attributes
for an ISP domain on the NAS, on a server, or on both the NAS and a server. Server-assigned
authorization attributes have higher priority than NAS-assigned settings. NAS-assigned
attributes can take effect only if they do not conflict with server-assigned
attributes. If a NAS-assigned attribute conflicts with a server-assigned attribute,
the server-assigned attribute takes effect. 

### AAA extended functions

The device provides the following login
services to enhance device security:

·     Command authorization—Enables the NAS to let the authorization server determine whether a
command entered by a login user is permitted. Login users can execute only
commands permitted by the authorization server. For more information about
command authorization, see Fundamentals Configuration
Guide. 

·     Command accounting—When command authorization is disabled, command accounting enables
the accounting server to record all valid commands executed on the device. When
command authorization is enabled, command accounting enables the accounting
server to record all authorized commands. For more information about command
accounting, see Fundamentals Configuration Guide.

·     User role authentication—Authenticates each user that wants to obtain another user role
without logging out or getting disconnected. For more information about user
role authentication, see Fundamentals Configuration
Guide.

### AAA for VPNs

You can deploy AAA across VPNs to enable
forwarding of authentication, authorization, and accounting packets across
VPNs. For example, as shown in [Figure 12](#_Ref245627314), The
MCE at the left side of the MPLS backbone acts as a NAS. The NAS transparently
delivers the AAA packets of private users in VPN 1 and VPN 2 to the AAA servers
in VPN 3 for centralized authentication. Authentication packets of private
users in different VPNs do not affect each other.

Figure 12 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705261_x_Img_x_png_12_2216062_294551_0.png)

‌

This feature can also help an MCE to
implement portal authentication for VPNs. For more information about MCE, see MCE Configuration Guide. For more information about
portal authentication, see "Configuring portal authentication."

### RADIUS server feature of the device

Enable the RADIUS server feature of the
device to work with RADIUS clients for user authentication and authorization.
The device can act as a dedicated RADIUS server or as both a RADIUS server and
a RADIUS client at the same time.

The RADIUS server feature provides for
flexible networks with less cost. As shown in [Figure 13](#_Ref451970041), Device A provides
RADIUS server functions at the distribution layer; Device B and Device C are
configured with RADIUS schemes to implement user authentication and
authorization at the access layer.

Figure 13 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705262_x_Img_x_png_13_2216062_294551_0.png)

 

The RADIUS server feature supports the
following operations:

·     Manages RADIUS user data, which is generated
from local user information and includes user name, password, description,
authorization ACL, authorization VLAN, and expiration time.

·     Manages RADIUS clients. You can add, modify, and
delete RADIUS clients. A RADIUS client is identified by the IP address, and it
includes attribute information such as the shared key. The RADIUS server
feature processes authentication requests only from the managed RADIUS clients
and ignores requests from unknown clients.

·     Authenticates and authorizes users of the
network access type. The server does not provide accounting.

When the RADIUS server receives a RADIUS
packet, it performs the following actions:

**1\.**Verifies that the packet is sent from a
managed RADIUS client.

**2\.**Verifies the packet with the shared key.

**3\.**Verifies that the user account exists, the
password is correct, and other attributes meet the requirements (for example,
the account is in the validity period).

**4\.**Determines the authentication result and
authorizes specific privileges to the authenticated user.

The RADIUS server feature of the device has
the following restrictions:

·     The authentication port is fixed at UDP 1812 and
cannot be modified.

·     The feature is supported on IPv4 networks, but
not on IPv6 networks.

·     The server provides only PAP and CHAP
authentication methods.

·     User names sent to the RADIUS server cannot
include a domain name.

### Protocols and standards

·     RFC 2865, Remote
Authentication Dial In User Service (RADIUS)

·     RFC 2866, RADIUS
Accounting

·     RFC 2867, RADIUS
Accounting Modifications for Tunnel Protocol Support

·     RFC 2868, RADIUS
Attributes for Tunnel Protocol Support

·     RFC 2869, RADIUS
Extensions

·     RFC 3576, Dynamic
Authorization Extensions to Remote Authentication Dial In User Service (RADIUS)

·     RFC 4818, RADIUS
Delegated-IPv6-Prefix Attribute

·     RFC 5176, Dynamic
Authorization Extensions to Remote Authentication Dial In User Service (RADIUS)

·     RFC 1492, An Access
Control Protocol, Sometimes Called TACACS

·     RFC 1777, Lightweight
Directory Access Protocol

·     RFC 2251, Lightweight
Directory Access Protocol (v3)

## FIPS compliance

The device supports the FIPS mode that
complies with NIST FIPS 140-2 requirements. Support for features, commands, and
parameters might differ in FIPS mode (see "Configuring FIPS") and
non-FIPS mode.

## AAA tasksat a glance

To configure AAA, perform the following
tasks:

**1\.**Configuring AAA schemes

If local authentication is used,
configure local users and the related attributes. If remote authentication is
used, configure the required RADIUS, LDAP, or HWTACACS schemes.

¡     [Configuring local users](#_Ref157238596)

¡     [Configuring RADIUS](#_Ref482630818)

¡     [Configuring HWTACACS](#_Ref472953841)

¡     [Configuring LDAP](#_Ref472953853)

**2\.**Configuring an ISP domain

**a.**[Creating an ISP domain](#_Ref472953888)

**b.**[Configuring ISP domain attributes](#_Ref472953893)

**3\.**[Configuring AAA methods for an ISP domain](#_Ref472953926)

Configure authentication, authorization,
and accounting methods for an ISP domain as needed. These methods use existing
AAA schemes.

¡     [Configuring authentication methods for an
ISP domain](#_Ref472953971)

¡     [Configuring authorization methods for an
ISP domain](#_Ref472953974)

¡     [Configuring accounting methods for an ISP
domain](#_Ref472953979)

**4\.**(Optional.) Configuring advanced AAA
features

¡     [Configuring a critical profile](#_Ref68607474)

¡     [Configuring AAA fail-permit and recovery](#_Ref94953794)

¡     [Setting the maximum number of concurrent
login users](#_Ref342308559)

¡     [Configuring BYOD endpoint identification](#_Ref75268467)

¡     [Configuring a NAS-ID](#_Ref482706115)

¡     [Configuring the device ID](#_Ref440547662)

¡     [Enabling password change prompt logging](#_Ref50652935)

¡     [Configuring the RADIUS server feature](#_Ref452019041)

¡     [Configuring the connection recording policy](#_Ref487190419)

¡     [Displaying user MAC and UUID binding entries](#_Ref59291596)

¡     [Configuring the AAA test feature](#_Ref508982142)

## Configuring local users

### About local users

To implement local authentication,
authorization, and accounting, create local users and configure user attributes
on the device. The local users and attributes are stored in the local user
database on the device. A local user is uniquely identified by the combination
of a username and a user type.

Local users are classified into the
following types:

·     Device management user—User that logs in to the device for device management.

·     Network access user—User that accesses network resources through the device. 

The following shows the configurable local
user attributes:

·     Description—Descriptive information of the user.

·     Service type—Services that the user can use. Local authentication checks the
service types of a local user. If none of the service types is available, the
user cannot pass authentication.

·     User state—Whether or not a local user can request network services. There are
two user states: active and blocked. A user in active state can request network
services, but a user in blocked state cannot.

·     Upper limit of concurrent
logins using the same user name—Maximum number
of users that can concurrently access the device by using the same user name.
When the number reaches the upper limit, no more local users can access the
device by using the user name.

·     User group—Each local user belongs to a local user group and has all
attributes of the group. The attributes include the password control attributes
and authorization attributes. For more information about local user group, see
"[Configuring user group
attributes](#_Ref196109779)."

·     Binding attributes—Binding attributes control the scope of users, and are checked
during local authentication of a user. If the attributes of a user do not match
the binding attributes configured for the local user account, the user cannot
pass authentication.

·     Authorization attributes—Authorization attributes indicate the user's rights after it passes
local authentication.

Configure the authorization attributes
based on the service type of local users.

You can configure an authorization
attribute in user group view or local user view. The setting of an
authorization attribute in local user view takes precedence over the attribute
setting in user group view.

The attribute configured in user group
view takes effect on all local users in the user group.

The attribute configured in local user
view takes effect only on the local user.

·     Password control attributes—Password control attributes help control password security for
local users. Password control attributes include password aging time, minimum
password length, password composition checking, password complexity checking,
and login attempt limit.

You can configure a password control
attribute in system view, user group view, or local user view. A password
control attribute with a smaller effective range has a higher priority. For
more information about password management and global password configuration,
see "Configuring password control."

·     Validity period—Time period in which a network access user is considered valid for
authentication.

### Local user configuration tasks at a glance

To configure local users, perform the
following tasks:

**1\.**Configuring local user attributes

¡     [Configuring attributes for device
management users](#_Ref454547454)

¡     [Configuring attributes for network access
users](#_Ref454547459)

**2\.**(Optional.) [Configuring user group attributes](#_Ref196109779)

**3\.**(Optional.) [Configuring the local user auto-delete
feature](#_Ref452016486)

### Configuring attributes for device management users

#### Restrictions and guidelines

When you configure the interface binding
attribute for a device management user, follow these restrictions and
guidelines to avoid authentication failure:

·     Specify the actual access interface of the user
as the binding interface for the user.

·     Make sure the user's authentication packets
include the user's access interface.

If password control is globally enabled for
device management users by using the password-control enable command, the device neither displays local user passwords nor
retains them in the running configuration. When you globally disable password
control for device management users, local user passwords are automatically
restored to the running configuration. To display the running configuration,
use the display current-configuration command.

You can configure authorization attributes
and password control attributes in local user view or user group view. The
setting in local user view takes precedence over the setting in user group
view.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Add a device management user and enter
device management user view.

local-user user-name class manage

**3\.**Configure a password for the device
management user.

In non-FIPS mode:

password \[ { hash \| simple } string ]

A non-password-protected user passes
authentication if the user provides the correct username and passes attribute
checks. To enhance security, configure a password for each device management
user.

In FIPS mode:

password

Only password-protected users can pass
authentication. You must set the password in interactive mode for a device
management user.

**4\.**Assign services to the device management
user.

In non-FIPS mode:

service-type { ftp \| { http \| https \| ssh \| telnet \| terminal } \* }

In FIPS mode:

service-type { https \| ssh \| terminal } \*

By default, no services are authorized to
a device management user.

**5\.**(Optional.) Set the status of the device
management user.

state { active \| block }

By default, a device management user is
in active state and can request network services.

**6\.**(Optional.) Set the upper limit of
concurrent logins using the device management username.

access-limit max-user-number

By default, the number of concurrent
logins is not limited for a device management user.

This command takes effect only when local
accounting is configured for device management users. This command does not
apply to FTP, SFTP, or SCP users that do not support accounting.

**7\.**(Optional.) Configure the interface binding
attribute for the device management user.

bind-attribute location interface interface-type interface-number

By default, no interface binding
attribute is configured for a device management user.

**8\.**(Optional.) Configure authorization
attributes for the device management user.

authorization-attribute
{ idle-cut minutes \| user-role role-name \| work-directory directory-name } \*

The following default settings apply:

¡     The
working directory for FTP, SFTP, and SCP users is the root directory of the
NAS. However, the users do not have permission to access the root directory.

¡     The
network-operator user role is assigned to local users that are created by a
network-admin or level-15 user.

**9\.**(Optional.) Configure password control
attributes for the device management user. Choose the following tasks as
needed:

¡     Set
the password aging time.

password-control aging aging-time

¡     Set
the minimum password length.

password-control length length

¡     Configure
the password composition policy.

password-control composition type-number type-number \[ type-length type-length ]

¡     Configure
the password complexity checking policy.

password-control complexity { same-character \| user-name } check

¡     Configure
the maximum login attempts and the action to take if there is a login failure.

password-control login-attempt login-times \[ exceed { lock \| lock-time time \| unlock } ]

By default, a device management user uses
password control attributes of the user group to which the user belongs.

**10\.**(Optional.) Assign the device management
user to a user group.

group group-name

By default, a device management user
belongs to user group system.

### Configuring attributes for network access users

#### Restrictions and guidelines

If password control is globally enabled for
network access users by using the password-control enable network-class command, the device neither displays local user passwords nor
retains them in the running configuration. When you globally disable password
control for network access users, local user passwords are automatically
restored to the running configuration. To display the running configuration,
use the display current-configuration command.

You can configure authorization attributes
and password control attributes in local user view or user group view. The
setting in local user view takes precedence over the setting in user group
view.

Configure the location
binding attribute based on the service types of users.

·     For 802.1X users, specify the 802.1X-enabled
Layer 2 Ethernet interfaces through which the users access the device.

·     For MAC authentication users, specify the MAC
authentication-enabled Layer 2 Ethernet interfaces through which the users
access the device.

·     For Web authentication users, specify the Web
authentication-enabled Layer 2 Ethernet interfaces through which the users
access the device.

·     For portal users, specify the portal-enabled
interfaces through which the users access the device. Specify the Layer 2
Ethernet interfaces if portal is enabled on VLAN interfaces and the portal roaming
enable command is not used.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Add a network access user and enter network
access user view.

local-user user-name class network

**3\.**(Optional.) Configure a password for the
network access user.

password { cipher \| simple } string

**4\.**(Optional.) Configure a description for the
network access user.

description text

By default, no description is configured
for a local user.

**5\.**Assign services to the network access user.

service-type { lan-access \| portal }

By default, no services are authorized to
a network access user.

**6\.**(Optional.) Set the status of the network
access user.

state { active \| block }

By default, a network access user is in
active state and can request network services.

**7\.**(Optional.) Set the upper limit of
concurrent logins using the network access username.

access-limit max-user-number

By default, the number of concurrent
logins is not limited for a network access user.

**8\.**(Optional.) Configure binding attributes for
the network access user.

bind-attribute { ip ip-address \| location interface interface-type
interface-number \| mac mac-address \| vlan vlan-id } \*

By default, no binding attributes are
configured for a network access user.

**9\.**(Optional.) Configure authorization
attributes for the network access user.

authorization-attribute
{ acl acl-number \| idle-cut minutes \| ip-pool ipv4-pool-name \| ipv6-pool ipv6-pool-name \| session-timeout minutes \| user-profile
profile-name
\| vlan vlan-id } \*

By default, a network access user does
not have authorization attributes.

**10\.**(Optional.) Configure password control
attributes for the network access user. Choose the following tasks as needed:

¡     Set
the minimum password length.

password-control length length

¡     Configure
the password composition policy.

password-control composition type-number type-number \[ type-length type-length ]

¡     Configure
the password complexity checking policy.

password-control complexity { same-character \| user-name } check

By default, a network access user uses
password control attributes of the user group to which the user belongs.

**11\.**(Optional.) Assign the network access user
to a user group.

group group-name

By default, a network access user belongs
to user group system.

**12\.**(Optional.) specify the validity period for
the local user.

validity-datetime { from start-date
start-time to expiration-date expiration-time \| from start-date
start-time \| to expiration-date expiration-time }

By default, the validity period for a
network access user does not expire.

### Configuring user group attributes

#### About this task

User groups simplify local user
configuration and management. A user group contains a group of local users and
has a set of local user attributes. You can configure local user attributes for
a user group to implement centralized user attributes management for the local
users in the group. Local user attributes that are manageable include
authorization attributes.

#### Restrictions and guidelines

When you specify an authorized ACL, follow
these restrictions and guidelines:

·     If the specified ACL does not exist or the ACL
does not contain any rules, the system considers that no ACL is specified. If
the strict check method is enabled for portal authorized ACLs, the system logs
off portal users.

·     For LAN and portal users, the ACL takes effect
on both public and private network packets no matter if an ACL rule is
specified with a VPN instance. The specified VPN instance filtering criterion does
not take effect.

·     For portal users to come online after passing
authentication, make sure ACLs assigned to portal users do not have rules
specified with a source IP or MAC address.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create a user group and enter user group
view.

user-group group-name

By default, a system-defined user group
exists. The group name is system.

**3\.**Configure authorization attributes for the
user group.

authorization-attribute
{ acl acl-number \| idle-cut minutes \| ip-pool ipv4-pool-name \| ipv6-pool ipv6-pool-name \| session-timeout minutes \| user-profile
profile-name \| vlan vlan-id \| work-directory directory-name } \*

By default, no authorization attributes
are configured for a user group.

**4\.**Configure authorization attributes for a
type of BYOD endpoints in the user group.

byod authorization device-type type-name { acl acl-number \| callback-number callback-number \| idle-cut minutes \| ip-pool ipv4-pool-name \| ipv6-pool ipv6-pool-name \| ipv6-prefix ipv6-prefix
prefix-length \| { primary-dns \| secondary-dns } { ip ipv4-address \| ipv6 ipv6-address } \| session-timeout minutes \| url url-string \| user-profile profile-name \| vlan vlan-id \| vpn-instance
vpn-instance-name } \*

By default, no authorization attributes
are configured for any type of BYOD endpoints in the user group.

The attributes apply to local BYOD
authorization and take effect only on network access users.

**5\.**(Optional.) Configure password control
attributes for the user group. Choose the following tasks as needed:

¡     Set
the password aging time.

password-control aging aging-time

¡     Set
the minimum password length.

password-control length length

¡     Configure
the password composition policy.

password-control composition type-number type-number \[ type-length type-length ]

¡     Configure
the password complexity checking policy.

password-control complexity { same-character \| user-name } check

¡     Configure
the maximum login attempts and the action to take for login failures.

password-control login-attempt login-times \[ exceed { lock \| lock-time time \| unlock } ]

By default, a user group uses the global
password control settings. For more information, see "Configuring password
control."

### Configuring the local user auto-delete feature

#### About this task

This feature enables the device to examine
the validity of local users at fixed time periods of 10 minutes and
automatically delete expired local users.

#### Procedure

**1\.**Enter system view

system-view

**2\.**Enable the local user auto-delete feature.

local-user auto-delete enable

By default, the local user auto-delete
feature is disabled.

### Display and maintenance commands for local users and local user groups

Execute display commands
in any view.

 

| Task | Command |
| --- | --- |
| Display the local user configuration and online user statistics. | display local-user \[ class { manage \| network } \| idle-cut { disable \| enable } \| service-type { ftp \| http \| https \| lan-access \| portal \| ssh \| telnet \| terminal } \| state { active \| block } \| user-name user-name class { manage \| network } \| vlan vlan-id ] || Display user group configuration. | display user-group { all \| name group-name \[ byod-authorization ] } |


## Configuring RADIUS

### RADIUS tasks at a glance

To configure RADIUS, perform the following
tasks:

**1\.**[Configuring an EAP profile](#_Ref499291133)

To perform EAP-based RADIUS server status
detection, you must configure an EAP profile and specify the EAP profile in a
test profile.

**2\.**[Configuring a test profile for RADIUS
server status detection](#_Ref371945788)

To detect the status of a RADIUS server,
you must configure a test profile and configure the RADIUS server to use the
test profile in a RADIUS scheme.

**3\.**[Creating a RADIUS scheme](#_Ref371945793)

**4\.**[Specifying RADIUS authentication servers](#_Ref246997082)

**5\.**[Specifying the RADIUS accounting servers](#_Ref472954210)

**6\.**[Specifying the shared keys for secure
RADIUS communication](#_Ref472954222)

Perform this task if no shared keys are
specified when configuring RADIUS authentication or accounting servers.

**7\.**[Specifying the MPLS L3VPN instance for a
RADIUS scheme](#_Ref246157408)

Perform this task if no MPLS L3VPN
instances are specified when configuring RADIUS authentication or accounting
servers.

**8\.**(Optional.) [Setting the status of RADIUS servers](#_Ref472954237)

**9\.**(Optional.) [Setting RADIUS timers](#_Ref472954242)

**10\.**(Optional.) Configuring parameters for
RADIUS packets

¡     [Specifying the source IP address for
outgoing RADIUS packets](#_Ref472954250)

¡     [Setting the username format and traffic
statistics units](#_Ref332382528)

¡     [Setting the maximum number of RADIUS
request transmission attempts](#_Ref272309704)

¡     [Setting the maximum number of real-time
accounting attempts](#_Ref454791218)

¡     [Setting the DSCP priority for RADIUS
packets](#_Ref472954273)

**11\.**(Optional.) Configuring parameters for
RADIUS attributes

¡     [Configuring the format of the RADIUS
NAS-Port attribute](#_Ref92957284)

¡     [Configuring the Login-Service attribute
check method for SSH, FTP, and terminal users](#_Ref472954286)

¡     [Interpreting the RADIUS class attribute
as CAR parameters](#_Ref472954289)

¡     [Configuring the format of the RADIUS
Called-Station-Id attribute](#_Ref77408734)

¡     [Configuring the MAC address format for
the RADIUS Called-Station-Id attribute](#_Ref77408743)

¡     [Configuring the MAC address format for
the RADIUS Calling-Station-Id attribute](#_Ref472954294)

¡     [Configuring the format of RADIUS
attribute 87](#_Ref472954299)

¡     [Setting the data measurement unit for
the Remanent\_Volume attribute](#_Ref472954303)

¡     [Including subattribute 218 of vendor
25506 in outgoing RADIUS packets](#_Ref43812646)

¡     [Configuring the RADIUS attribute
translation feature](#_Ref472954312)

**12\.**(Optional.) Configuring extended RADIUS
features

¡     [Associating a microsegment with a VSI](#_Ref43366150)

¡     [Configuring RADIUS stop-accounting
packet buffering](#_Ref454791219)

¡     [Enabling forcibly sending
stop-accounting packets](#_Ref490236485)

¡     [Enabling the RADIUS server load sharing
feature](#_Ref433615119)

¡     [Specifying a RADIUS server selection
mode for reauthentication](#_Ref534288419)

¡     [Configuring the RADIUS accounting-on
feature](#_Ref390102640)

¡     [Configuring the RADIUS session-control
feature](#_Ref454791243)

¡     [Configuring the RADIUS DAS feature](#_Ref454791251)

¡     [Enabling SNMP notifications for RADIUS](#_Ref393109496)

¡     [Disabling the RADIUS service](#_Ref529375746)

### Restrictions and guidelines for RADIUS configuration

If the authentication server in a RADIUS
scheme is provided by the RADIUS server feature on the device, you need to
configure only the following items for the RADIUS scheme:

·     RADIUS authentication server.

·     Shared key for RADIUS communication.

·     Username format for interaction with the RADIUS
server.

### Configuring an EAP profile

#### About this task

An EAP profile is a collection of EAP
authentication settings, including the EAP authentication method and the CA
certificate file to be used for some EAP authentication methods.

#### Restrictions and guidelines

You can specify an EAP profile in multiple
test profiles.

You can configure a maximum of 16 EAP
profiles.

#### Prerequisites

Before you specify a CA certificate file,
use FTP or TFTP to transfer the CA certificate file to the root directory of
the default storage medium on the device.

In an IRF fabric, make sure the CA certificate
file exists in the root directory of the default storage medium on the master
device before you specify the file.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create an EAP profile and enter EAP profile
view.

eap-profile eap-profile-name

**3\.**Specify the EAP authentication method.

method { md5 \| peap-gtc \| peap-mschapv2 \| ttls-gtc \| ttls-mschapv2 }

By default, the EAP authentication method
is MD5-challenge.

**4\.**Specify a CA certificate file for EAP
authentication.

ca-file file-name

By default, no CA certificate file is
specified for EAP authentication.

You must specify a CA certificate file to
verify the RADIUS server certificate if the EAP authentication method is
PEAP-GTC, PEAP-MSCHAPv2, TTLS-GTC, or TTLS-MSCHAPv2.

### Configuringa test profile for RADIUS server status detection

#### About this task

To detect the reachability or availability
of a RADIUS authentication server, specify a test profile for the RADIUS server
when you specify the server in a RADIUS scheme. With the test profile, the
device refreshes the RADIUS server status at each detection interval according
to the detection result. If the server is unreachable or unavailable, the
device sets the status of the server to blocked. If the server is reachable or
available, the device sets the status of the server to active.

The device supports the following RADIUS
server status detection methods:

·     Simple detection—For a RADIUS server, the device simulates an authentication request
with the username and password specified in the test profile used by the
server. The authentication request is sent to the RADIUS server within each
detection interval. The device determines that the RADIUS server is reachable
if the device receives a response from the server within the interval.

·     EAP-based detection—For a RADIUS server, the device simulates an EAP authentication
with the username and password specified in the test profile used by the
server. The simulated EAP authentication starts at the beginning of each
detection interval. If the EAP authentication completes within a detection
interval, the device determines that the RADIUS server is available.

Simulating a complete EAP authentication
process, EAP-based detection provides more reliable detection results than
simple detection. As a best practice, configure EAP-based detection on a
network environment where EAP authentication is configured.

#### Restrictions and guidelines

You can configure multiple test profiles in
the system.

The device starts detecting the status of a
RADIUS authentication server only if an existing test profile is specified for
the server.

If you specify a nonexistent EAP profile in
a test profile, the device performs simple detection for the RADIUS servers
that use the test profile. After the EAP profile is configured, the device will
start EAP-based detection at the next detection interval.

The device stops detecting the status of a
RADIUS server when one of the following operations is performed:

·     The RADIUS server is removed from the RADIUS
scheme.

·     The test profile configuration for the RADIUS
server is removed in RADIUS scheme view.

·     The test profile specified for the RADIUS server
is deleted.

·     The RADIUS server is manually set to the blocked
state.

·     The RADIUS scheme that contains the RADIUS
server is deleted.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Configure a test profile for detecting the
status of RADIUS authentication servers.

radius-server test-profile profile-name username name \[ password { cipher \| simple } string ] \[ interval interval ] \[ eap-profile eap-profile-name ]

### Creating a RADIUSscheme

#### Restrictions and guidelines

You can configure a maximum of 16 RADIUS
schemes. A RADIUS scheme can be used by multiple ISP domains.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create a RADIUS scheme and enter RADIUS
scheme view.

radius scheme radius-scheme-name

### Specifying RADIUS authentication servers

#### About this task

A RADIUS authentication server completes
authentication and authorization together, because authorization information is
piggybacked in authentication responses sent to RADIUS clients. 

You can specify one primary authentication
server and a maximum of 16 secondary authentication servers for a RADIUS
scheme. Secondary servers provide AAA services when the primary server becomes
unreachable. The device searches for an active server in the order the
secondary servers are configured.

When RADIUS server load sharing is enabled,
the device distributes the workload over all servers without considering the
primary and secondary server roles. The device checks the weight value and
number of currently served users for each active server, and then determines
the most appropriate server in performance to receive an authentication
request.

#### Restrictions and guidelines

If redundancy is not required, specify only
the primary server. 

A RADIUS authentication server can function
as the primary authentication server for one scheme and a secondary
authentication server for another scheme at the same time.

Two authentication servers in a scheme,
primary or secondary, cannot have the same combination of VPN instance, host
name, IP address, and port number.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Specify the primary RADIUS authentication
server.

primary authentication { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| test-profile profile-name \| vpn-instance
vpn-instance-name
\| weight weight-value ] \*

By default, no primary RADIUS
authentication server is specified.

The weight
keyword takes effect only when the RADIUS server load sharing feature is
enabled for the RADIUS scheme.

**4\.**(Optional.) Specify a secondary RADIUS
authentication server.

secondary authentication { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| test-profile
profile-name \| vpn-instance
vpn-instance-name
\| weight weight-value ] \*

By default, no secondary RADIUS
authentication servers are specified.

The weight
keyword takes effect only when the RADIUS server load sharing feature is
enabled for the RADIUS scheme.

### Specifying the RADIUS accounting servers

#### About this task

You can specify one primary accounting
server and a maximum of 16 secondary accounting servers for a RADIUS scheme.
Secondary servers provide AAA services when the primary server becomes
unavailable. The device searches for an active server in the order the
secondary servers are configured.

When RADIUS server load sharing is enabled,
the device distributes the workload over all servers without considering the
primary and secondary server roles. The device checks the weight value and
number of currently served users for each active server, and then determines
the most appropriate server in performance to receive an accounting request.

#### Restrictions and guidelines

If redundancy is not required, specify only
the primary server. 

A RADIUS accounting server can function as
the primary accounting server for one scheme and a secondary accounting server
for another scheme at the same time.

Two accounting servers in a scheme, primary
or secondary, cannot have the same combination of VPN instance, host name, IP
address, and port number.

RADIUS does not support accounting for FTP,
SFTP, and SCP users.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Specify the primary RADIUS accounting server.

primary accounting { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| vpn-instance
vpn-instance-name
\| weight weight-value ] \*

By default, no primary RADIUS accounting
server is specified.

The weight keyword
takes effect only when the RADIUS server load sharing feature is enabled for
the RADIUS scheme.

**4\.**(Optional.) Specify a secondary RADIUS
accounting server.

secondary accounting { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| vpn-instance vpn-instance-name \| weight weight-value ] \*

By default, no secondary RADIUS
accounting servers are specified.

The weight
keyword takes effect only when the RADIUS server load sharing feature is
enabled for the RADIUS scheme.

### Specifying the shared keys for secure RADIUS communication

#### About this task

The RADIUS client and server use the MD5
algorithm and shared keys to generate the Authenticator value for packet
authentication and user password encryption. The client and server must use the
same key for each type of communication.

A key configured in this task is for all
servers of the same type (accounting or authentication) in the scheme. The key
has a lower priority than a key configured individually for a RADIUS server.

#### Restrictions and guidelines

The shared key configured on the device
must be the same as the shared key configured on the RADIUS server.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Specify a shared key for secure RADIUS
communication.

key { accounting \| authentication } { cipher \| simple } string

By default, no shared key is specified
for secure RADIUS communication.

### Specifying the MPLS L3VPN instance for a RADIUS scheme

#### About this task

The VPN instance specified for a RADIUS
scheme applies to all authentication and accounting servers in that scheme. If
a VPN instance is also configured for an individual RADIUS server, the VPN
instance specified for the RADIUS scheme does not take effect on that server.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Specify a VPN instance for the RADIUS
scheme.

vpn-instance vpn-instance-name

By default, a RADIUS scheme belongs to
the public network.

### Setting the status of RADIUS servers

#### About this task

To control the RADIUS servers with which
the device communicates when the current servers are no longer available, set
the status of RADIUS servers to blocked or active. You can specify one primary
RADIUS server and multiple secondary RADIUS servers. The secondary servers
function as the backup of the primary server. When the RADIUS server load
sharing feature is disabled, the device chooses servers based on the following
rules:

·     When the primary server is in active state, the
device first tries to communicate with the primary server. If the primary
server is unreachable, the device searches for an active secondary server in
the order the servers are configured.

·     When one or more servers are in active state,
the device tries to communicate with these active servers only, even if the
servers are unavailable.

·     When all servers are in blocked state, the
device only tries to communicate with the primary server.

·     If a server is unreachable, the device performs
the following operations:

¡     Changes
the server status to blocked.

¡     Starts
a quiet timer for the server.

¡     Tries
to communicate with the next secondary server in active state that has the
highest priority. 

·     When the quiet timer of a server expires or you
manually set the server to the active state, the status of the server changes
back to active. The device does not check the server again during the
authentication or accounting process. 

·     The search process continues until the device
finds an available secondary server or has checked all secondary servers in
active state. If no server is reachable, the device considers the
authentication or accounting attempt a failure.

·     When you remove a server in use, communication
with the server times out. The device looks for a server in active state by
first checking the primary server, and then checking secondary servers in the
order they are configured.

·     When a RADIUS server's status changes
automatically, the device changes this server's status accordingly in all
RADIUS schemes in which this server is specified.

·     When a RADIUS server is manually set to blocked,
server detection is disabled for the server, regardless of whether a test
profile has been specified for the server. When the RADIUS server is set to
active state, server detection is enabled for the server on which an existing
test profile is specified.

By default, the device sets the status of
all RADIUS servers to active. However, in some situations, you must change the
status of a server. For example, if a server fails, you can change the status
of the server to blocked to avoid communication attempts to the server.

#### Restrictions and guidelines

The configured server status cannot be
saved to any configuration file, and can only be viewed by using the display radius
scheme command. 

After the device restarts, all servers are
restored to the active state.

The device selects a reachable server for
the authentication or accounting of a new user according to the server
selection rules in this section if the RADIUS server load sharing feature is
disabled. However, these rules are inapplicable to the reauthentication of
online users if the RADIUS server selection mode for reauthentication is set to
inherit by using the reauthentication server-select inherit command.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Set the RADIUS server status. Choose the
following tasks as needed:

¡     Set
the status of the primary RADIUS authentication server.

state primary authentication { active \| block }

¡     Set
the status of the primary RADIUS accounting server.

state primary accounting { active \| block }

¡     Set
the status of a secondary RADIUS authentication server.

state secondary authentication \[ { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| vpn-instance vpn-instance-name
] \* ] { active \| block }

¡     Set
the status of a secondary RADIUS accounting server.

state secondary accounting \[ { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| vpn-instance vpn-instance-name
] \* ] { active \| block }

By default, a RADIUS server is in active
state.

### Setting RADIUS timers

#### About this task

The device uses the following types of
timers to control communication with a RADIUS server:

·     Server response timeout
timer (response-timeout)—Defines
the RADIUS request retransmission interval. The timer starts immediately after
a RADIUS request is sent. If the device does not receive a response from the
RADIUS server before the timer expires, it resends the request.

·     Server quiet timer (quiet)—Defines the duration to keep an
unreachable server in blocked state. If one server is not reachable, the device
changes the server status to blocked, starts this timer for the server, and
tries to communicate with another server in active state. After the server
quiet timer expires, the device changes the status of the server back to
active.

·     Real-time accounting timer (realtime-accounting)—Defines the
intervals at which the device sends real-time accounting packets to the RADIUS
accounting server for online users.

#### Restrictions and guidelines

Consider the number of secondary servers
when you configure the maximum number of RADIUS packet transmission attempts
and the RADIUS server response timeout timer. If the RADIUS scheme includes
many secondary servers, the retransmission process might be too long and the
client connection in the access module, such as Telnet, can time out.

When the client connections have a short
timeout period, a large number of secondary servers can cause the initial
authentication or accounting attempt to fail. In this case, reconnect the
client rather than adjusting the RADIUS packet transmission attempts and server
response timeout timer. Typically, the next attempt will succeed, because the
device has blocked the unreachable servers to shorten the time to find a reachable
server.

Make sure the server quiet timer is set
correctly. A timer that is too short might result in frequent authentication or
accounting failures. This is because the device will continue to attempt to
communicate with an unreachable server that is in active state. A timer that is
too long might temporarily block a reachable server that has recovered from a
failure. This is because the server will remain in blocked state until the
timer expires.

A short real-time accounting interval helps
improve accounting precision but requires many system resources. When there are
1000 or more users, set the interval to 15 minutes or longer.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Set RADIUS timers. Choose the following
tasks as needed:

¡     Set
the RADIUS server response timeout timer.

timer response-timeout seconds

The default setting is 3 seconds.

¡     Set
the quiet timer for the servers.

timer quiet minutes

The default setting is 5 minutes.

¡     Set
the real-time accounting timer.

timer realtime-accounting interval \[ second ]

The default setting is 12 minutes.

### Specifying the source IP address for outgoing RADIUS packets

#### About this task

The source IP address of RADIUS packets
that a NAS sends must match the IP address of the NAS configured on the RADIUS
server. A RADIUS server identifies a NAS by its IP address. Upon receiving a
RADIUS packet, the RADIUS server checks the source IP address of the packet.

·     If it is the IP address of a managed NAS, the
server processes the packet.

·     If it is not the IP address of a managed NAS,
the server drops the packet.

Before sending a RADIUS packet, the NAS
selects a source IP address in the following order:

**1\.**The source IP address specified for the
RADIUS scheme.

**2\.**The source IP address specified in system
view for the VPN or public network, depending on where the RADIUS server
resides. 

**3\.**The IP address of the outbound interface
specified by the route.

In an M-LAG system, you must specify the
source IP address for outgoing RADIUS packets on both the M-LAG member devices.
Each M-LAG member device selects a source IP address in the above order. To
make user traffic switchover caused by primary/secondary M-LAG member device
switchover transparent to the RADIUS server, ensure that the source IP address
for outgoing RADIUS packets remains unchanged. Therefore, you must specify the
source IP address according to the load sharing mode for user authentication on
M-LAG interfaces:

·     In centralized mode, you must specify the same
local source IP address on both the M-LAG member devices. 

When an M-LAG member device fails, the
active M-LAG member device uses the local source IP address for outgoing RADIUS
packets sent for users authenticated on the failed M-LAG member device.

·     In distributed mode, you must specify a local
and peer source IP address pair on both the M-LAG member devices. Make sure the
peer source IP address on an M-LAG member device is the local IP address on the
other M-LAG member device.

When an M-LAG member device fails, the
active M-LAG member device uses the peer source IP address for outgoing RADIUS
packets sent for users authenticated on the failed M-LAG member device.

#### Restrictions and guidelines for source IP address configuration

You can specify a source IP address for
outgoing RADIUS packets in RADIUS scheme view or in system view.

·     The IP address specified in RADIUS scheme view
applies only to one RADIUS scheme.

·     The IP address specified in system view applies
to all RADIUS schemes.

The source IP address of RADIUS packets
that a NAS sends must match the IP address of the NAS that is configured on the
RADIUS server.

As a best practice, specify a loopback
interface address as the source IP address for outgoing RADIUS packets to avoid
RADIUS packet loss caused by physical port errors.

The source address of outgoing RADIUS
packets is typically the IP address of an egress interface on the NAS to
communicate with the RADIUS server. However, in some situations, you must
change the source IP address. For example, when VRRP is configured for stateful
failover, configure the virtual IP of the uplink VRRP group as the source
address.

You can directly specify a source IP address
for outgoing RADIUS packets or specify a source interface to provide the source
IP address for outgoing RADIUS packets. The source interface configuration and
the source IP address configuration overwrite each other.

In an M-LAG system, you must specify a
virtual IP address for the M-LAG system as the source IP address of RADIUS
packets. For more information about virtual IP addresses for the M-LAG system,
see M-LAG configuration in Layer 2—LAN Switching
Configuration Guide. 

#### Specifying a source interface or source IP address for all RADIUS schemes

**1\.**Enter system view.

system-view

**2\.**Specify a source interface or source IP
address for outgoing RADIUS packets.

radius nas-ip { interface interface-type
interface-number \| { ipv4-address \| ipv6 ipv6-address } \[ vpn-instance
vpn-instance-name ] }

By default, the source IP address of an
outgoing RADIUS packet is the primary IPv4 address or the IPv6 address of the
outbound interface.

#### Specifying a source interface or source IP address for a RADIUS scheme

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Specify a source interface or source IP
address for outgoing RADIUS packets.

nas-ip \[ m-lag { local \| peer } ] { ipv4-address \| interface interface-type
interface-number \| ipv6 ipv6-address }

By default, the source IP address of an
outgoing RADIUS packet is that specified by using the radius nas-ip command in system view. If the radius nas-ip command is not used, the source IP address is the primary IP
address of the outbound interface.

The m-lag { local \| peer } option specifies the source IP address for outgoing RADIUS packets sent for
users that access the network through M-LAG interfaces on an M-LAG system. This
option is
required only on an M-LAG system.

### Setting the username format and traffic statistics units

#### About this task

A username is in the userid@isp-name format,
where the isp-name part represents the user's ISP
domain name. By default, the ISP domain name is included in a username.
However, older RADIUS servers might not recognize usernames that contain the
ISP domain names. In this case, you can configure the device to remove the domain
name of each username to be sent.

The device reports online user traffic
statistics in accounting packets. The traffic measurement units are
configurable.

#### Restrictions and guidelines

If two or more ISP domains use the same
RADIUS scheme, configure the RADIUS scheme to keep the ISP domain name in
usernames for domain identification.

For accounting accuracy, make sure the
traffic statistics units configured on the device and on the RADIUS accounting
servers are the same.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Set the format for usernames sent to the
RADIUS servers.

user-name-format { keep-original \| with-domain \| without-domain }

By default, the ISP domain name is
included in a username.

If the device is specified as the RADIUS
server in the scheme, the username format must be set to without-domain.

**4\.**Set the data flow and packet measurement
units for traffic statistics.

data-flow-format { data { byte \| giga-byte \| kilo-byte \| mega-byte } \| packet { giga-packet \| kilo-packet \| mega-packet \| one-packet } }\*

By default, traffic is counted in bytes
and packets.

### Setting the maximum number of RADIUS request transmission attempts

#### About this task

RADIUS uses UDP packets to transfer data.
Because UDP communication is not reliable, RADIUS uses a retransmission
mechanism to improve reliability. A RADIUS request is retransmitted if the NAS
does not receive a server response for the request within the response timeout
timer. For more information about the RADIUS server response timeout timer, see
"[Setting the status of RADIUS servers](#_Ref472954237)."

You can set the maximum number for the NAS
to retransmit a RADIUS request to the same server. When the maximum number is
reached, the NAS tries to communicate with other RADIUS servers in active
state. If no other servers are in active state at the time, the NAS considers
the authentication or accounting attempt a failure.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Set the maximum number of RADIUS request
transmission attempts.

retry retries

By default, the maximum number is 3 for
RADIUS request transmission attempts.

### Setting the maximum number of real-time accounting attempts

#### About this task

If you set the maximum number of real-time
accounting attempts, the device will disconnect users from whom no accounting
responses are received within the permitted attempts.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Set the maximum number of real-time accounting
attempts.

retry realtime-accounting retries

By default, the maximum number is 5 for
real-time accounting attempts.

### Setting the DSCP priority for RADIUS packets

#### About this task

DSCP priority determines the transmission
priority of RADIUS packets. A larger value represents a higher priority. DSCP priority
is contained in the ToS field of the IPv4 header and in the Traffic Class field
of the IPv6 header.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Set the DSCP priority for RADIUS packets.

radius \[ ipv6 ] dscp dscp-value

By default, the DSCP priority is 0 for
RADIUS packets.

### Configuring the format of the RADIUS NAS-Port attribute

#### About this task

The device supports the following formats
for the RADIUS NAS-Port attribute (attribute 5):

·     Default format—Contains the following portions:

¡     8-bit
IRF member ID.

¡     4-bit
slot number.

¡     8-bit
interface index.

¡     12-bit
VLAN ID. 

·     Port format—Contains the last segment for the interface number of the interface
through which a user accesses the device. For example, if a user accesses the
device through Ten-GigabitEthernet 1/0/2, 2 is used as the
value for the RADIUS NAS-Port attribute.

#### Restrictions and guidelines

RADIUS servers of different types might
have different requirements for the format of the NAS-Port attribute. To ensure
correct RADIUS packet exchange, make sure the format of the NAS-Port attribute
meets the requirements of the RADIUS servers.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Configure the format of the RADIUS NAS-Port
attribute as the port format.

attribute 5 format port

By default, the RADIUS NAS-Port attribute
uses the default format.

### Configuring the Login-Service attribute check method for SSH, FTP, and terminal users

#### About this task

The device supports the following check
methods for the Login-Service attribute (RADIUS attribute 15\) of SSH, FTP, and
terminal users:

·     Strict—Matches Login-Service attribute values 50, 51, and 52 for SSH, FTP,
and terminal services, respectively.

·     Loose—Matches the standard Login-Service attribute value 0 for SSH, FTP,
and terminal services.

An Access-Accept packet received for a user
must contain the matching attribute value. Otherwise, the user cannot log in to
the device.

#### Restrictions and guidelines

Use the loose check method only when the
server does not issue Login-Service attribute values 50, 51, and 52 for SSH,
FTP, and terminal users.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Configure the Login-Service attribute check
method for SSH, FTP, and terminal users.

attribute 15 check-mode
{ loose \| strict }

The default check method is strict.

### Interpreting the RADIUS class attribute as CAR parameters

#### About this task

A RADIUS server may deliver CAR parameters
for user-based traffic monitoring and control by using the RADIUS class
attribute (attribute 25\) in RADIUS packets. You can configure the device to
interpret the class attribute to CAR parameters.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Interpret the RADIUS class attribute as CAR
parameters.

attribute 25 car

By default, the RADIUS class attribute is
not interpreted as CAR parameters.

### Configuring the format of the RADIUS Called-Station-Id attribute

#### About this task

In a wireless network, RADIUS servers of
different types might have different requirements for the format of the RADIUS
Called-Station-Id attribute (attribute 30). The device supports the following
formats:

·     AP name. For example, ap1.

·     AP MAC. For example, 0AC1-F9B2-B1C2.

·     AP MAC plus delimiter plus SSID. For example, 0AC1-F9B2-B1C2:test1,
in which 0AC1-F9B2-B1C2 is the AP's MAC address, test1 is the SSID, and a colon (:) is used as the
delimiter.

·     AP name plus delimiter plus SSID. For example, ap1-test1,
in which ap1 is the AP's name, test1 is the SSID, and a hyphen (-) is used as the
delimiter.

The format of the MAC address in this
attribute can be customized by using the attribute 30 mac-format command.

#### Restrictions and guidelines

This configuration takes effect only on
RADIUS packets for portal, 802.1X, and MAC authentication users in a wireless
network.

Make sure the format of the
Called-Station-Id attribute meets the requirements of the RADIUS servers.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Configure the format of the RADIUS
Called-Station-Id attribute.

attribute 30 format { apmac-only \| apname-only \| { apmac-ssid \| apname-ssid } delimiter { colon \| hyphen } }

By default, the RADIUS Called-Station-Id
attribute is in the format of HH-HH-HH-HH-HH-HH:SSID. The HH-HH-HH-HH-HH-HH
argument is the AP's MAC address, the SSID
argument is the SSID, and a colon (:) is used as the delimiter.

### Configuring the MAC address format for the RADIUS Called-Station-Id attribute

#### Restrictions and guidelines

RADIUS servers of different types might
have different requirements for the MAC address format in the RADIUS
Called-Station-Id attribute (attribute 30). Configure the MAC address format
for this attribute to meet the requirements of the RADIUS servers.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Configure the MAC address format for the
RADIUS Called-Station-Id attribute.

attribute 30 mac-format section { one \| { six \| three } separator separator-character } { lowercase \| uppercase }

By default, the MAC address in the RADIUS
Called-Station-Id attribute is in the format of HH-HH-HH-HH-HH-HH. The MAC
address is separated by hyphen (-) into six sections with letters in upper
case.

### Configuring the MAC address format for the RADIUS Calling-Station-Id attribute

#### Restrictions and guidelines

RADIUS servers of different types might
have different requirements for the MAC address format in the RADIUS
Calling-Station-Id attribute (attribute 31). Configure the MAC address format
for this attribute to meet the requirements of the RADIUS servers.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Configure the MAC address format for the
RADIUS Calling-Station-Id attribute.

attribute 31 mac-format
section { one \| { six \| three } separator separator-character } { lowercase \| uppercase }

By default, the MAC address in the RADIUS
Calling-Station-Id attribute is in the format of HH-HH-HH-HH-HH-HH. The MAC
address is separated by hyphen (-) into six sections with letters in upper
case.

### Configuring the format of RADIUS attribute 87

#### About this task

RADIUS attribute 87 is the NAS-Port-Id
attribute. This attribute has the following format types:

·     Default format—The default format varies by user access type.

¡     For
portal users, the NAS-Port-Id attribute in this format contains the following
portions:

\-     2-bit slot number.

\-     2-bit 0s.

\-     3-bit interface index.

\-     9-bit VLAN ID.

¡     For
802.1X and MAC authentication users, the NAS-Port-Id attribute is in the format
of slot\=xx;subslot\=xx;port\=xx;vlanid\=xx.

\-     slot—IRF member
ID.

\-     subslot—Slot
number.

\-     port—Interface
index.

\-     vlanid—VLAN ID. 

¡     For
login users, the NAS-Port-Id attribute is not included in RADIUS packets.

·     Interface name format—Contains the name of the interface through which a user accesses
the device. For example, if a user accesses the device through Ten-GigabitEthernet 1/0/1, Ten-GigabitEthernet 1/0/1 is used as the
value for the RADIUS NAS-Port-Id attribute.

#### Restrictions and guidelines

RADIUS servers of different types might
have different requirements for the format of the NAS-Port-Id attribute. To
ensure correct RADIUS packet exchange, configure the format of the NAS-Port-Id
attribute to meet the requirements of the RADIUS servers.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Configure the format of RADIUS attribute 87
as the interface name format.

attribute 87 format interface-name

By default, the default format is used
for RADIUS attribute 87\.

### Setting the data measurement unit for the Remanent\_Volume attribute

#### About this task

The RADIUS server uses the Remanent\_Volume
attribute in authentication or real-time accounting responses to notify the
device of the current amount of data available for online users.

#### Restrictions and guidelines

Make sure the configured measurement unit
is the same as the user data measurement unit on the RADIUS server.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Set the data measurement unit for the
Remanent\_Volume attribute.

attribute remanent-volume unit { byte \| giga-byte \| kilo-byte \| mega-byte }

By default, the data measurement unit is
kilobyte.

### Includingsubattribute 218 of vendor 25506 in outgoing RADIUS packets

#### About this task

The RADIUS Vendor-Specific attribute
(attribute 26\) allows vendors to define extended attributes to implement
functions that the standard RADIUS protocol does not provide. Vendor 25506
defines subattribute 218 to carry user DHCP option information.

To send user DHCP option information to
RADIUS servers, perform this task to include subattribute 218 of vendor 25506
in outgoing RADIUS start-accounting and update-accounting requests.

In the current software version, only DHCP
Option 55 and DHCP Option 61 can be carried in the subattribute.

#### Restrictions and guidelines

You can repeat the include-attribute
218 vendor-id 25506 command to configure the
device to encapsulate both DHCP Option 55 and DHCP Option 61 in the
subattribute. The length of each option is limited to 246 bytes.

If you repeat this command multiple times
with the same DHCP option specified, the most recent configuration takes
effect.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Include subattribute 218 of vendor 25506 in
outgoing RADIUS packets.

include-attribute 218 vendor-id 25506 dhcp-option { 55 \| 61 } \* { format1 \| format2 }

By default, the device uses format 1 to
encapsulate DHCP Option 61 in subattribute 218 of vendor 25506 in RADIUS
packets.

### Configuring the RADIUS attribute translation feature

#### About this task

The RADIUS attribute translation feature
enables the device to work correctly with the RADIUS servers of different
vendors that support RADIUS attributes incompatible with the device.

RADIUS attribute translation has the
following implementations:

·     Attribute conversion—Converts source RADIUS attributes into destination RADIUS
attributes based on RADIUS attribute conversion rules.

·     Attribute rejection—Rejects RADIUS attributes based on RADIUS attribute rejection
rules.

When the RADIUS attribute translation
feature is enabled, the device processes RADIUS packets as follows:

·     For the sent RADIUS packets:

¡     Deletes
the rejected attributes from the packets.

¡     Uses
the destination RADIUS attributes to replace the attributes that match RADIUS
attribute conversion rules in the packets.

·     For the received RADIUS packets:

¡     Ignores
the rejected attributes in the packets.

¡     Interprets
the attributes that match RADIUS attribute conversion rules as the destination
RADIUS attributes.

To identify proprietary RADIUS attributes,
you can define the attributes as extended RADIUS attributes, and then convert
the extended RADIUS attributes to device-supported attributes.

#### Restrictions and guidelines for RADIUS attribute translation configuration

Configure either conversion rules or
rejection rules for a RADIUS attribute.

Configure either direction-based rules or
packet type-based rules for a RADIUS attribute.

For direction-based translation of a RADIUS attribute, you can
configure a rule for each direction (inbound or outbound).For packet type-based translation of a RADIUS attribute, you can
configure a rule for each RADIUS packet type (RADIUS Access-Accept, RADIUS
Access-Request, or RADIUS accounting).

#### Configuring the RADIUS attribute translation feature for a RADIUS scheme

**1\.**Enter system view.

system-view

**2\.**(Optional.) Define an extended RADIUS
attribute.

radius attribute extended attribute-name \[ vendor vendor-id ] code attribute-code type { binary \| date \| integer \| interface-id \| ip \| ipv6 \| ipv6-prefix \| octets \| string }

**3\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**4\.**Enable the RADIUS attribute translation
feature.

attribute translate

By default, this feature is disabled.

**5\.**Configure a RADIUS attribute conversion ruleor a RADIUS attribute reject rule. Choose the
following tasks as needed:

¡     Configure
a RADIUS attribute conversion rule.

attribute convert src-attr-name to dest-attr-name { { access-accept \| access-request \| accounting } \* \| { received \| sent } \* }

By default, no RADIUS attribute
conversion rules are configured.

¡     Configure
a RADIUS attribute rejection rule.

attribute reject attr-name { { access-accept \| access-request \| accounting } \* \| { received \| sent } \* }

By default, no RADIUS attribute rejection
rules are configured.

#### Configuring the RADIUS attribute translation feature for a RADIUS DAS

**1\.**Enter system view.

system-view

**2\.**(Optional.) Define an extended RADIUS
attribute.

radius attribute extended attribute-name \[ vendor vendor-id ] code attribute-code type { binary \| date \| integer \| interface-id \| ip \| ipv6 \| ipv6-prefix \| octets \| string }

**3\.**Enter RADIUS DAS view.

radius dynamic-author server

**4\.**Enable the RADIUS attribute translation
feature.

attribute translate

By default, this feature is disabled.

**5\.**Configure a RADIUS attribute conversion rule
or a RADIUS attribute rejection rule. Choose the following tasks as needed:

¡     Configure
a RADIUS attribute conversion rule.

attribute convert src-attr-name to dest-attr-name { { coa-ack \| coa-request } \* \| { received \| sent } \* }

By default, no RADIUS attribute
conversion rules are configured.

¡     Configure
a RADIUS attribute rejection rule.

attribute reject attr-name { { coa-ack \| coa-request } \* \| { received \| sent } \* }

By default, no RADIUS attribute rejection
rules are configured.

### Associating a microsegment with a VSI

#### About this task

Use this feature when microsegment-based
access control is deployed on a VXLAN network. 

When the RADIUS server assigns the
microsegment and VSI attributes to a user, the device directly assigns the
microsegment and VSI to the user so the user can access the related VXLAN
resources.

When the RADIUS server assigns only the
microsegment attribute but no VSI attribute to a user, the device will search
for a VSI associated with the microsegment.

·     If the device finds an associated VSI, it
assigns the microsegment and the VSI to the user.

·     If the device does not find an associated VSI,
it assigns only the microsegment to the user.

#### Hardware and feature compatibility

Only the S5560X-HI switch series and S6520X-HI
switch series support this feature.

#### Restrictions and guidelines

In a RADIUS scheme, a microsegment can be
associated with only one VSI. Multiple microsegments can be associated with the
same VSI. If you repeat the microsegment associate command to associate a microsegment with different VSIs, the most
recent configuration takes effect.

Make sure the device can interpret
microsegment IDs assigned by the RADIUS server. If the device cannot directly
interpret microsegment IDs, use the attribute translation feature so the device
can translate the server-assigned microsegment ID attribute to the
H3C-Microsegment-Id attribute.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Associate a microsegment with a VSI.

microsegment microsegment-id associate vsi vsi-name

By default, no VSI is associated with a
microsegment.

### Configuring RADIUS stop-accounting packet buffering

#### About this task

The device sends RADIUS stop-accounting
requests when it receives connection teardown requests from hosts or connection
teardown commands from an administrator. However, the device might fail to
receive a response for a stop-accounting request in a single transmission.
Enable the device to buffer RADIUS stop-accounting requests that have not
received responses from the accounting server. The device will resend the
requests until responses are received.

To limit the transmission times, set a
maximum number of transmission attempts that can be made for individual RADIUS
stop-accounting requests. When the maximum attempts are made for a request, the
device discards the buffered request.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Enable buffering of RADIUS stop-accounting
requests to which no responses have been received.

stop-accounting-buffer enable

By default, the buffering feature is
enabled.

**4\.**(Optional.) Set the maximum number of
transmission attempts for individual RADIUS stop-accounting requests.

retry stop-accounting retries

The default setting is 500\.

### Enabling forcibly sending stop-accounting packets

#### About this task

Typically, if the device does not send a
start-accounting packet to the RADIUS server for an authenticated user, it does
not send a stop-accounting packet when the user goes offline. If the server has
generated a user entry for the user without start-accounting packets, it does
not release the user entry when the user goes offline. This feature forces the device
to send stop-accounting packets to the RADIUS server when the user goes offline
for timely releasing the user entry on the server.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Enable the device to send stop-accounting
packets when users for which no start-accounting packets are sent go offline.

stop-accounting-packet send-force

By default, forcibly sending
stop-accounting packets is disabled. The device does not send stop-accounting
packets when users for which no start-accounting packets are sent go offline.

### Enabling the RADIUS server load sharing feature

#### About this task

By default, the device communicates with
RADIUS servers based on the server roles. It first attempts to communicate with
the primary server, and, if the primary server is unreachable, it then searches
for the secondary servers in the order they are configured. The first secondary
server in active state is used for communication. In this process, the workload
is always placed on the active server.

Use the RADIUS server load sharing feature
to dynamically distribute the workload over multiple servers regardless of
their server roles. The device forwards an AAA request to the most appropriate
server of all active servers in the scheme after it compares the weight values
and numbers of currently served users. Specify a weight value for each RADIUS
server based on the AAA capacity of the server. A larger weight value indicates
a higher AAA capacity.

In RADIUS server load sharing, once the
device sends a start-accounting request to a server for a user, it forwards all
subsequent accounting requests of the user to the same server. If the
accounting server is unreachable, the device returns an accounting failure
message rather than searching for another active accounting server.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Enable the RADIUS server load sharing
feature.

server-load-sharing enable

By default, this feature is disabled.

### Specifying a RADIUS server selection mode for reauthentication

#### About this task

Use this feature to configure the RADIUS
server selection mechanism in reauthentication. The following RADIUS server
selection modes are available:

·     Inherit—The device uses the RADIUS server that performed authentication for
a user to reauthenticate that user. This mode reduces the amount of time used
in reauthentication. However, if the RADIUS server is unreachable, the
reauthentication will fail.

·     Reselect—The device searches for a reachable RADIUS server to reauthenticate
a user. This mode requires more time than the inherit mode. However, this mode
ensures that the device uses the optimal reachable RADIUS server for
reauthentication. The following factors affect the RADIUS server selection:

¡     Server
configuration in the RADIUS scheme, including the configuration order.

¡     Enabling
status of the RADIUS server load sharing feature.

¡     Status
of the RADIUS servers in the RADIUS scheme.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Specify a RADIUS server selection mode for
reauthentication.

reauthentication server-select { inherit \| reselect }

By default, the inherit mode is used.

### Configuring the RADIUS accounting-on feature

#### About this task

When the accounting-on feature is enabled,
the device automatically sends an accounting-on packet to the RADIUS server
after the entire device reboots. Upon receiving the accounting-on packet, the
RADIUS server logs out all online users so they can log in again through the
device. Without this feature, users cannot log in again after the reboot,
because the RADIUS server considers them to come online.

You can configure the interval for which
the device waits to resend the accounting-on packet and the maximum number of
retries.

The extended accounting-on feature enhances
the accounting-on feature in a distributed architecture. 

The extended accounting-on feature is
applicable to LAN users. The user data is saved to the IRF member devices
through which the users access the system. When the extended accounting-on
feature is enabled, the system automatically sends an accounting-on packet to
the RADIUS server after a member device reboots. The packet contains the member
device identifier. Upon receiving the accounting-on packet, the RADIUS server
logs out all online users that access the system through the member device. If
no users have come online through the member device, the IRF fabric does not
send an accounting-on packet after the member device reboots.

#### Restrictions and guidelines

For the extended accounting-on feature to
take effect, the RADIUS server must run on IMC and the accounting-on feature
must be enabled.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter RADIUS scheme view.

radius scheme radius-scheme-name

**3\.**Enable accounting-on.

accounting-on enable \[ interval interval \| send send-times ] \*

By default, the accounting-on feature is
disabled.

**4\.**(Optional.) Enable extended accounting-on.

accounting-on extended

By default, extended accounting-on is
disabled.

### Configuring the RADIUS session-control feature

#### About this task

Enable this feature for the RADIUS server
to dynamically change the user authorization information (for example,
authorization ACL, VLAN, user group, VSI, or blackhole MAC) or forcibly
disconnect users by using session-control packets. This task enables the device
to receive RADIUS session-control packets on UDP port 1812\.

To verify the session-control packets sent
from a RADIUS server, specify the RADIUS server as a session-control client to
the device.

#### Restrictions and guidelines

The RADIUS session-control feature can only
work with RADIUS servers running on IMC. The session-control client
configuration takes effect only when the session-control feature is enabled.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enable the session-control feature.

radius session-control enable

By default, the session-control feature
is disabled.

**3\.**Specify a session-control client.

radius session-control client { ip ipv4-address \| ipv6 ipv6-address } \[ key { cipher \| simple } string \| vpn-instance vpn-instance-name
] \*

By default, no session-control clients
are specified.

### Configuring the RADIUS DAS feature

#### About this task

Dynamic Authorization Extensions (DAE) to
RADIUS, defined in RFC 5176, can log off online users and change online user
authorization information.

In a RADIUS network, the RADIUS server
typically acts as the DAE client (DAC) and the NAS acts as the DAE server
(DAS).

When the RADIUS DAS feature is enabled, the
NAS performs the following operations:

**1\.**Listens to the default or specified UDP port
to receive DAE requests.

**2\.**Logs off online users that match the
criteria in the requests, changes their authorization information, shuts down
or reboots their access ports, or reauthenticates the users.

**3\.**Sends DAE responses to the DAC.

DAE defines the following types of packets:

·     Disconnect Messages (DMs)—The DAC sends DM requests to the DAS to log off specific online
users.

·     Change of Authorization
Messages (CoA Messages)—The DAC sends CoA
requests to the DAS to change the authorization information of specific online
users.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enable the RADIUS DAS feature and enter RADIUS
DAS view.

radius dynamic-author server

By default, the RADIUS DAS feature is
disabled.

**3\.**Specify a RADIUS DAC.

client { ip ipv4-address \| ipv6 ipv6-address } \[ key { cipher \| simple } string \| vpn-instance vpn-instance-name
] \*

By default, no RADIUS DACs are specified.

**4\.**(Optional.) Specify the RADIUS DAS port.

port port-number

By default, the RADIUS DAS port is 3799\.

### Configuring the device to preferentially process RADIUS authentication requests

#### About this task

RADIUS requests include RADIUS
authentication requests, RADIUS accounting-start requests, RADIUS
accounting-update requests, and RADIUS accounting-stop requests. By default,
the device processes the RADIUS requests in the sequence that the requests are
initiated.

When a large number of users go offline and
then try to come online immediately, authentication might fail for these users
because of authentication request timeout. To resolve this issue, configure the
device to preferentially process authentication requests.

#### Restrictions and guidelines

Do not perform this task if the RADIUS
server identifies users by the username and does not allow repeated
authentication for the same username. A violation might cause authentication failure
for users that try to come online immediately after going offline.

As a best practice, do not perform this
task when the device has online users.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Configure the device to preferentially
process RADIUS authentication requests.

radius authentication-request first

By default, the device processes RADIUS
requests in the sequence that the requests are initiated.

### Enabling SNMP notifications for RADIUS

#### About this task

When SNMP notifications are enabled for
RADIUS, the SNMP agent supports the following notifications generated by
RADIUS:

·     RADIUS server unreachable
notification—The RADIUS server cannot be
reached. RADIUS generates this notification if it does not receive a response
to an accounting or authentication request within the specified number of
RADIUS request transmission attempts. 

·     RADIUS server reachable
notification—The RADIUS server can be reached.
RADIUS generates this notification for a previously blocked RADIUS server after
the quiet timer expires.

·     Excessive authentication
failures notification—The number of
authentication failures compared to the total number of authentication attempts
exceeds the specified threshold.

For RADIUS SNMP notifications to be sent
correctly, you must also configure SNMP on the device. For more information
about SNMP configuration, see Network Management and
Monitoring Configuration Guide.

#### Restrictions and guidelines

Make sure the RADIUS server status change
notifications sent by the device can be recognized by the NMS. Choose a MIB
node version depending on the NMS requirements. For more information about the
MIB node versions, see AAA in Security Command Reference.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enable SNMP notifications for RADIUS.

snmp-agent trap enable radius \[ accounting-server-down \| accounting-server-up \| authentication-error-threshold \| authentication-server-down \| authentication-server-up ] \*

By default, all SNMP notifications are
disabled for RADIUS.

**3\.**Set the version of RADIUS server status
change MIB nodes.

radius trap-version { v1 \| v2 } \[
accounting-server-down \| accounting-server-up \|
authentication-server-down \| authentication-server-up ] \*

By default, the device sends
notifications about RADIUS server status change MIB nodes over SNMPv1.

### Disabling the RADIUS service

#### About this task

By default, the RADIUS service is enabled.
The device can send and receive RADIUS packets. Attackers might use RADIUS
session-control and DAE ports to attack the device. To protect the device when
such an attack occurs, disable the RADIUS service temporarily on the device.
After the network is secure, re-enable the RADIUS service.

If settings on the RADIUS servers require
modification or the RADIUS servers cannot provide services temporarily, you can
temporarily disable the RADIUS service on the device.

When the RADIUS service is disabled, the
device stops sending and receiving RADIUS packets. If a new user comes online,
the device uses the backup authentication, authorization, or accounting method
to process that user. If the device has not finished requesting authentication
or accounting for a user before the RADIUS service is disabled, it uses the
following rules to process that user:

·     If the device has sent RADIUS authentication
requests for that user to a RADIUS server, the device processes that user
depending on whether it receives a response from the RADIUS server.

¡     If
the device receives a response from the RADIUS server, it uses the response to
determine whether that user has passed authentication. If that user has passed
authentication, the device assigns authorization information to that user
according to the response.

¡     If
the device does not receive any response from the RADIUS server, it attempts to
use the backup authentication method to authenticate that user.

·     If the device has sent RADIUS start-accounting requests
for that user to a RADIUS server, the device processes that user depending on
whether it receives a response from the RADIUS server.

¡     If
the device receives a response from the RADIUS server, it allows that user to
come online. However, the device cannot send out accounting-update or
stop-accounting requests to the RADIUS server. It cannot buffer the accounting
requests, either. When that user goes offline, the RADIUS server cannot log off
that user in time. The accounting result might be inaccurate.

¡     If
the device does not receive any response from the RADIUS server, it attempts to
use the backup accounting method.

#### Restrictions and guidelines

Disabling the RADIUS service does not
affect the RADIUS server feature of the device.

The authentication, authorization, and
accounting processes undertaken by other methods are not switched to RADIUS
when you re-enable the RADIUS service.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Disable the RADIUS service.

undo radius enable

By default, the RADIUS service is enabled.

To re-enable the RADIUS service, use the radius enable command.

### Display and maintenance commands for RADIUS

Execute display
commands in any view and reset commands in user
view.

 

| Task | Command |
| --- | --- |
| Display the RADIUS scheme configuration. | display radius scheme \[ radius-scheme-name ] || Display authentication and accounting load statistics for all RADIUS servers. | display radius server-load statistics || Display RADIUS packet statistics. | display radius statistics || Display information about buffered RADIUS stop-accounting requests to which no responses have been received. | display stop-accounting-buffer { radius-scheme radius-scheme-name \| session-id session-id \| time-range start-time end-time \| user-name user-name } || Clear history authentication and accounting load statistics for all RADIUS servers. | reset radius server-load statistics || Clear RADIUS statistics. | reset radius statistics || Clear the buffered RADIUS stop-accounting requests to which no responses have been received. | reset stop-accounting-buffer { radius-scheme radius-scheme-name \| session-id session-id \| time-range start-time end-time \| user-name user-name } |







 

## Configuring HWTACACS

### HWTACACS tasks at a glance

To configure HWTACACS, perform the
following tasks:

**1\.**[Creating an HWTACACS scheme](#_Ref263932527)

**2\.**[Specifying the HWTACACS authentication
servers](#_Ref472954497)

**3\.**[Specifying the HWTACACS authorization
servers](#_Ref472954502)

**4\.**[Specifying the HWTACACS accounting
servers](#_Ref472954506)

**5\.**[Specifying the shared keys for secure
HWTACACS communication](#_Ref294599434)

Perform this task if no shared keys are
specified when configuring HWTACACS servers.

**6\.**[Specifying an MPLS L3VPN instance for
the scheme](#_Ref327541931)

Perform this task if no MPLS L3VPN
instances are specified when configuring HWTACACS servers.

**7\.**(Optional.) [Setting HWTACACS timers](#_Ref472954535)

**8\.**(Optional.) Configuring parameters for
HWTACACS packets

¡     [Specifying the source IP address for
outgoing HWTACACS packets](#_Ref472954562)

¡     [Setting the username format and traffic
statistics units](#_Ref332382678)

¡     [Setting the DSCP priority for HWTACACS
packets](#_Ref106455149)

**9\.**(Optional.) [Configuring HWTACACS stop-accounting
packet buffering](#_Ref454791363)

### Creating an HWTACACSscheme

#### Restrictions and guidelines

You can configure a maximum of 16 HWTACACS
schemes. An HWTACACS scheme can be used by multiple ISP domains.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create an HWTACACS scheme and enter HWTACACS
scheme view.

hwtacacs scheme hwtacacs-scheme-name

### Specifying the HWTACACS authentication servers

#### About this task

You can specify one primary authentication server
and a maximum of 16 secondary authentication servers for an HWTACACS scheme.
When the primary server is unreachable, the device searches for the secondary
servers in the order they are configured. The first secondary server in active
state is used for communication.

#### Restrictions and guidelines

If redundancy is not required, specify only
the primary server. 

An HWTACACS server can function as the
primary authentication server in one scheme and as the secondary authentication
server in another scheme at the same time.

Two HWTACACS authentication servers in a
scheme, primary or secondary, cannot have the same combination of VPN instance,
host name, IP address, and port number.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter HWTACACS scheme view.

hwtacacs scheme hwtacacs-scheme-name

**3\.**Specify the primary HWTACACS authentication
server.

primary authentication { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| single-connection \| vpn-instance vpn-instance-name ] \*

By default, no primary HWTACACS
authentication server is specified.

**4\.**(Optional.) Specify a secondary HWTACACS
authentication server.

secondary authentication { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| single-connection \| vpn-instance vpn-instance-name
] \*

By default, no secondary HWTACACS
authentication servers are specified.

### Specifying the HWTACACS authorization servers

#### About this task

You can specify one primary authorization
server and a maximum of 16 secondary authorization servers for an HWTACACS
scheme. When the primary server is not available, the device searches for the
secondary servers in the order they are configured. The first secondary server
in active state is used for communication.

#### Restrictions and guidelines

If redundancy is not required, specify only
the primary server. 

An HWTACACS server can function as the
primary authorization server of one scheme and as the secondary authorization
server of another scheme at the same time.

Two HWTACACS authorization servers in a
scheme, primary or secondary, cannot have the same combination of VPN instance,
host name, IP address, and port number.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter HWTACACS scheme view.

hwtacacs scheme hwtacacs-scheme-name

**3\.**Specify the primary HWTACACS authorization
server.

primary authorization { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| single-connection \| vpn-instance vpn-instance-name ] \*

By default, no primary HWTACACS authorization
server is specified.

**4\.**(Optional.) Specify a secondary HWTACACS
authorization server.

secondary authorization { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| single-connection \| vpn-instance vpn-instance-name
] \*

By default, no secondary HWTACACS
authorization servers are specified.

### Specifying the HWTACACS accounting servers

#### About this task

You can specify one primary accounting
server and a maximum of 16 secondary accounting servers for an HWTACACS scheme.
When the primary server is not available, the device searches for the secondary
servers in the order they are configured. The first secondary server in active
state is used for communication.

#### Restrictions and guidelines

If redundancy is not required, specify only
the primary server. 

An HWTACACS server can function as the
primary accounting server of one scheme and as the secondary accounting server
of another scheme at the same time.

Two HWTACACS accounting servers in a
scheme, primary or secondary, cannot have the same combination of VPN instance,
host name, IP address, and port number.

HWTACACS does not support accounting for
FTP, SFTP, and SCP users.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter HWTACACS scheme view.

hwtacacs scheme hwtacacs-scheme-name

**3\.**Specify the primary HWTACACS accounting
server.

primary accounting { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| single-connection \| vpn-instance vpn-instance-name ] \*

By default, no primary HWTACACS
accounting server is specified.

**4\.**(Optional.) Specify a secondary HWTACACS
accounting server.

secondary accounting { host-name \| ipv4-address \| ipv6 ipv6-address } \[ port-number \| key { cipher \| simple } string \| single-connection \| vpn-instance vpn-instance-name
] \*

By default, no secondary HWTACACS
accounting servers are specified.

### Specifying the shared keys for secure HWTACACScommunication

#### About this task

The HWTACACS client and server use the MD5
algorithm and shared keys to generate the Authenticator value for packet
authentication and user password encryption. The client and server must use the
same key for each type of communication.

Perform this task to configure shared keys
for servers in an HWTACACS scheme. The keys take effect on all servers for
which a shared key is not individually configured.

#### Restrictions and guidelines

Make sure the shared key configured on the
device is the same as the shared key configured on the HWTACACS server.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter HWTACACS scheme view.

hwtacacs scheme hwtacacs-scheme-name

**3\.**Specify a shared key for secure HWTACACS
authentication, authorization, or accounting communication.

key { accounting \| authentication \| authorization } { cipher \| simple } string

By default, no shared key is specified
for secure HWTACACS communication.

### Specifying an MPLS L3VPNinstance for the scheme

#### About this task

The VPN instance specified for an HWTACACS
scheme applies to all servers in that scheme. If a VPN instance is also
configured for an individual HWTACACS server, the VPN instance specified for
the HWTACACS scheme does not take effect on that server.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter HWTACACS scheme view.

hwtacacs scheme hwtacacs-scheme-name

**3\.**Specify a VPN instance for the HWTACACS
scheme.

vpn-instance vpn-instance-name

By default, an HWTACACS scheme belongs to
the public network.

### Setting HWTACACS timers

#### About this task

The device uses the following timers to
control communication with an HWTACACS server: 

·     Server response timeout
timer (response-timeout)—Defines the HWTACACS
server response timeout timer. The device starts this timer immediately after
an HWTACACS authentication, authorization, or accounting request is sent. If
the device does not receive a response from the server within the timer, it
sets the server to blocked. Then, the device sends the request to another
HWTACACS server.

·     Real-time accounting timer
(realtime-accounting)—Defines the intervals at
which the device sends real-time accounting packets to the HWTACACS accounting
server for online users.

·     Server quiet timer (quiet)—Defines the duration to keep an unreachable server in blocked
state. If a server is not reachable, the device changes the server status to
blocked, starts this timer for the server, and tries to communicate with
another server in active state. After the server quiet timer expires, the
device changes the status of the server back to active.

The server quiet timer setting affects the
status of HWTACACS servers. If the scheme includes one primary HWTACACS server
and multiple secondary HWTACACS servers, the device communicates with the
HWTACACS servers based on the following rules:

·     When the primary server is in active state, the device
communicates with the primary server. When the primary server is unreachable,
the device researches a secondary server in active status in the order they are
configured.

·     When one or more servers are in active state,
the device tries to communicate with these servers only, even if they are
unreachable.

·     When all servers are in blocked state, the
device only tries to communicate with the primary server.

·     If the primary server is unreachable, the device
changes the server status to blocked and starts a quiet timer for the server.
When the quiet timer of the server expires, the status of the server changes
back to active. The device does not check the server again during the
authentication, authorization, or accounting process. 

·     The search process continues until the device
finds an available secondary server or has checked all secondary servers in
active state. If no server is available, the device considers the
authentication, authorization, or accounting attempt a failure.

·     When you remove a server in use, communication
with the server times out. The device looks for a server in active state by
first checking the primary server, and then checking secondary servers in the
order they are configured.

·     When an HWTACACS server's status changes
automatically, the device changes this server's status accordingly in all
HWTACACS schemes in which this server is specified.

#### Restrictions and guidelines

A short real-time accounting interval helps
improve accounting precision but requires many system resources. When there are
1000 or more users, set a real-time accounting interval longer than 15 minutes.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter HWTACACS scheme view.

hwtacacs scheme hwtacacs-scheme-name

**3\.**Set the HWTACACS timers. Choose the
following tasks as needed:

¡     Set
the HWTACACS server response timeout timer.

timer response-timeout seconds

By default, the HWTACACS server response
timeout timer is 5 seconds.

¡     Set
the real-time accounting interval.

timer realtime-accounting minutes

By default, the real-time accounting interval
is 12 minutes.

¡     Set
the server quiet timer.

timer quiet minutes

By default, the server quiet timer is 5
minutes.

### Specifying the source IP address for outgoing HWTACACS packets

#### About this task

The source IP address of HWTACACS packets
that a NAS sends must match the IP address of the NAS configured on the
HWTACACS server. An HWTACACS server identifies a NAS by IP address. When the
HWTACACS server receives a packet, it checks the source IP address of the
packet. 

·     If it is the IP address of a managed NAS, the
server processes the packet.

·     If it is not the IP address of a managed NAS,
the server drops the packet.

Before sending an HWTACACS packet, the NAS
selects a source IP address in the following order:

**1\.**The source IP address specified for the
HWTACACS scheme.

**2\.**The source IP address specified in system
view for the VPN or public network, depending on where the HWTACACS server
resides. 

**3\.**The IP address of the outbound interface
specified by the route.

#### Restrictions and guidelines for source IP address configuration

You can specify the source IP address for
outgoing HWTACACS packets in HWTACACS scheme view or in system view. 

·     The IP address specified in HWTACACS scheme view
applies to one HWTACACS scheme. 

·     The IP address specified in system view applies
to all HWTACACS schemes.

The source IP address of HWTACACS packets
that a NAS sends must match the IP address of the NAS that is configured on the
HWTACACS server. 

As a best practice, specify a loopback interface
address as the source IP address for outgoing HWTACACS packets to avoid
HWTACACS packet loss caused by physical port errors.

To communicate with the HWTACACS server,
the source address of outgoing HWTACACS packets is typically the IP address of
an egress interface on the NAS. However, in some situations, you must change
the source IP address. For example, when VRRP is configured for stateful
failover, configure the virtual IP of the uplink VRRP group as the source
address.

You can directly specify a source IP
address for outgoing HWTACACS packets or specify a source interface to provide
the source IP address for outgoing HWTACACS packets. The source interface
configuration and the source IP address configuration overwrite each other.

#### Specifying a source interface or source IP address for all HWTACACS schemes

**1\.**Enter system view.

system-view

**2\.**Specify a source interface or source IP address
for outgoing HWTACACS packets.

hwtacacs nas-ip { interface interface-type
interface-number \| { ipv4-address \| ipv6 ipv6-address } \[ vpn-instance vpn-instance-name
] }

By default, the source IP address of an
HWTACACS packet sent to the server is the primary IPv4 address or the IPv6
address of the outbound interface.

#### Specifying a source interface or source IP address for an HWTACACS scheme

**1\.**Enter system view.

system-view

**2\.**Enter HWTACACS scheme view.

hwtacacs scheme hwtacacs-scheme-name

**3\.**Specify a source interface or source IP
address for outgoing HWTACACS packets.

nas-ip { ipv4-address \| interface interface-type
interface-number \| ipv6 ipv6-address }

By default, the source IP address of an
outgoing HWTACACS packet is that configured by using the hwtacacs nas-ip command in system view. If the hwtacacs nas-ip command is not used, the source IP address is the primary IP
address of the outbound interface.

### Setting the username format and traffic statistics units

#### About this task

A username is typically in the userid@isp-name format,
where the isp-name part represents the user's ISP
domain name. By default, the ISP domain name is included in a username. If
HWTACACS servers do not recognize usernames that contain ISP domain names, you
can configure the device to send usernames without domain names to the servers.

The device reports online user traffic
statistics in accounting packets.

#### Restrictions and guidelines

If two or more ISP domains use the same
HWTACACS scheme, configure the HWTACACS scheme to keep the ISP domain name in
usernames for domain identification.

For accounting accuracy, make sure the
traffic measurement units configured on the device are the same as the traffic
measurement units configured on the HWTACACS accounting servers.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter HWTACACS scheme view.

hwtacacs scheme hwtacacs-scheme-name

**3\.**Set the format of usernames sent to the
HWTACACS servers.

user-name-format { keep-original \| with-domain \| without-domain }

By default, the ISP domain name is
included in a username.

**4\.**Set the data flow and packet measurement
units for traffic statistics.

data-flow-format { data { byte \| giga-byte \| kilo-byte \| mega-byte } \| packet { giga-packet \| kilo-packet \| mega-packet \| one-packet } }\*

By default, traffic is counted in bytes
and packets.

### Setting the DSCP priority for HWTACACS packets

#### About this task

DSCP priority determines the transmission
priority of HWTACACS packets. A larger value represents a higher priority.

DSCP priority is contained in the ToS field
of the IPv4 header and in the Traffic Class field of the IPv6 header.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Set the DSCP priority for HWTACACS packets.

hwtacacs \[ ipv6 ] dscp dscp-value

By default, the DSCP priority is 0 for
HWTACACS packets.

### Configuring HWTACACS stop-accounting packet buffering

#### About this task

The device sends HWTACACS stop-accounting
requests when it receives connection teardown requests from hosts or connection
teardown commands from an administrator. However, the device might fail to
receive a response for a stop-accounting request in a single transmission.
Enable the device to buffer HWTACACS stop-accounting requests that have not
received responses from the accounting server. The device will resend the
requests until responses are received.

To limit the transmission times, set a
maximum number of attempts that can be made for transmitting individual
HWTACACS stop-accounting requests. When the maximum attempts are made for a
request, the device discards the buffered request.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter HWTACACS scheme view.

hwtacacs scheme hwtacacs-scheme-name

**3\.**Enable buffering of HWTACACS stop-accounting
requests to which no responses have been received.

stop-accounting-buffer enable

By default, the buffering feature is
enabled.

**4\.**(Optional.) Set the maximum number of
transmission attempts for individual HWTACACS stop-accounting requests.

retry stop-accounting retries

The default setting is 100\.

### Display and maintenance commands for HWTACACS

Execute display
commands in any view and reset commands in user
view.

 

| Task | Command |
| --- | --- |
| Display the configuration or server statistics of HWTACACS schemes. | display hwtacacs scheme \[ hwtacacs-scheme-name \[ statistics ] ] || Display information about buffered HWTACACS stop-accounting requests to which no responses have been received. | display stop-accounting-buffer hwtacacs-scheme hwtacacs-scheme-name || Display HWTACACS packet statistics. | display hwtacacs statistics || Clear HWTACACS statistics. | reset hwtacacs statistics { accounting \| all \| authentication \| authorization } || Clear the buffered HWTACACS stop-accounting requests to which no responses have been received. | reset stop-accounting-buffer hwtacacs-scheme hwtacacs-scheme-name |





 

## Configuring LDAP

### LDAP tasks at a glance

To configure LDAP, perform the following
tasks:

**1\.**Configuring an LDAP server

**a.**[Creating an LDAP server](#_Ref303071623)

**b.**[Configuring the IP address of the LDAP
server](#_Ref303071693)

**c.**(Optional.) [Specifying the LDAP version](#_Ref472954651)

**d.**(Optional.) [Setting the LDAP server timeout period](#_Ref472954658)

**e.**[Configuring administrator attributes](#_Ref189452655)

**f.**[Configuring LDAP user attributes](#_Ref181452754)

**2\.**(Optional.) [Configuring an LDAP attribute map](#_Ref407543325)

**3\.**[Creating an LDAP scheme](#_Ref303072024)

**4\.**[Specifying the LDAP authentication
server](#_Ref303072130)

**5\.**(Optional.) [Specifying the LDAP authorization server](#_Ref407095169)

**6\.**(Optional.) [Specifying an LDAP attribute map for
LDAP authorization](#_Ref407543406)

### Creating an LDAPserver

**1\.**Enter system view.

system-view

**2\.**Create an LDAP server and enter LDAP server
view.

ldap server server-name

### Configuring the IP address of the LDAP server

#### Restrictions and guidelines

You can configure either an IPv4 address or
an IPv6 address for an LDAP server. If you configure the IP address for an LDAP
server multiple times, the most recent configuration takes effect.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter LDAP server view.

ldap server server-name

**3\.**Configure the IP address of the LDAP server.

{ ip ipv4-address \| ipv6 ipv6-address } \[ port port-number ] \[ vpn-instance
vpn-instance-name
]

By default, an LDAP server does not have
an IP address.

### Specifying the LDAP version

#### Restrictions and guidelines

The device supports LDAPv2 and LDAPv3. 

A Microsoft LDAP server supports only
LDAPv3.

The LDAP version specified on the device
must be consistent with the version specified on the LDAP server.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter LDAP server view.

ldap server server-name

**3\.**Specify the LDAP version.

protocol-version { v2 \| v3 }

By default, LDAPv3 is used.

### Setting the LDAP server timeout period

#### About this task

If the device sends a bind or search
request to an LDAP server without receiving the server's response within the
server timeout period, the authentication or authorization request times out.
Then, the device tries the backup authentication or authorization method. If no
backup method is configured in the ISP domain, the device considers the
authentication or authorization attempt a failure.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter LDAP server view.

ldap server server-name

**3\.**Set the LDAP server timeout period.

server-timeout time-interval

By default, the LDAP server timeout
period is 10 seconds.

### Configuring administrator attributes

#### About this task

To configure the administrator DN and
password for binding with the LDAP server during LDAP authentication:

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter LDAP server view.

ldap server server-name

**3\.**Specify the administrator DN.

login-dn dn-string

By default, no administrator DN is
specified.

The administrator DN specified on the
device must be the same as the administrator DN configured on the LDAP server.

**4\.**Configure the administrator password.

login-password { cipher \| simple } string

By default, no administrator password is
specified.

### ConfiguringLDAP user attributes

#### About this task

To authenticate a user, an LDAP client must
complete the following operations:

**1\.**Establish a connection to the LDAP server.

**2\.**Obtain the user DN from the LDAP server.

**3\.**Use the user DN and the user's password to
bind with the LDAP server.

LDAP provides a DN search mechanism for
obtaining the user DN. According to the mechanism, an LDAP client sends search
requests to the server based on the search policy determined by the LDAP user
attributes of the LDAP client.

The LDAP user attributes include:

·     Search base DN.

·     Search scope.

·     Username attribute.

·     Username format.

·     User object class.

#### Restrictions and guidelines

If the LDAP server contains many directory levels,
a user DN search starting from the root directory can take a long time. To
improve efficiency, you can change the start point by specifying the search
base DN.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter LDAP server view.

ldap server server-name

**3\.**Specify the user search base DN.

search-base-dn base-dn

By default, no user search base DN is
specified.

**4\.**(Optional.) Specify the user search scope.

search-scope { all-level \| single-level }

By default, the user search scope is all-level.

**5\.**(Optional.) Specify the username attribute.

user-parameters user-name-attribute { name-attribute \| cn \| uid }

By default, the username attribute is cn.

**6\.**(Optional.) Specify the username format.

user-parameters user-name-format { with-domain \| without-domain
}

By default, the username format is without-domain.

**7\.**(Optional.) Specify the user object class.

user-parameters user-object-class object-class-name

By default, no user object class is
specified, and the default user object class on the LDAP server is used. The
default user object class for this command varies by server model.

### Configuring an LDAP attribute map

#### About this task

Configure an LDAP attribute map to define a
list of LDAP-AAA attribute mapping entries. To apply the LDAP attribute map,
specify the name of the LDAP attribute map in the LDAP scheme used for authorization.

The LDAP attribute map feature enables the
device to convert LDAP attributes obtained from an LDAP authorization server to
device-recognizable AAA attributes based on the mapping entries. Because the
device ignores unrecognized LDAP attributes, configure the mapping entries to
include important LDAP attributes that should not be ignored.

An LDAP attribute can be mapped only to one
AAA attribute. Different LDAP attributes can be mapped to the same AAA
attribute.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create an LDAP attribute map and enter LDAP
attribute map view.

ldap attribute-map map-name

**3\.**Configure a mapping entry.

map ldap-attribute ldap-attribute-name \[ prefix prefix-value delimiter delimiter-value ] aaa-attribute { user-group \| user-profile }

### Creating an LDAP scheme

#### Restrictions and guidelines

You can configure a maximum of 16 LDAP
schemes. An LDAP scheme can be used by multiple ISP domains.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create an LDAP scheme and enter LDAP scheme
view.

ldap scheme ldap-scheme-name

### Specifying the LDAP authentication server

**1\.**Enter system view.

system-view

**2\.**Enter LDAP scheme view.

ldap scheme ldap-scheme-name

**3\.**Specify the LDAP authentication server.

authentication-server server-name

By default, no LDAP authentication server
is specified.

### Specifying the LDAP authorization server

**1\.**Enter system view.

system-view

**2\.**Enter LDAP scheme view.

ldap scheme ldap-scheme-name

**3\.**Specify the LDAP authorization server.

authorization-server server-name

By default, no LDAP authorization server
is specified.

### Specifying an LDAP attribute map for LDAP authorization

#### About this task

Specify an LDAP attribute map for LDAP
authorization to convert LDAP attributes obtained from the LDAP authorization
server to device-recognizable AAA attributes.

#### Restrictions and guidelines

You can specify only one LDAP attribute map
in an LDAP scheme.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter LDAP scheme view.

ldap scheme ldap-scheme-name

**3\.**Specify an LDAP attribute map.

attribute-map map-name

By default, no LDAP attribute map is
specified.

### Display and maintenance commands for LDAP

Execute display
commands in any view.

 

| Task | Command |
| --- | --- |
| Display the configuration of LDAP schemes. | display ldap scheme \[ ldap-scheme-name ] |

## Creating an ISP domain

### About ISP domains

In a networking scenario with multiple
ISPs, the device can connect to users of different ISPs. These users can have
different user attributes, such as different username and password structures,
different service types, and different rights. To manage users of different
ISPs, configure authentication, authorization, and accounting methods and
domain attributes for each ISP domain as needed.

The device supports a maximum of 16 ISP
domains, including the system-defined ISP domain system.
You can specify one of the ISP domains as the default domain. 

On the device, each user belongs to an ISP
domain. If a user does not provide an ISP domain name at login, the device
considers the user belongs to the default ISP domain. 

Each ISP domain has a set of system-defined
AAA methods, which are local authentication, local authorization, and local
accounting. If you do not configure any AAA methods for an ISP domain, the device
uses the system-defined AAA methods for users in the domain.

The device chooses an authentication domain
for each user in the following order:

**1\.**The authentication domain specified for the
access module.

**2\.**The ISP domain in the username.

**3\.**The default ISP domain of the device.

If the chosen domain does not exist on the
device, the device searches for the ISP domain that accommodates users assigned
to nonexistent domains. (Support for the authentication domain configuration
depends on the access module.) If no such ISP domain is configured, user
authentication fails.

### Restrictions and guidelines for ISP domain configuration

An ISP domain cannot be deleted when it is
the default ISP domain. Before you use the undo domain
command, change the domain to a non-default ISP domain by using the undo domain
default enable command.

You can modify the settings of the
system-defined ISP domain system, but you cannot
delete the domain.

To avoid RADIUS authentication,
authorization, or accounting failures, use short domain names to ensure that
usernames containing a domain name do not exceed 253 characters.

To avoid RADIUS accounting failures, make
sure the domain name contained in usernames sent to the RADIUS server does not
exceed 247 characters.

### Creating an ISP domain

**1\.**Enter system view.

system-view

**2\.**Create an ISP domain and enter ISP domain
view.

domain isp-name

By default, a system-defined ISP domain
exists. The domain name is system.

### Specifying the default ISP domain

**1\.**Enter system view.

system-view

**2\.**Specify the default ISP domain.

domain default enable isp-name

By default, the default ISP domain is the
system-defined ISP domain system.

### Specifying an ISP domain for users that are assigned to nonexistent domains

**1\.**Enter system view.

system-view

**2\.**Specify the ISP domain to accommodate users
that are assigned to nonexistent domains.

domain if-unknown isp-name

By default, no ISP domain is specified to
accommodate users that are assigned to nonexistent domains.

## Configuring ISP domain attributes

### Setting ISP domain status

#### About this task

By placing the ISP domain in active or
blocked state, you allow or deny network service requests from users in the
domain.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter ISP domain view.

domain isp-name

**3\.**Set the status of the ISP domain.

state { active \| block }

By default, an ISP domain is in active
state, and users in the domain can request network services.

### Configuring an authorization profile

#### About this task

An authorization profile defines a set of
authorization attributes and can be used to authorize network resources on a
VPN basis, for example, assigning different microsegments to different VPN
users. If you apply an authorization profile to an authentication domain, all users
in the domain can obtain network resources defined in the profile.

#### Hardware and feature compatibility

Only the S5560X-HI and S6520X-HI series
switches support this feature.

#### Restrictions and guidelines

Authorization profiles take effect only on
802.1X, MAC, and Web authentication users.

You can configure a maximum of 16
authorization profiles.

Deleting or changing an authorization
profile does not affect users that are using the profile. The configuration
change takes effect only on new clients that come online afterward.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create an authorization profile and enter
its view.

aaa author-profile profile-name

**3\.**Specify a VPN instance and microsegment
binding.

if-match vpn-instance vpn-instance-name microsegment microsegment-id \[ vsi vsi-name ]

By default, no VPN instance and
microsegment binding is specified.

You can bind a VPN instance only to one
microsegment but a microsegment to multiple VPN instances.

**4\.**Specify the default microsegment.

default microsegment microsegment-id \[ vsi vsi-name ]

By default, no default microsegment
exists.

The system authorizes the default
microsegment to non-VPN users and VPN users that do not match any VPN instance
specified by the if-match vpn-instance microsegment command.

### Configuring authorization attributes for an ISP domain

#### About this task

A user in an ISP domain can use the
following authorization attributes:

·     Attributes assigned by the server.

·     Attributes configured in the authentication domain.

·     Attributes defined in the authorization profile
applied to the authentication domain.

The priorities of the attributes are in
descending order.

The device supports the following
authorization attributes:

·     ACL—The device restricts authenticated users to access only the network
resources permitted by the ACL.

·     CAR action—The attribute controls the traffic flow of authenticated users.

·     Maximum number of multicast
groups—The attribute restricts the maximum
number of multicast groups that an authenticated user can join concurrently.

·     IPv4 address pool—The device assigns IPv4 addresses from the pool to authenticated
users in the domain.

·     IPv6 address pool—The device assigns IPv6 addresses from the pool to authenticated
users in the domain.

·     Microsegment—The device authorizes the authenticated users to access the network
resources in the specified microsegment.

·     Redirect URL—The device redirects users in the domain to the URL after they pass
authentication.

·     User group—Authenticated users in the domain obtain all attributes of the user
group.

·     User profile—The device restricts the user's behavior based on the user profile.

·     VLAN—The device authorizes the authenticated users to access the network
resources in the specified VLAN.

·     VSI—The device authorizes the authenticated users to access the network
resources in the specified VSI.

#### Restrictions and guidelines

To avoid user logoff caused by
authorization attribute conflicts, do not assign an authorization VSI and an
authorization VLAN at the same time. The conflict occurs in the following
cases:

·     The server authorizes a VSI through session
control or CoA messages to an online user that is authorized with a VLAN at
association.

·     The server authorizes a VLAN through session
control or CoA messages to an online user that is authorized with a VSI at
association.

·     The server authorizes a VSI through session
control or CoA messages to an online user that uses the default authorization
VLAN because no VLAN or VSI is authorized at association. 

#### Restrictions and guidelines

When you specify an authorized ACL, follow
these restrictions and guidelines:

·     If the specified ACL does not exist or the ACL
does not contain any rules, the system considers that no ACL is specified. If
the strict check method is enabled for portal authorized ACLs, the system logs
off portal users.

·     For LAN and portal users, the ACL takes effect
on both public and private network packets no matter if an ACL rule is
specified with a VPN instance. The specified VPN instance filtering criterion does
not take effect.

·     For portal users to come online after passing
authentication, make sure ACLs assigned to portal users do not have rules
specified with a source IP or MAC address.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter ISP domain view.

domain isp-name

**3\.**Configure authorization attributes for
authenticated users in the ISP domain.

authorization-attribute { acl acl-number \| author-profile profile-name \| car inbound cir committed-information-rate \[ pir peak-information-rate ] outbound cir
committed-information-rate \[ pir peak-information-rate ] \| igmp max-access-number max-access-number \| ip-pool ipv4-pool-name \| ipv6-pool ipv6-pool-name \| microsegment microsegment-id \| mld max-access-number max-access-number \| url url-string \| user-group user-group-name \| user-profile profile-name \| vlan vlan-id \| vsi vsi-name }

The default settings are as follows:

¡     An
IPv4 user can concurrently join a maximum of four IGMP multicast groups.

¡     An
IPv6 user can concurrently join a maximum of four MLD multicast groups.

¡     No
other authorization attributes exist. 

### Including the idle timeout period in the user online duration to be sent to the server

#### About this task

If a user goes offline due to connection
failure or malfunction, the user's online duration sent to the server includes
the idle timeout period assigned by the authorization server. The online
duration generated on the server is longer than the actual online duration of
the user.

For portal users, the device includes the
idle timeout period set for the online portal user detection feature in the
user online duration. For more information about online detection for portal
users, see "Configuring portal authentication."

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter ISP domain view.

domain isp-name

**3\.**Configure the device to include the idle
timeout period in the user online duration to be sent to the server.

session-time
include-idle-time

By default, the user online duration sent
to the server does not include the idle timeout period.

### Configuring the authentication failure policy for users in an ISP domain

#### About this task

By default, users cannot come online if
they fail authentication. To have authentication-failed users in an
authentication domain stay online and access a limited set of network
resources, specify an auth-fail domain to accommodate them. In the auth-fail
domain, you can specify a set of authorization and accounting schemes to assign
resources to the authentication-failed users.

#### Restrictions and guidelines

The authen-fail online feature is
applicable only to wired 802.1X, Web authentication, and MAC authentication
users.

The authen-fail online feature does not
apply to users that fail authentication for one of the following reasons:

·     Authentication times out, for example, because
no authentication servers respond or no matching local users are found.

·     The authentication domain is in blocked state or
is a denied domain.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter ISP domain view.

domain isp-name

**3\.**Configure the authentication failure policy
for users in the ISP domain.

authen-fail { offline \| online domain new-isp-name no-authen }

By default, the device logs out users in
an ISP domain if the users fail authentication.

## Configuring AAA methods for an ISP domain

### Configuring authentication methods for an ISP domain

#### Restrictions and guidelines

When you configure remote authentication,
follow these restrictions and guidelines:

·     For high availability, you can specify one
primary authentication method and multiple backup authentication methods. When
the primary method is invalid, the device attempts to use the backup methods in
sequence. For example, the radius-scheme radius-scheme-name local none parameters specify a primary RADIUS authentication method and two
backup methods (local authentication and no authentication). The device
performs RADIUS authentication by default and performs local authentication
when the RADIUS server is invalid. The device does not perform authentication
when both of the previous methods are invalid.

The remote authentication method is
invalid in the following situations:

¡     The
specified authentication scheme does not exist.

¡     The
device fails to send authentication request packets.

¡     The
device does not receive any authentication response packets from an
authentication server.

The local authentication method is
invalid if the device fails to find the matching local user configuration.

·     If the authentication method uses a RADIUS
scheme and the authorization method does not use a RADIUS scheme, AAA accepts
only the authentication result from the RADIUS server. The Access-Accept
message from the RADIUS server also includes the authorization information, but
the device ignores the information.

·     If an HWTACACS scheme is specified, the device
uses the entered username for role authentication. If a RADIUS scheme is
specified, the device uses username $enabn$ on the RADIUS server for
role authentication. The variable n represents a
user role level. For more information about user role authentication, see Fundamentals Configuration Guide.

The none keyword
is not supported in FIPS mode.

When the primary authenticationmethod is local, the following rules apply
to the authentication of a user:

·     The device uses the backup authentication
methods in sequence only if local authentication is invalid for one of the
following reasons:

¡     An
exception occurs in the local authentication process.

¡     The device
connection is terminated or the user account is not configured on the device.

·     The device does not turn to the backup
authentication methods if local authentication is invalid because ofany other reason. Authentication fails for the
user.

#### Prerequisites

Before configuring authentication methods,
complete the following tasks:

**1\.**Determine the access type or service type to
be configured. With AAA, you can configure an authentication method for each
access type and service type.

**2\.**Determine whether to configure the default
authentication method for all access types or service types. The default
authentication method applies to all access users. However, the method has a
lower priority than the authentication method that is specified for an access
type or service type.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter ISP domain view.

domain isp-name

**3\.**(Optional.) Specify default authentication
methods for all types of users.

authentication default { hwtacacs-scheme hwtacacs-scheme-name \[ radius-scheme radius-scheme-name ] \[ local ] \[ none ] \| ldap-scheme ldap-scheme-name \[ local ] \[ none ] \| local \[ radius-scheme radius-scheme-name \| hwtacacs-scheme
hwtacacs-scheme-name ] \* \[ none ] \| local \[ ldap-scheme ldap-scheme-name ] \| none \| radius-scheme radius-scheme-name \[ hwtacacs-scheme hwtacacs-scheme-name ] \[ local ] \[ none ] }

By default, the default authentication
method is local.

**4\.**Specify authentication methods for a user
type or a service.

¡     Specify
authentication methods for LAN users.

authentication lan-access { ldap-scheme ldap-scheme-name \[ local ] \[ none ] \| local \[ ldap-scheme ldap-scheme-name \| radius-scheme radius-scheme-name ] \[ none ] \| none \| radius-scheme radius-scheme-name \[ local ] \[ none ] }

By default, the default authentication
methods are used for LAN users.

¡     Specify
authentication methods for login users.

authentication login { hwtacacs-scheme hwtacacs-scheme-name \[ radius-scheme radius-scheme-name ] \[ local ] \[ none ] \| ldap-scheme ldap-scheme-name \[ local ] \[ none ] \| local \[ radius-scheme radius-scheme-name \| hwtacacs-scheme
hwtacacs-scheme-name ] \* \[ none ] \| local \[ ldap-scheme ldap-scheme-name ] \[ none ] \| none \| radius-scheme radius-scheme-name \[ hwtacacs-scheme hwtacacs-scheme-name ] \[ local ] \[ none ] }

By default, the default authentication
methods are used for login users.

¡     Specify
authentication methods for portal users.

authentication portal { ldap-scheme ldap-scheme-name \[ local ] \[ none ] \| local \[ ldap-scheme ldap-scheme-name \| radius-scheme radius-scheme-name ] \[ none ] \| none \| radius-scheme radius-scheme-name \[ local ] \[ none ] }

By default, the default authentication
methods are used for portal users.

¡     Specify
authentication methods for obtaining a temporary user role.

authentication super {
hwtacacs-scheme hwtacacs-scheme-name \| radius-scheme radius-scheme-name } \*

By default, the default authentication
methods are used for obtaining a temporary user role.

### Configuring authorization methods for an ISP domain

#### Restrictions and guidelines

For high availability, you can specify one
primary authorization method and multiple backup authorization methods. When
the primary method is invalid, the device attempts to use the backup methods in
sequence. For example, the radius-scheme radius-scheme-name local none parameters specify a primary RADIUS authorization method and two
backup methods (local authorization and no authorization). The device performs
RADIUS authorization by default and performs local authorization when the
RADIUS server is invalid. The device does not perform authorization when both
of the previous methods are invalid.

The remote authorization method is invalid
in the following situations:

·     The specified authorization scheme does not
exist.

·     The device fails to send authorization request
packets.

·     The device does not receive any authorization
response packets from an authorization server.

The local authorization method is invalid
if the device fails to find the matching local user configuration.

Only SSL VPN users support LDAP
authorization in the current software version.

To use a RADIUS scheme as the authorization
method, specify the name of the RADIUS scheme that is configured as the
authentication method for the ISP domain. If an invalid RADIUS scheme is
specified as the authorization method, RADIUS authentication and authorization
fail.

The none keyword
is not supported in FIPS mode.

When the primary authorization method is
local, the following rules apply:

·     The device uses the backup authorization methods
in sequence only if local authorization is invalid for one of the following
reasons:

¡     An
exception occurs in the local authorization process.

¡     The device
connection is terminated or the user account is not configured on the device

·     The device does not turn to the backup
authorization methods if local authorization is invalid because of any other
reason. Authorization fails for the user.

#### Prerequisites

Before configuring authorization methods,
complete the following tasks:

**1\.**Determine the access type or service type to
be configured. With AAA, you can configure an authorization scheme for each
access type and service type.

**2\.**Determine whether to configure the default
authorization method for all access types or service types. The default
authorization method applies to all access users. However, the method has a
lower priority than the authorization method that is specified for an access
type or service type.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter ISP domain view.

domain isp-name

**3\.**(Optional.) Specify default authorization
methods for all types of users.

authorization default { hwtacacs-scheme hwtacacs-scheme-name \[ radius-scheme radius-scheme-name ] \[ local ] \[ none ] \| local \[ radius-scheme radius-scheme-name \| hwtacacs-scheme
hwtacacs-scheme-name ] \* \[ none ] \| none \| radius-scheme radius-scheme-name \[ hwtacacs-scheme hwtacacs-scheme-name ] \[ local ] \[ none ] }

By default, the authorization method is local.

**4\.**Specify authorization methods for a user
type or a service.

¡     Specify
command authorization methods.

authorization command { hwtacacs-scheme hwtacacs-scheme-name
\[ local ] \[ none ] \| local \[ none ] \| none }

By default, the default authorization
methods are used for command authorization.

¡     Specify
authorization methods for LAN users.

authorization lan-access { local \[ radius-scheme radius-scheme-name ] \[ none ] \| none \| radius-scheme radius-scheme-name \[ local ] \[ none ] }

By default, the default authorization
methods are used for LAN users.

¡     Specify
authorization methods for login users.

authorization login {
hwtacacs-scheme hwtacacs-scheme-name \[ radius-scheme radius-scheme-name ] \[ local ] \[ none ] \| local \[ radius-scheme radius-scheme-name \| hwtacacs-scheme
hwtacacs-scheme-name ] \* \[ none ] \| none \| radius-scheme radius-scheme-name \[ hwtacacs-scheme hwtacacs-scheme-name ] \[ local ] \[ none ] }

By default, the default authorization
methods are used for login users.

¡     Specify
authorization methods for portal users.

authorization portal { local \[ radius-scheme radius-scheme-name ] \[ none ] \| none \| radius-scheme radius-scheme-name \[ local ] \[ none ] }

By default, the default authorization
methods are used for portal users.

### Configuring accounting methods for an ISP domain

#### Restrictions and guidelines

For high availability, you can specify one
primary accounting method and multiple backup accounting methods. When the
primary method is invalid, the device attempts to use the backup methods in
sequence. For example, the radius-scheme radius-scheme-name local none parameters specify a primary RADIUS accounting method and two
backup methods (local accounting and no accounting). The device performs RADIUS
accounting by default and performs local accounting when the RADIUS server is
invalid. The device does not perform accounting when both of the previous
methods are invalid.

The remote accounting method is invalid in
the following situations:

·     The specified accounting scheme does not exist.

·     The device fails to send accounting request
packets.

·     The device does not receive any accounting
response packets from an accounting server.

The local accounting method is invalid if
the device fails to find the matching local user configuration.

FTP, SFTP, and SCP users do not support
accounting.

Local accounting does not provide statistics
for charging. It only counts and controls the number of concurrent users that
use the same local user account. The threshold is configured by using the access-limit command.

The none keyword
is not supported in FIPS mode.

When the primary accounting method is
local, the following rules apply:

·     The device uses the backup accounting methods in
sequence only if local accounting is invalid for one of the following reasons:

¡     An
exception occurs in the local accounting process.

¡     The device
connection is terminated or the user account is not configured on the device

·     The device does not turn to the backup accounting
methods if local accounting is invalid because of any other reason. Accounting
fails for the user.

#### Prerequisites

Before configuring accounting methods,
complete the following tasks:

**1\.**Determine the access type or service type to
be configured. With AAA, you can configure an accounting method for each access
type and service type.

**2\.**Determine whether to configure the default
accounting method for all access types or service types. The default accounting
method applies to all access users. However, the method has a lower priority
than the accounting method that is specified for an access type or service
type.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enter ISP domain view.

domain isp-name

**3\.**(Optional.) Specify default accounting
methods for all types of users.

accounting default { hwtacacs-scheme hwtacacs-scheme-name \[ radius-scheme radius-scheme-name ] \[ local ] \[ none ] \| local \[ radius-scheme radius-scheme-name \| hwtacacs-scheme
hwtacacs-scheme-name ] \* \[ none ] \| none \| radius-scheme radius-scheme-name \[ hwtacacs-scheme hwtacacs-scheme-name ] \[ local ] \[ none ] }

By default, the accounting method is local.

**4\.**Specify accounting methods for a user type.

¡     Specify
the command accounting method.

accounting command hwtacacs-scheme hwtacacs-scheme-name

By default, the default accounting
methods are used for command accounting.

¡     Specify
accounting methods for LAN users.

accounting lan-access { broadcast radius-scheme
radius-scheme-name1 radius-scheme radius-scheme-name2 \[ local ] \[ none ] \| local \[ radius-scheme radius-scheme-name ] \[ none ] \| none \| radius-scheme radius-scheme-name \[ local ] \[ none ] }

By default, the default accounting
methods are used for LAN users.

¡     Specify
accounting methods for login users.

accounting login { hwtacacs-scheme hwtacacs-scheme-name \[ radius-scheme radius-scheme-name ] \[ local ] \[ none ] \| local \[ radius-scheme radius-scheme-name \| hwtacacs-scheme
hwtacacs-scheme-name ] \* \[ none ] \| none \| radius-scheme radius-scheme-name \[ hwtacacs-scheme hwtacacs-scheme-name ] \[ local ] \[ none ] }

By default, the default accounting
methods are used for login users.

¡     Specify
accounting methods for portal users.

accounting portal { broadcast radius-scheme
radius-scheme-name1 radius-scheme radius-scheme-name2 \[ local ] \[ none ] \| local \[ radius-scheme radius-scheme-name ] \[ none ] \| none \| radius-scheme radius-scheme-name \[ local ] \[ none ] }

By default, the default accounting
methods are used for portal users.

**5\.**(Optional.) Configure extended accounting
policies.

¡     Configure
access control for users that encounter accounting-start failures.

accounting start-fail { offline \| online }

By default, the device allows users that
encounter accounting-start failures to stay online.

¡     Configure
access control for users that have failed all their accounting-update attempts.

accounting update-fail { \[ max-times max-times ] offline \| online }

By default, the device allows users that
have failed all their accounting-update attempts to stay online.

¡     Configure
access control for users that have used up their data or time accounting
quotas.

accounting quota-out { offline \| online }

By default, the device logs off users
that have used up their accounting quotas.

### Display and maintenance commands for ISP domains

Execute display
commands in any view.

 

| Task | Command |
| --- | --- |
| Display configuration information about an ISP domain or all ISP domains. | display domain \[ isp-name ] || Display authorization profile information. | display aaa author-profile |


 

## Configuring a critical profile

#### About this task

During authentication, if all authentication
servers in the authentication scheme are unreachable, the device will not
receive authentication responses from the server and users will fail
authentication. 

To resolve this issue, you can configure a
critical profile and apply the profile to a port to accommodate the users when
all authentication servers are unreachable. The users in a critical profile can
access only network resources in the critical profile, such as the critical
microsegment. For users in a VPN instance, the users can access the critical
microsegment specified for the VPN instance. If no critical microsegment is
specified for the VPN instance, the users can access the default critical
microsegment.

#### Hardware and feature compatibility

Only the S5560X-HI switch series and
S6520X-HI switch series support this feature. 

#### Restrictions and guidelines

This feature is applicable only to 802.1X
and MAC authentication users.

If you remove a critical profile from a
port or edit the configuration in the critical profile, the change does not
take effect on users already in the critical profile.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create a critical profile and enter its
view.

aaa critical-profile profile-name

**3\.**Specify the default critical microsegment.

default critical-microsegment microsegment-id \[ vsi vsi-name ] \[ url-user-logoff ]

The url-user-logoff keyword is applicable only to MAC authentication users.

**4\.**Specify the critical microsegment for a VPN
instance.

if-match vpn-instance
vpn-instance-name critical-microsegment microsegment-id \[ vsi vsi-name ] \[ url-user-logoff ]

By default, no critical microsegment is
specified for a VPN instance.

The url-user-logoff keyword is applicable only to MAC authentication users.

## Configuring AAA fail-permit and recovery

#### About this task

This feature is used to resolve the issue
that users cannot come online when all RADIUS servers are unavailable. The
feature contains the following settings in a user authentication domain:

·     In the user authentication domain, specify a
critical domain (also known as fail-permit domain) to accommodate users that
access the authentication domain when all RADIUS servers are unavailable. The
users can come online in the critical domain without being authenticated when
all RADIUS servers are unavailable.

·     In the user authentication domain, specify an
action to take on users that have been assigned to the critical domain when a
RADIUS server becomes available.

¡     To
perform authentication, authorization, and accounting for the users, log off
the users.

¡     To
allow the users to stay online without being authenticated, specify a recovery
domain. When a RADIUS server becomes available, the users in the critical
domain are assigned to the recovery domain.

¡     To
reauthenticate users in the original authentication domain without users being
aware of the process, specify the reauthentication action.

For the device to obtain the status of
RADIUS authentication servers in time, it detects the status of the RADIUS
authentication servers in each RADIUS scheme at intervals. In addition, the device
notifies access modules to remove users that use a RADIUS scheme from the
critical domain when that RADIUS scheme has reachable RADIUS servers.

#### Restrictions and guidelines

This feature takes effect only on the
802.1X authentication, Web authentication, and MAC authentication for wired
users.

When you specify a critical domain for an
ISP domain, follow these restrictions and guidelines:

·     If non-none authentication, authorization, or
accounting methods are configured in the critical domain for an ISP domain, the
non-none authentication or authorization methods cannot take effect on users.
However, the non-none accounting methods in the critical domain can take effect
on users.

·     If an ISP domain has been specified as a
critical domain, do not specify a critical domain for that ISP domain. If you
do so, the critical domain specified for that ISP domain cannot take effect.

·     If a critical domain has been specified for an
ISP domain, do not specify that ISP domain as a critical domain. If you do so,
that ISP domain cannot act as a critical domain.

When you specify a recovery domain for an
ISP domain, follow these restrictions and guidelines:

·     If the none method
is configured as the backup authentication method in the original
authentication domain before the users are assigned to the critical domain, the
users are still assigned to the recovery domain when a RADIUS server becomes
available.

·     As a best practice to accurately identify
whether a RADIUS authentication server is available and the recovery
configuration can take effect in time, configure RADIUS server status
detection.

·     In the current software version, you can specify
only an ISP domain as its own recovery domain in the view of the ISP domain.

When you set the interval at which the
device detects the status of RADIUS authentication servers, follow these
restrictions and guidelines:

·     A too short interval consumes too many system
resources for access services. A too long interval cannot detect server status
changes in time.

·     As a best practice, consider the processing
efficiency for access services and the accuracy for fail-permit and recovery
when a large number of users come online in a short time.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**(Optional.) Set the interval at which the
device detects the status of RADIUS authentication servers.

radius-server authen-state-check interval interval

By default, the device detects the status
of RADIUS authentication servers at intervals of 10 minutes.

**3\.**Enter ISP domain view.

domain isp-name

**4\.**Specify a critical domain to accommodate
users that access the ISP domain when all RADIUS servers are unavailable.

authen-radius-unavailable online domain new-isp-name

By default, no critical domain is
specified for an ISP domain to accommodate users that access the ISP domain
when all RADIUS servers are unavailable.

**5\.**Specify an action to take on users in the
critical domain when a RADIUS server becomes available.

authen-radius-recover { offline \| online domain new-isp-name \| re-authen }

By default, no action is specified for
users in the critical domain when a RADIUS server becomes available.

## Setting the maximum number of concurrent login users

#### About this task

Perform this task to set the maximum number
of concurrent users that can log on to the device through a specific protocol,
regardless of their authentication methods. The authentication methods include
no authentication, local authentication, and remote authentication.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Set the maximum number of concurrent login
users.

In non-FIPS mode:

aaa session-limit { ftp \| http \| https \| ssh \| telnet } max-sessions

In FIPS mode:

aaa session-limit { https \| ssh } max-sessions

By default, the maximum number of
concurrent login users is 32 for each user type.

## Configuring BYODendpoint identification

### About BYOD endpoint identification rules

Bring Your Own Device (BYOD) solution
provides authentication and authorization services for companies, organization,
and users based on their identity information, endpoint information, and access
scenarios.

A BYOD endpoint identification rule defines
the mapping between an endpoint type and a fingerprint string or between a
group of endpoint attributes and a fingerprint string. When a user comes
online, the device obtains the fingerprint information of the user's endpoint
and matches the fingerprint information with the local BYOD endpoint
identification rules. If a match is found, the device recognizes the endpoint
type or endpoint attributes of the user's endpoint as the endpoint type or
endpoint attributes associated with the matching rule.

The device supports the following endpoint
fingerprints:

·     DHCP Option 55 fingerprint—Parameter request list option. The option is used by an endpoint to
request specified configuration parameters.

·     HTTP user agent fingerprint—Located in the header of HTTP requests to carry information about
the endpoint operating system, Web browser, and versions.

·     MAC address fingerprint—OUI of the endpoint or MAC address range to which the endpoint
belongs.

The device can use BYOD endpoint
identification rules to identify the following information:

·     Endpoint attributes, including the endpoint
vendor, category, and operating system.

·     Endpoint type, for example, Generic Android.

The system has predefined BYOD endpoint
identification rules. You can also configure BYOD endpoint identification rules
depending on the network requirements. The following categories of BYOD
endpoint identification rules are supported:

·     BYOD endpoint attribute
identification rule—Defines a mapping between a
group of endpoint attributes with a fingerprint string. This category of BYOD
endpoint identification rules are used by other service modules to identify
endpoints. For example, when EPA is monitoring online and offline events of
endpoints accessing the IP network through the device, it uses BYOD endpoint
attribute identification rules to recognize endpoint attributes.

·     BYOD endpoint type
identification rule—Defines a mapping between an
endpoint type and a fingerprint string. This category of BYOD endpoint
identification rules are used for local BYOD authorization.

### BYOD endpoint identification tasks at a glance

To configure BYOD endpoint identification,
perform the following tasks:

**1\.**Configure BYOD endpoint identification rules

¡     [Configuring BYOD endpoint attribute
identification rules](#_Ref75271113)

Perform this task according to service
module requirements.

¡     [Configuring BYOD endpoint type
identification rules](#_Ref75271119)

This task is applicable only to local
BYOD authorization.

**2\.**[Specifying the supported BYOD endpoint
identification rule types and their priority order](#_Ref75271131)

**3\.**[Configuring authorization attributes for
local BYOD authorization](#_Ref75271142)

This task is applicable only to local
BYOD authorization.

### Configuring BYOD endpoint attribute identification rules

#### Restrictions and guidelines

A fingerprint string can match only one set
of endpoint attributes. However, the same endpoint attribute can be associated
with multiple fingerprint strings.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create a BYOD endpoint attribute
identification rule and enter its view, or enter the view of an existing BYOD
endpoint attribute identification rule.

byod rule { dhcp-option option-string \| http-user-agent agent-string \| mac-address mac-address mask mac-mask } device-attributes

By default, only predefined BYOD endpoint
attribute identification rules exist.

**3\.**Specify an endpoint category to match the
BYOD endpoint attribute identification rule.

device-category category-name

By default, no endpoint category is
specified for a user-defined BYOD endpoint attribute identification rule. To
view whether an endpoint category is specified for a predefined BYOD endpoint
attribute identification rule, use the display byod rule command.

**4\.**Specify an endpoint operating system to
match the BYOD endpoint attribute identification rule.

device-os os-name

By default, no endpoint operating system
is specified for a user-defined BYOD endpoint attribute identification rule. To
view whether an endpoint operating system is specified for a predefined BYOD
endpoint attribute identification rule, use the display byod
rule command.

**5\.**Specify an endpoint vendor to match the BYOD
endpoint attribute identification rule.

device-vendor vendor-name

By default, no endpoint vendor is
specified for a user-defined BYOD endpoint attribute identification rule. To
view whether an endpoint vendor is specified for a predefined BYOD endpoint
attribute identification rule, use the display byod rule command.

### Configuring BYOD endpoint type identification rules

#### Restrictions and guidelines

A fingerprint string can match only one
endpoint type. However, an endpoint type can be associated with multiple
fingerprint strings. 

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Configure a BYOD endpoint type
identification rule.

byod rule { dhcp-option option-string \| http-user-agent agent-string \| mac-address mac-address mask mac-mask } device-type type-name

By default, only predefined BYOD endpoint
type identification rules exist.

### Specifying the supported BYOD endpoint identification rule types and their priority order

#### About this task

By default, the device uses DHCP Option
55-based rules, HTTP user agent-based rules, and MAC address-based rules in
sequence to identify endpoints.

To meet requirements in different networks,
you can specify the supported BYOD endpoint identification rule types and their
priority order.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Specify the supported BYOD endpoint
identification rule types and their priority order.

byod rule-order { dhcp-option
\| http-user-agent \| mac-address } \*

By default, the device uses the following
types of BYOD endpoint identification rules to identify endpoints and the
priority order is as follows:

**a.**DHCP Option 55-based rules.

**b.**HTTP user agent-based rules.

**c.**MAC address-based rule.

The order of the keywords in this command
determines the priority order of the BYOD endpoint identification rule types.
To preferentially use a type of BYOD endpoint identification rules, specify
that rule type first in the command.

### Configuring authorization attributes for local BYOD authorization

#### About this task

After a user passes local authentication,
the device uses the local BYOD endpoint type identification rules to identify
the endpoint type of the user. Then, the device assigns the BYOD authorization
attributes specified in the user's user group to the user based on the endpoint
type.

#### Restrictions and guidelines

The device supports endpoint type-specific
BYOD authorization only for network access users. For a user, an endpoint type-specific
authorization attribute takes precedence over the same common authorization
attribute specified for the user. A common authorization attribute specified
for the user takes precedence over the same common authorization attribute
specified for the user group to which the user belongs.

When you specify an authorized ACL, follow
these restrictions and guidelines:

·     If the specified ACL does not exist or the ACL
does not contain any rules, the system considers that no ACL is specified. If
the strict check method is enabled for portal authorized ACLs, the system logs
off portal users.

·     For LAN and portal users, the ACL takes effect
on both public and private network packets no matter if an ACL rule is
specified with a VPN instance. The specified VPN instance filtering criterion
does not take effect.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create a user group and enter user group
view.

user-group group-name

By default, a user group named system exists on the device.

**3\.**Configure authorization attributes for a
type of BYOD endpoints in the user group.

byod authorization device-type type-name { acl acl-number \| callback-number callback-number \| idle-cut minutes \| ip-pool ipv4-pool-name \| ipv6-pool ipv6-pool-name \| ipv6-prefix ipv6-prefix
prefix-length \| { primary-dns \| secondary-dns } { ip ipv4-address \| ipv6 ipv6-address } \| session-timeout minutes \| url url-string \| user-profile
profile-name \| vlan vlan-id \| vpn-instance
vpn-instance-name } \*

By default, no authorization attributes
are configured for any type of BYOD endpoints.

### Display and maintenance commands for BYOD endpoint identification

Execute display
commands in any view.

 

| Task | Command |
| --- | --- |
| Display BYOD endpoint identification rules. | display byod rule { dhcp-option \[ option-string ] \| http-user-agent \[ agent-string ] \| mac-address \[ mac-address ] } || Display the supported types of BYOD endpoint identification rules and their priority order. | display byod rule-order || Display BYOD authorization information for a user group. | display user-group name group-name byod-authorization |



 

## Configuring a NAS-ID

#### About this task

During RADIUS authentication, the device
uses a NAS-ID to set the NAS-Identifier attribute of RADIUS packets so that the
RADIUS server can identify the access location of users. 

Configure a NAS-ID profile to maintain
NAS-ID and VLAN bindings on the device so that the device can send different
NAS-Identifier attribute strings in RADIUS requests from different VLANs.

#### Restrictions and guidelines

You can apply a NAS-ID profile to portal-
or port security-enabled interfaces. For more information, see "Configuring
portal authentication" and "Configuring port security."

You can configure multiple NAS-ID and VLAN
bindings in a NAS-ID profile.

A NAS-ID can be bound with more than one
VLAN, but a VLAN can be bound with only one NAS-ID. If you configure multiple
bindings for the same VLAN, the most recent configuration takes effect.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Create a NAS-ID profile and enter NAS-ID
profile view.

aaa nas-id profile profile-name

**3\.**Configure a NAS-ID and VLAN binding in the
profile.

nas-id nas-identifier bind vlan vlan-id

## Configuring the device ID

#### About this task

RADIUS uses the value of the
Acct-Session-ID attribute as the accounting ID for a user. The device generates
an Acct-Session-ID value for each online user based on the system time, random
digits, and device ID. 

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Configure the device ID.

aaa device-id device-id

By default, the device ID is 0\.

## Enabling password change prompt logging

#### About this task

Use this feature to enhance the protection
of passwords for Telnet, SSH, HTTP, HTTPS, NETCONF over SSH, and NETCONF over
SOAP users and improve the system security. 

This feature enables the device to generate
logs to prompt users to change their weak passwords at an interval of 24 hours
and at the users' login. 

A password is a weak password if it does
not meet the following requirements:

·     Password composition restriction configured by
using the password-control composition command.

·     Minimum password length restriction set by using
the password-control
length command.

·     Password complexity checking policy configured
by using the password-control complexity command.

For a NETCONF over SSH or NETCONF over SOAP
user, the device also generates a password change prompt log if any of the
following conditions exists:

·     The current password of the user is the default
password or has expired.

·     The user logs in to the device for the first
time or uses a new password to log in after global password control is enabled.

The device will no longer generate password
change prompt logs for a user when one of the following conditions exists:

·     The password change prompt logging feature is
disabled.

·     The user has changed the password and the new
password meets the password control requirements.

·     The enabling status of a related password
control feature has changed so the current password of the user meets the
password control requirements. 

·     The password composition policy or the minimum
password length has changed.

#### Restrictions and guidelines

You can use the display
password-control command to display password
control configuration. For more information about password control commands,
see password control commands in Security Command
Reference.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Enable password change prompt logging.

local-server log change-password-prompt

By default, password change prompt
logging is enabled.

## Configuring the RADIUS server feature

### RADIUS server feature tasks at a glance

To configure the RADIUS server feature,
perform the following tasks:

**1\.**[Configuring RADIUS users](#_Ref480396816)

**2\.**[Specifying RADIUS clients](#_Ref452022667)

**3\.**[Activating the RADIUS server
configuration](#_Ref452022669)

### Restrictions and guidelines for the RADIUS server feature

To ensure correct operation of the RADIUS
server feature, disable RADIUS session-control on the device.

### Configuring RADIUS users

To configure RADIUS users, you must
configure network access users, which are the basis of RADIUS user data.

A RADIUS user has the following attributes:
user name, password, description, authorization ACL, authorization VLAN, and
expiration time. For more information, see "[Configuring attributes for network
access users](#_Ref454547459)."

### Specifying RADIUS clients

#### About this task

Perform this task to specify RADIUS clients
and shared keys for centralized management. The RADIUS server feature does not
accept requests from RADIUS clients that are not managed by the system.

#### Restrictions and guidelines

The IP address of a RADIUS client must be
the same as the source IP address for outgoing RADIUS packets specified on the
RADIUS client.

The shared key of a RADIUS client specified
on the RADIUS server must be the same as the setting on the RADIUS client.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Specify a RADIUS client.

radius-server client ip ipv4-address key { cipher \| simple } string

### Activating the RADIUS server configuration

#### About this task

At the device startup, the RADIUS server
configuration is automatically activated, including RADIUS users and RADIUS
clients. You can immediately activate the most recent RADIUS server
configuration if you have added, modified, or deleted RADIUS clients and
network access users from which RADIUS user data is generated.

#### Procedure

**1\.**Enter system view.

system-view

**2\.**Activate the RADIUS server configuration.

radius-server activate

Executing this command restarts the
RADIUS server process and an authentication service interruption will occur
during the restart.

### Display and maintenance commands for RADIUS users and clients

Execute display
commands in any view.

 

| Task | Command |
| --- | --- |
| Display information about activated RADIUS users. | display radius-server active-user \[ user-name ] || Display information about activated RADIUS clients. | display radius-server active-client |


 

## Configuring the connection recording policy

### About the connection recording policy

Use this feature on scenarios where the
device acts as an FTP, SSH, SFTP, or Telnet login client to establish a
connection with a login server. This feature enables the device to provide an
accounting server with the connection start and termination information. When
the login client establishes a connection with the login server, the system
sends a start-accounting request to the accounting server. When the connection
is terminated, the system sends a stop-accounting request to the accounting
server.

### Restrictions and guidelines

The device includes the username entered by
a user in the accounting packets to be sent to the AAA server for connection
recording. The username format configured by using the user-name-format
command in the accounting scheme does not take
effect.

### Procedure

**1\.**Enter system view.

system-view

**2\.**Create a connection recording policy and
enter its view.

aaa connection-recording policy

**3\.**Specify the accounting method for the
connection recording policy.

accounting hwtacacs-scheme hwtacacs-scheme-name

### Display and maintenance commands for the connection recording policy

Execute display
commands in any view.

 

| Task | Command |
| --- | --- |
| Display the connection recording policy configuration. | display aaa connection-recording policy |

 

## Displaying user MAC and UUID binding entries

#### About this task

To help administrators identify whether a
universally unique identifier (UUID) has been assigned to a user and maintain
the MAC and UUID binding entries for users, use this feature. 

In some scenarios, administrators configure
and manage MAC address and UUID binding entries for users on the authentication
server, depending on the user access control policies. The binding entries will
be assigned to the users after they pass authentication. The device
automatically generates the MAC and UUID binding entry of a user when the user
comes online and automatically deletes the binding entry when the user goes
offline.

When a user's client requests the DHCP
server to assign or release an IP address, the DHCP snooping module first
searches for the UUID bound to the client MAC address. Then, the device
replaces the value of Option 61 (client ID) in the client's DHCP packets with
the UUID and forwards the DHCP packets to the DHCP server. The DHCP server will
assign or reclaim an IP address based on the UUID in the received DHCP packets.
UUID-based IP address assignment flexibly meets the IP address requirements of
different scenarios.

#### Restrictions and guidelines

The device supports user MAC and UUID
binding entries only for 802.1X and MAC authentication users that use the iNode
client.

#### Procedure

To display user MAC and UUID binding
entries, execute the following command in any view:

display mubm record \[ mac mac-address ] \[ interface interface-type
interface-number \| slot slot-number ] \[ access-type { dot1x \| mac-auth } ]

## Configuring the AAA test feature

#### About this task

This feature enables the device to send
authentication or accounting requests to the specified AAA servers to simulate
an authentication or accounting process of a user. Use this feature to identify
the reasons for the failure of the interaction between the device and the AAA
servers. This feature is applicable only to RADIUS.

When performing an AAA test, the device
ignores the status of the specified AAA servers and the RADIUS server load
sharing feature. The process of an AAA test is as follows:

**1\.**The device sends authentication requests
that carry the specified username and password to the specified authentication
server or to the authentication servers in the specified RADIUS scheme. The
device tries to communicate with the authentication servers in the specified
scheme in sequence.

The process goes to the next step in the
following situations:

¡     The
device receives an authentication response (no matter the authentication
succeeds or fails).

¡     The
device does not receive any authentication response after making all
authentication request attempts.

This step is skipped if no correct
authentication server is specified for the AAA test or no authentication
servers are configured in the specified RADIUS scheme.

**2\.**The device sends start-accounting requests
to the specified accounting server or to the accounting servers in the
specified RADIUS scheme. The device tries to communicate with the accounting
servers in the specified scheme in sequence.

The process goes to the next step in the
following situations:

¡     The
device receives a start-accounting response (no matter the accounting succeeds
or fails).

¡     The
device does not receive any start-accounting response after making all
start-accounting request attempts.

This step and the next step are skipped
if no correct accounting server is specified for the AAA test or no accounting
servers are configured in the specified RADIUS scheme.

**3\.**The device sends stop-accounting requests to
the accounting servers to which it has sent a start-accounting request.

The process finishes in the following
situations:

¡     The
device receives a stop-accounting response.

¡     The
device does not receive any stop-accounting response after making all
stop-accounting request attempts.

To identify attributes that cause
authentication or accounting failures, you can configure the device to carry
specific attributes in RADIUS requests or define values for specific attributes
in the requests. [Table 3](#_Ref508632356)
shows the attributes that RADIUS requests carry by default. 

Table 3 Attributes that RADIUS requests carry
by default

| Packet type | Attributes that the type of packets carry by default |
| --- | --- |
| RADIUS authentication request | User-Name  CHAP-Password (or User-Password)  CHAP-Challenge  NAS-IP-Address (or NAS-IPv6-Address)  Service-Type  Framed-Protocol  NAS-Identifier  NAS-Port-Type  Acct-Session-Id || RADIUS accounting request | User-Name  Acct-Status-Type  NAS-IP-Address (or NAS-IPv6-Address)  NAS-Identifier  Acct-Session-Id  Acct-Delay-Time  Acct-Terminate-Cause |


 

#### Restrictions and guidelines

When you perform an AAA test, follow these
restrictions and guidelines:

·     The device might communicate with the AAA
servers incorrectly during an AAA test. Make sure no users come online or go
offline during an AAA text.

·     If the configuration of the specified RADIUS
scheme changes, the new configuration does not affect the current AAA test. The
modification will take effect in the next test.

·     The system can have only one AAA test at a time.
Another AAA test can be performed only after the current test finishes.

When you configure attributes to be included
in or excluded from RADIUS requests, follow these restrictions and guidelines:

·     Before you include an attribute that is already
configured to be excluded from RADIUS requests, you must cancel the exclusion
configuration by using the undo exclude command.

·     Before you exclude an attribute that is already
configured to be included in RADIUS requests, you must cancel the inclusion
configuration by using the undo include command.

#### Prerequisites

Before you perform an AAA test, you must
configure a RADIUS scheme that contains the RADIUS servers to be tested.

Plan the RADIUS attributes to be included
in RADIUS requests. Besides the attributes carried by default, the device adds
the specified attributes to RADIUS packets in the order that they are specified
by using the include command.
Additional attributes cannot be added to a RADIUS request if the length of the
RADIUS request reaches 4096 bytes.

#### Procedure

**1\.**(Optional.) Configure a RADIUS attribute
test group:

**a.**Enter system view.

system-view

**b.**Create a RADIUS attribute test group and
enter its view.

radius attribute-test-group attr-test-group-name

You can create multiple RADIUS attribute
test groups.

**c.**Include an attribute in RADIUS requests.

include { accounting \| authentication } { name attribute-name \| \[ vendor vendor-id ] code attribute-code } type { binary \| date \| integer \| interface-id \| ip \| ipv6 \| ipv6-prefix \| octets \| string } value attribute-value

Use this command to add attributes that
RADIUS requests do not carry by default to the RADIUS requests.

For an attribute that RADIUS requests
carry by default, you can use this command to change its attribute value.

**d.**Exclude an attribute from RADIUS requests.

exclude { accounting \| authentication } name attribute-name

Use this command to exclude an attribute
that RADIUS requests carry by default from the RADIUS requests sent during an
AAA test to help troubleshoot authentication or accounting failures.

**e.**Return to system view.

quit

**f.**Return to user view.

quit

**2\.**Perform an AAA test in user view.

test-aaa user user-name password password radius-scheme radius-scheme-name \[ radius-server { ipv4-address \| ipv6 ipv6-address } port-number \[ vpn-instance vpn-instance-name ] ] \[ chap \| pap ] \[ attribute-test-group attr-test-group-name ] \[ trace ]

## AAA configuration examples

### Example: Configuring AAA for SSH users by an HWTACACS server

#### Network configuration

As shown in [Figure 14](#_Ref302634961),
configure the switch to meet the following requirements:

·     Use the HWTACACS server for SSH user
authentication, authorization, and accounting.

·     Assign the default user role network-operator to SSH users after they pass
authentication.

·     Exclude domain names from the usernames sent to
the HWTACACS server.

·     Use expert as the
shared keys for secure HWTACACS communication.

Figure 14 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705263_x_Img_x_png_14_2216062_294551_0.png)

 

#### Configuring the HWTACACS server

\# Set the shared keys to expert for secure communication with the switch, add an
account for the SSH user, and specify the password. (Details not shown.)

#### Configuring the switch

\# Configure IP addresses for the
interfaces. (Details not shown.)

\# Create an HWTACACS scheme.

\<Switch\> system-view

\[Switch] hwtacacs scheme hwtac

\# Specify the primary authentication
server.

\[Switch-hwtacacs-hwtac] primary
authentication 10.1.1.1 49

\# Specify the primary authorization server.

\[Switch-hwtacacs-hwtac] primary
authorization 10.1.1.1 49

\# Specify the primary accounting server.

\[Switch-hwtacacs-hwtac] primary
accounting 10.1.1.1 49

\# Set the shared keys to expert in plaintext form for secure HWTACACS
communication.

\[Switch-hwtacacs-hwtac] key
authentication simple expert

\[Switch-hwtacacs-hwtac] key authorization
simple expert

\[Switch-hwtacacs-hwtac] key
accounting simple expert

\# Exclude domain names from the usernames
sent to the HWTACACS server.

\[Switch-hwtacacs-hwtac]
user-name-format without-domain

\[Switch-hwtacacs-hwtac] quit

\# Create an ISP domain named bbb and configure the domain to use the HWTACACS scheme
for authentication, authorization, and accounting of login users.

\[Switch-isp-bbb] authentication login
hwtacacs-scheme hwtac

\[Switch-isp-bbb] authorization login
hwtacacs-scheme hwtac

\[Switch-isp-bbb] accounting login
hwtacacs-scheme hwtac

\[Switch-isp-bbb] quit

\# Create local RSA and DSA key pairs.

\[Switch] public-key local create rsa

\[Switch] public-key local create dsa

\# Enable the Stelnet service.

\[Switch] ssh server enable

\# Enable scheme authentication for user
lines VTY 0 through VTY 63\.

\[Switch] line vty 0 63

\[Switch-line-vty0-63]
authentication-mode scheme

\[Switch-line-vty0-63] quit

\# Enable the default user role feature to
assign authenticated SSH users the default user role network-operator.

\[Switch] role default-role enable

#### Verifying the configuration

\# Initiate an SSH connection to the switch,
and enter the correct username and password. The user logs in to the switch.
(Details not shown.)

\# Verify that the user can use the commands
permitted by the network-operator user role. (Details not shown.)

### Example: Configuring local authentication, HWTACACS authorization, and RADIUS accounting for SSH users

#### Network configuration

As shown in [Figure 15](#_Ref302634964), configure
the switch to meet the following requirements:

·     Perform local authentication for SSH users.

·     Use the HWTACACS server and RADIUS server for
SSH user authorization and accounting, respectively.

·     Exclude domain names from the usernames sent to
the servers.

·     Assign the default user role network-operator to SSH users after they pass
authentication.

Configure an account named hello for the SSH user. Configure the shared keys to expert for secure communication with the HWTACACS server
and RADIUS server.

Figure 15 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705264_x_Img_x_png_15_2216062_294551_0.png)

 

#### Configuring the HWTACACS server

\# Set the shared keys to expert for secure communication with the switch, add an
account for the SSH user, and specify the password. (Details not shown.)

#### Configuring the RADIUS server

\# Set the shared keys to expert for secure communication with the switch, add an
account for the SSH user, and specify the password. (Details not shown.)

#### Configuring the switch

\# Configure IP addresses for interfaces.
(Details not shown.)

\# Create local RSA and DSA key pairs.

\<Switch\> system-view

\[Switch] public-key local create rsa

\[Switch] public-key local create dsa

\# Enable the Stelnet service.

\[Switch] ssh server enable

\# Enable scheme authentication for user
lines VTY 0 through VTY 63\.

\[Switch] line vty 0 63

\[Switch-line-vty0-63]
authentication-mode scheme

\[Switch-line-vty0-63] quit

\# Configure an HWTACACS scheme.

\[Switch] hwtacacs scheme hwtac

\[Switch-hwtacacs-hwtac] primary
authorization 10.1.1.2 49

\[Switch-hwtacacs-hwtac] key
authorization simple expert

\[Switch-hwtacacs-hwtac]
user-name-format without-domain

\[Switch-hwtacacs-hwtac] quit

\# Configure a RADIUS scheme.

\[Switch] radius scheme rd

\[Switch-radius-rd] primary accounting
10.1.1.1 1813

\[Switch-radius-rd] key accounting
simple expert

\[Switch-radius-rd] user-name-format
without-domain

\[Switch-radius-rd] quit

\# Create a device management user.

\[Switch] local-user hello class
manage

\# Assign the SSH service to the local user.

\[Switch-luser-manage-hello]
service-type ssh

\# Set the password to 123456TESTplat\&!
in plaintext form for the local user. In FIPS mode, you must set the password
in interactive mode.

\[Switch-luser-manage-hello] password
simple 123456TESTplat\&!

\[Switch-luser-manage-hello] quit

\# Create an ISP domain named bbb and configure the login users to use local
authentication, HWTACACS authorization, and RADIUS accounting.

\[Switch] domain bbb

\[Switch-isp-bbb] authentication login
local

\[Switch-isp-bbb] authorization login
hwtacacs-scheme hwtac

\[Switch-isp-bbb] accounting login
radius-scheme rd

\[Switch-isp-bbb] quit

\# Enable the default user role feature to
assign authenticated SSH users the default user role network-operator.

\[Switch] role default-role enable

#### Verifying the configuration

\# Initiate an SSH connection to the switch,
and enter username hello@bbb and the correct
password. The user logs in to the switch. (Details not shown.) 

\# Verify that the user can use the commands
permitted by the network-operator user role. (Details not shown.)

### Example: Configuring authentication and authorization for SSH users by a RADIUS server

#### Network configuration

As shown in [Figure 16](#_Ref302634967),
configure the switch to meet the following requirements:

·     Use the RADIUS server for SSH user
authentication and authorization.

·     Include domain names in the usernames sent to
the RADIUS server.

·     Assign the network-admin
user role to SSH users after they pass authentication.

The RADIUS server runs IMC PLAT 7.3 (E0605)
and IMC UAM 7.3 (E0512). Add an account with username hello@bbb
on the RADIUS server.

The RADIUS server and the switch use expert as the shared key for secure RADIUS communication.
The ports for authentication and accounting are 1812
and 1813, respectively.

Figure 16 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705265_x_Img_x_png_16_2216062_294551_0.png)

 

#### Configuring the RADIUS server

**1\.**Add the switch to the IMC Platform as an
access device:

Log in to IMC, click the User tab, and
select User Access Policy \> Access Device
Management \> Access Device from the navigation
tree. Then, click Add to configure an access device as follows:

**a.**Set the ports for authentication and
accounting to 1812 and 1813, respectively.

**b.**Select Device
Management Service from the Service Type
list.

**c.**Select H3C (General)
from the Access Device Type list.

**d.**Set the shared key to expert
for secure RADIUS communication.

**e.**Select an access device from the device list
or manually add an access device. In this example, the device IP address is
10.1.1.2.

**f.**Use the default values for other parameters
and click OK.

The IP address of the access device
specified here must be the same as the source IP address of the RADIUS packets
sent from the switch. The source IP address is chosen in the following order on
the switch:

¡     IP
address specified by using the nas-ip
command.

¡     IP
address specified by using the radius nas-ip command.

¡     IP
address of the outbound interface (the default).

Figure
17 Adding the switch as an access device

![](https://resource.h3c.com/en/202407/12/20240712_11705266_x_Img_x_png_17_2216062_294551_0.png)

 

**1\.**Add an account for device management:

Click the User tab, and select Device User \>
Device User from the navigation tree. Then, click Add to configure a device management
account as follows:

**a.**Enter account name hello@bbb
and specify the password.

**b.**Select SSH from
the Login Type list.

**c.**Enter user role network-admin.

**d.**Specify 10.1.1.0 to 10.1.1.255 as the IP
address range of the hosts to be managed.

**e.**Click OK.

 

|  | NOTE:  The IP address range must contain the IP address of the switch. |
| --- | --- |

 

Figure
18 Adding an account for device management

![](https://resource.h3c.com/en/202407/12/20240712_11705267_x_Img_x_png_18_2216062_294551_0.png)

 

#### Configuring the switch

\# Configure IP addresses for interfaces.
(Details not shown.)

\# Create local RSA and DSA key pairs.

\<Switch\> system-view

\[Switch] public-key local create rsa

\[Switch] public-key local create dsa

\# Enable the Stelnet service.

\[Switch] ssh server enable

\# Enable scheme authentication for user
lines VTY 0 through VTY 63\.

\[Switch] line vty 0 63

\[Switch-line-vty0-63]
authentication-mode scheme

\[Switch-line-vty0-63] quit

\# Create a RADIUS scheme.

\[Switch] radius scheme rad

\# Specify the primary authentication
server. 

\[Switch-radius-rad] primary
authentication 10.1.1.1 1812

\# Set the shared key to expert in plaintext form for secure communication with
the server.

\[Switch-radius-rad] key
authentication simple expert

\# Include domain names in the usernames
sent to the RADIUS server.

\[Switch-radius-rad] user-name-format
with-domain

\[Switch-radius-rad] quit

\# Create an ISP domain named bbb and configure authentication, authorization, and
accounting methods for login users.

\[Switch] domain bbb

\[Switch-isp-bbb] authentication login
radius-scheme rad

\[Switch-isp-bbb] authorization login
radius-scheme rad

\[Switch-isp-bbb] accounting login
none

\[Switch-isp-bbb] quit

#### Verifying the configuration

\# Initiate an SSH connection to the switch,
and enter username hello@bbb and the correct
password. The user logs in to the switch. (Details not shown.)

\# Verify that the user can use the commands
permitted by the network-admin user role. (Details not shown.)

### Example: Configuring authentication for SSH users by an LDAP server

#### Network configuration

As shown in [Figure 19](#_Ref302634973),
the LDAP server uses domain ldap.com and runs
Microsoft Windows 2003 Server Active Directory.

Configure the switch to meet the following
requirements:

·     Use the LDAP server to authenticate SSH users.

·     Assign the level-0 user role to SSH users after
they pass authentication.

On the LDAP server, set the administrator
password to admin!123456, add a user named aaa, and set the user's password to ldap!123456.

Figure 19 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705268_x_Img_x_png_19_2216062_294551_0.png)

 

#### Configuring the LDAP server

**1\.**Add a user named aaa
and set the password to ldap!123456: 

**a.**On the LDAP server, select Start \> Control Panel \>
Administrative Tools.

**b.**Double-click Active
Directory Users and Computers.

The Active Directory Users and Computers
window is displayed.

**c.**From the navigation tree, click Users under the ldap.com
node.

**d.**Select Action
\> New \> User from
the menu to display the dialog box for adding a user. 

**e.**Enter logon name aaa
and click Next.

Figure
20 Adding user aaa

![](https://resource.h3c.com/en/202407/12/20240712_11705270_x_Img_x_png_20_2216062_294551_0.png)

 

**f.**In the dialog box, enter password ldap!123456, select options as needed, and click Next.

Figure
21 Setting the user's password

![](https://resource.h3c.com/en/202407/12/20240712_11705271_x_Img_x_png_21_2216062_294551_0.png)

 

**g.**Click OK.

**2\.**Add user aaa to
group Users:

**a.**From the navigation tree, click Users under the ldap.com
node.

**b.**In the right pane, right-click user aaa and select Properties. 

**c.**In the dialog box, click the Member Of tab and click Add.

Figure
22 Modifying user properties

![](https://resource.h3c.com/en/202407/12/20240712_11705272_x_Img_x_png_22_2216062_294551_0.png)

 

**d.**In the Select Groups
dialog box, enter Users in the Enter the object names to select field, and click OK.

User aaa is added to group Users.

Figure
23 Adding user aaa to group Users

![](https://resource.h3c.com/en/202407/12/20240712_11705273_x_Img_x_png_23_2216062_294551_0.png)

 

**1\.**Set the administrator password to admin!123456: 

**a.**In the right pane, right-click user Administrator and select Set
Password.

**b.**In the dialog box, enter the administrator
password. (Details not shown.)

#### Configuring the switch

\# Configure IP addresses for interfaces.
(Details not shown.)

\# Create local RSA and DSA key pairs.

\<Switch\> system-view

\[Switch] public-key local create rsa

\[Switch] public-key local create dsa

\# Enable the Stelnet service.

\[Switch] ssh server enable

\# Enable scheme authentication for user
lines VTY 0 through VTY 63\.

\[Switch] line vty 0 63

\[Switch-line-vty0-63]
authentication-mode scheme

\[Switch-line-vty0-63] quit

\# Configure an LDAP server. 

\[Switch] ldap server ldap1

\# Specify the IP address of the LDAP
authentication server.

\[Switch-ldap-server-ldap1] ip
10.1.1.1

\# Specify the administrator DN.

\[Switch-ldap-server-ldap1] login-dn
cn\=administrator,cn\=users,dc\=ldap,dc\=com

\# Specify the administrator password.

\[Switch-ldap-server-ldap1]
login-password simple admin!123456

\# Configure the base DN for user search.

\[Switch-ldap-server-ldap1]
search-base-dn dc\=ldap,dc\=com

\[Switch-ldap-server-ldap1] quit

\# Create an LDAP scheme.

\[Switch] ldap scheme ldap-shm1

\# Specify the LDAP authentication server.

\[Switch-ldap-ldap-shm1]
authentication-server ldap1

\[Switch-ldap-ldap-shm1] quit

\# Create an ISP domain named bbb and configure authentication, authorization, and
accounting methods for login users.

\[Switch] domain bbb

\[Switch-isp-bbb] authentication login
ldap-scheme ldap-shm1

\[Switch-isp-bbb] authorization login
none

\[Switch-isp-bbb] accounting login
none

\[Switch-isp-bbb] quit

#### Verifying the configuration

\# Initiate an SSH connection to the switch,
and enter username aaa@bbb and password ldap!123456. The user logs in to the switch. (Details not
shown.)

\# Verify that the user can use the commands
permitted by the level-0 user role. (Details not shown.)

### Example: Configuring AAA for 802.1X users by a RADIUS server

#### Network configuration

As shown in [Figure 24](#_Ref302719877),
configure the switch to meet the following requirements:

·     Use the RADIUS server for authentication,
authorization, and accounting of 802.1X users.

·     Use MAC-based access control on Ten-GigabitEthernet 1/0/1 to authenticate all
802.1X users on the port separately.

·     Include domain names in the usernames sent to
the RADIUS server.

In this example, the RADIUS server runs IMC
PLAT 7.1 (E0303), IMC UAM 7.1 (E0304), and IMC CAMS 7.1 (E0301). On the RADIUS
server, perform the following tasks:

·     Add a service that charges 120 dollars for up to
120 hours per month and assigns authenticated users to VLAN 4\.

·     Configure a user with name dot1x@bbb
and assign the service to the user.

Set the shared keys to expert for secure RADIUS communication. Set the ports for
authentication and accounting to 1812 and 1813, respectively.

Figure 24 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705274_x_Img_x_png_24_2216062_294551_0.png)

‌

#### Configuring the RADIUS server

**1\.**Add the switch to the IMC Platform as an
access device:

Log in to IMC, click the User tab, and
select User Access Policy \> Access Device
Management \> Access Device from the navigation
tree. Then, click Add to configure an access device as follows:

**a.**Set the ports for authentication and
accounting to 1812 and 1813, respectively.

**b.**Select LAN Access
Service from the Service Type list.

**c.**Select H3C(General)
from the Access Device Type list.

**d.**Set the shared key to expert
for secure authentication and accounting communication.

**e.**Select an access device from the device list
or manually add an access device. In this example, the device IP address is
10.1.1.2.

**f.**Use the default values for other parameters
and click OK.

The IP address of the access device
specified here must be the same as the source IP address of the RADIUS packets
sent from the switch. The source IP address is chosen in the following order on
the switch:

¡     IP
address specified by using the nas-ip
command.

¡     IP
address specified by using the radius nas-ip command.

¡     IP
address of the outbound interface (the default).

Figure
25 Adding the switch as an access device

![](https://resource.h3c.com/en/202407/12/20240712_11705275_x_Img_x_png_25_2216062_294551_0.png)

 

**1\.**Add a charging plan:

Click the User tab, and select Accounting Manager \> Charging Plans from the navigation tree to enter the charging plan configuration
page. Then, click Add to configure a charging plan as follows:

**a.**Add a plan named UserAcct.


**b.**Select Flat rate
from the Charging Template list.

**c.**Select time for Charge Based on, select Monthly
for Billing Term, and enter 120
in the Fixed Fee field.

**d.**Enter 120 in the
Usage Threshold field and select hr (hours) for the in field.
The configuration allows the user to access the Internet for up to 120 hours
per month.

**e.**Click OK.

Figure
26 Adding a charging plan

![](https://resource.h3c.com/en/202407/12/20240712_11705276_x_Img_x_png_26_2216062_294551_0.png)

 

**1\.**Add an access policy:

Click the User tab, and select User Access Policy \> Access Policy from the navigation tree. Then, click Add to configure an access policy as
follows:

**a.**Enter access policy name Dot1x auth.

**b.**Set the ID of the VLAN to be deployed to 4. 

**c.**Configure other parameters as needed.

**d.**Click OK.

Figure
27 Adding an access policy

![](https://resource.h3c.com/en/202407/12/20240712_11705277_x_Img_x_png_27_2216062_294551_0.png)

 

**1\.**Add an access service:

Click the User tab, and select User Access Policy \> Access Service from the navigation tree. Then, click Add to configure a service as
follows:

**a.**Add a service named Dot1x
Service, and set the service suffix to bbb,
the authentication domain for the 802.1X user. With the service suffix
configured, you must configure the access device to send usernames that include
domain names to the RADIUS server.

**b.**Select UserAcct
from the Charging Plan list.

**c.**Select Dot1x auth
from the Default Access Policy list.

**d.**Configure other parameters as needed.

**e.**Click OK. 

Figure
28 Adding an access service

![](https://resource.h3c.com/en/202407/12/20240712_11705278_x_Img_x_png_28_2216062_294551_0.png)

 

**1\.**Add a user:

Click the User tab, and select All Access Users from the navigation tree to enter the All Access Users page. Then, click Add to configure
a user as follows:

**a.**Select the user or add a user named test.

**b.**Specify the account name as dot1x and configure the password. 

**c.**Select Dot1x Service
in the Access Service area.

**d.**Configure other parameters as needed and
click OK.

Figure
29 Adding an access user account

![](https://resource.h3c.com/en/202407/12/20240712_11705279_x_Img_x_png_29_2216062_294551_0.png)

 

#### Configuring the switch

**1\.**Configure a RADIUS scheme:

\# Create a RADIUS scheme named rad and enter
RADIUS scheme view.

\<Switch\> system-view

\[Switch] radius scheme rad

\# Specify the primary authentication
server and primary accounting server, and configure the keys for communication
with the servers.

\[Switch-radius-rad] primary
authentication 10.1.1.1

\[Switch-radius-rad] primary
accounting 10.1.1.1

\[Switch-radius-rad] key
authentication simple expert

\[Switch-radius-rad] key
accounting simple expert

\# Include domain names in the usernames
sent to the RADIUS server.

\[Switch-radius-rad]
user-name-format with-domain

\[Switch-radius-rad] quit

**2\.**Configure an ISP domain:

\# Create an ISP domain named bbb and enter
ISP domain view.

\[Switch] domain bbb

\# Configure the ISP domain to use RADIUS
scheme rad for authentication, authorization, and accounting of LAN users.

\[Switch-isp-bbb]
authentication lan-access radius-scheme rad

\[Switch-isp-bbb] authorization
lan-access radius-scheme rad

\[Switch-isp-bbb] accounting
lan-access radius-scheme rad

\[Switch-isp-bbb] quit

**3\.**Configure 802.1X authentication:

\# Enable 802.1X globally.

\[Switch] dot1x

\# Enable 802.1X for Ten-GigabitEthernet 1/0/1.

\[Switch] interface ten-gigabitethernet 1/0/1

\[Switch-Ten-GigabitEthernet1/0/1] dot1x

\# Configure the access control method. By
default, an 802.1X-enabled port uses the MAC-based access control.

\[Switch-Ten-GigabitEthernet1/0/1] dot1x port-method
macbased

#### Verifying the configuration

**1\.**On the host, use account dot1x@bbb to pass 802.1X authentication:

\# If the host runs the Windows XP 802.1X
client, configure the network connection properties as follows:

**a.**Click the Authentication
tab of the properties window.

**b.**Select the Enable IEEE
802.1X authentication for this network option.

**c.**Select MD5 challenge as the EAP type.

**d.**Click OK.

The user passes authentication after
entering the correct username and password on the authentication page.

\# If the host runs the iNode client, no
advanced authentication options are required. The user can pass authentication
after entering username dot1x@bbb and the correct password on the client property page.

 

| IMPORTANT | IMPORTANT:  Make sure the client can update its IP address to access the resources in the authorized VLAN after passing authentication. |
| --- | --- |

 

**2\.**On the switch, verify that the server
assigns the port connecting the client to VLAN 4 after the user passes
authentication. (Details not shown.)

**3\.**Display 802.1X connection information on the
switch.

\[Switch] display dot1x
connection

### Example: Configuring authentication and authorization for 802.1X users by the device as a RADIUS server

#### Network configuration

As shown in [Figure 30](#_Ref452024164), Switch B acts as the
RADIUS server for authentication and authorization of 802.1X users connected to
the NAS (Switch A).

Configure the switches to meet the
following requirements:

·     Perform 802.1X user authentication on Ten-GigabitEthernet 1/0/1 of the NAS.

·     The shared key is expert
and the authentication port is 1812\.

·     Exclude domain names from the usernames sent to
the RADIUS server.

·     The user name for 802.1X authentication is dot1x.

·     After the user passes authentication, the RADIUS
server authorizes VLAN 4 to the NAS port that the user is connecting to.

Figure 30 Network diagram

![](https://resource.h3c.com/en/202407/12/20240712_11705282_x_Img_x_png_31_2216062_294551_0.png)

‌

#### Procedure

**1\.**Configure the NAS:

**a.**Configure a RADIUS scheme:

\# Configure a RADIUS scheme named rad and enter
RADIUS scheme view.

\<SwitchA\> system-view

\[SwitchA] radius scheme rad

\# Specify the primary authentication
server with IP address 10.1.1.1 and set the shared key to expert in
plaintext form.

\[SwitchA-radius-rad] primary
authentication 10.1.1.1 key simple expert

\# Exclude domain names from the usernames
sent to the RADIUS server.

\[SwitchA-radius-rad]
user-name-format without-domain

\[SwitchA-radius-rad] quit

**b.**Configure an ISP domain:

\# Create an ISP domain named bbb and enter
ISP domain view.

\[SwitchA] domain bbb

\# Configure the ISP domain to use RADIUS
scheme rad for authentication and authorization of LAN users and not to
perform accounting for LAN users.

\[SwitchA-isp-bbb]
authentication lan-access radius-scheme rad

\[SwitchA-isp-bbb]
authorization lan-access radius-scheme rad

\[SwitchA-isp-bbb] accounting
lan-access none

\[SwitchA-isp-bbb] quit

**c.**Configure 802.1X authentication:

\# Enable 802.1X for Ten-GigabitEthernet 1/0/1.

\[SwitchA] interface ten-gigabitethernet 1/0/1

\[SwitchA-Ten-GigabitEthernet1/0/1] dot1x

\# Specify bbb as the mandatory authentication
domain for 802.1X users on the interface.

\[SwitchA-Ten-GigabitEthernet1/0/1] dot1x
mandatory-domain bbb

\[SwitchA-Ten-GigabitEthernet1/0/1] quit

\# Enable 802.1X globally.

\[SwitchA] dot1x

**2\.**Configure the RADIUS server:

\# Create a network access user named dot1x.

\<SwitchB\> system-view

\[SwitchB] local-user dot1x
class network

\# Configure the password as 123456 in
plaintext form.

\[SwitchB-luser-network-dot1x]
password simple 123456

\# Configure VLAN 4 as the authorization
VLAN.

\[SwitchB-luser-network-dot1x]
authorization-attribute vlan 4

\[SwitchB-luser-network-dot1x]
quit

\# Configure the IP address of the RADIUS
client as 10.1.1.2 and the shared key as expert in plaintext form.

\[SwitchB] radius-server client
ip 10.1.1.2 key simple expert

\# Activate the RADIUS server
configuration.

\[SwitchB] radius-server
activate

#### Verifying the configuration

**1\.**On the RADIUS server, display the activated
RADIUS clients and users.

\[SwitchB] display
radius-server active-client

Total 1 RADIUS clients.

Client IP: 10.1.1.2

\[SwitchB] display
radius-server active-user dot1x

Total 1 RADIUS users matched. 

Username: dot1x

  Description: Not configured

  Authorization attributes:

    VLAN ID: 4

    ACL number: Not configured

  Validity period:

    Expiration time: Not
configured

**2\.**On the host, use account dot1x for 802.1X authentication.

If the host runs the Windows built-in
802.1X client, configure the network connection properties as follows:

**a.**Click the Authentication
tab of the properties window.

**b.**Select the Enable IEEE
802.1X authentication for this network option.

**c.**Select MD5 challenge as the EAP type.

**d.**Click OK.

If the host runs the iNode client, no
advanced authentication options are required. The user passes authentication
after entering the correct user name and password on the authentication page or
the iNode client.

 

| IMPORTANT | IMPORTANT:  Make sure the client can update its IP address to access the resources in the authorized VLAN after passing authentication. |
| --- | --- |

 

**3\.**On the NAS, verify that the RADIUS server
assigns the port to VLAN 4 after the user passes authentication. (Details not
shown.)

**4\.**On the NAS, display online 802.1X user
information.

\[SwitchA] display dot1x
connection

## TroubleshootingAAA

### RADIUS authentication failure

#### Symptom

User authentication always fails.

#### Analysis

Possible reasons include:

·     A communication failure exists between the NAS
and the RADIUS server.

·     The username is not in the userid@isp-name format,
or the ISP domain is not correctly configured on the NAS.

·     The user is not configured on the RADIUS server.

·     The password entered by the user is incorrect.

·     The RADIUS server and the NAS are configured
with different shared keys.

#### Solution

To resolve the problem:

**1\.**Verify the following items:

¡     The
NAS and the RADIUS server can ping each other.

¡     The
username is in the userid@isp-name
format and the ISP domain is correctly configured on the NAS. 

¡     The
user is configured on the RADIUS server.

¡     The
correct password is entered.

¡     The
same shared key is configured on both the RADIUS server and the NAS.

**2\.**If the problem persists, contact H3C Support.

### RADIUS packet delivery failure

#### Symptom

RADIUS packets cannot reach the RADIUS
server.

#### Analysis

Possible reasons include:

·     A communication failure exists between
the NAS and the RADIUS server.

·     The NAS is not configured with the IP address of
the RADIUS server.

·     The authentication and accounting UDP ports
configured on the NAS are incorrect.

·     The RADIUS server's authentication and
accounting port numbers are being used by other applications.

#### Solution

To resolve the problem:

**1\.**Verify the following items:

¡     The
link between the NAS and the RADIUS server works well at both the physical and
data link layers.

¡     The
IP address of the RADIUS server is correctly configured on the NAS.

¡     The
authentication and accounting UDP port numbers configured on the NAS are the
same as those of the RADIUS server.

¡     The
RADIUS server's authentication and accounting port numbers are available.

**2\.**If the problem persists, contact H3C
Support.

### RADIUS accounting error

#### Symptom

A user is authenticated and authorized, but
accounting for the user is not normal.

#### Analysis

The accounting server configuration on the
NAS is not correct. Possible reasons include:

·     The accounting port number configured on the NAS
is incorrect.

·     The accounting server IP address configured on
the NAS is incorrect. For example, the NAS is configured to use a single server
to provide authentication, authorization, and accounting services, but in fact
the services are provided by different servers.

#### Solution

To resolve the problem:

**1\.**Verify the following items:

¡     The
accounting port number is correctly configured. 

¡     The
accounting server IP address is correctly configured on the NAS.

**2\.**If the problem persists, contact H3C
Support.

### Troubleshooting HWTACACS

Similar to RADIUS troubleshooting. See
"[RADIUS authentication failure](#_Ref482868862)," "[RADIUS packet delivery failure](#_Ref482868865)," and "[RADIUS accounting error](#_Ref482868870)."

### LDAP authentication failure

#### Symptom

User authentication fails.

#### Analysis

Possible reasons include:

·     A communication failure exists between the NAS
and the LDAP server.

·     The LDAP server IP address or port number
configured on the NAS is not correct.

·     The username is not in the userid@isp-name format,
or the ISP domain is not correctly configured on the NAS.

·     The user is not configured on the LDAP server.

·     The password entered by the user is incorrect. 

·     The administrator DN or password is not
configured. 

·     Some user attributes (for example, the username
attribute) configured on the NAS are not consistent with those configured on
the server. 

·     No user search base DN is specified for the LDAP
scheme.

#### Solution

To resolve the problem:

**1\.**Verify the following items:

¡     The
NAS and the LDAP server can ping each other. 

¡     The
IP address and port number of the LDAP server configured on the NAS match those
of the server.

¡     The
username is in the correct format and the ISP domain for the user
authentication is correctly configured on the NAS.

¡     The
user is configured on the LDAP server. 

¡     The
correct password is entered.

¡     The
administrator DN and the administrator password are correctly configured. 

¡     The
user attributes (for example, the username attribute) configured on the NAS are
consistent with those configured on the LDAP server.

¡     The
user search base DN for authentication is specified.

**2\.**If the problem persists, contact H3C
Support.

## Appendixes

### Appendix A  Commonly used RADIUS attributes

Commonly used RADIUS attributes are defined
in RFC 2865, RFC 2866, RFC 2867, and RFC 2868\. 

Table 4 Commonly used RADIUS attributes

| No. | Attribute | No. | Attribute |
| --- | --- | --- | --- |
| 1 | User-Name | 45 | Acct-Authentic || 2 | User-Password | 46 | Acct-Session-Time || 3 | CHAP-Password | 47 | Acct-Input-Packets || 4 | NAS-IP-Address | 48 | Acct-Output-Packets || 5 | NAS-Port | 49 | Acct-Terminate-Cause || 6 | Service-Type | 50 | Acct-Multi-Session-Id || 7 | Framed-Protocol | 51 | Acct-Link-Count || 8 | Framed-IP-Address | 52 | Acct-Input-Gigawords || 9 | Framed-IP-Netmask | 53 | Acct-Output-Gigawords || 10 | Framed-Routing | 54 | (unassigned) || 11 | Filter-ID | 55 | Event-Timestamp || 12 | Framed-MTU | 56-59 | (unassigned) || 13 | Framed-Compression | 60 | CHAP-Challenge || 14 | Login-IP-Host | 61 | NAS-Port-Type || 15 | Login-Service | 62 | Port-Limit || 16 | Login-TCP-Port | 63 | Login-LAT-Port || 17 | (unassigned) | 64 | Tunnel-Type || 18 | Reply-Message | 65 | Tunnel-Medium-Type || 19 | Callback-Number | 66 | Tunnel-Client-Endpoint || 20 | Callback-ID | 67 | Tunnel-Server-Endpoint || 21 | (unassigned) | 68 | Acct-Tunnel-Connection || 22 | Framed-Route | 69 | Tunnel-Password || 23 | Framed-IPX-Network | 70 | ARAP-Password || 24 | State | 71 | ARAP-Features || 25 | Class | 72 | ARAP-Zone-Access || 26 | Vendor-Specific | 73 | ARAP-Security || 27 | Session-Timeout | 74 | ARAP-Security-Data || 28 | Idle-Timeout | 75 | Password-Retry || 29 | Termination-Action | 76 | Prompt || 30 | Called-Station-Id | 77 | Connect-Info || 31 | Calling-Station-Id | 78 | Configuration-Token || 32 | NAS-Identifier | 79 | EAP-Message || 33 | Proxy-State | 80 | Message-Authenticator || 34 | Login-LAT-Service | 81 | Tunnel-Private-Group-ID || 35 | Login-LAT-Node | 82 | Tunnel-Assignment-id || 36 | Login-LAT-Group | 83 | Tunnel-Preference || 37 | Framed-AppleTalk-Link | 84 | ARAP-Challenge-Response || 38 | Framed-AppleTalk-Network | 85 | Acct-Interim-Interval || 39 | Framed-AppleTalk-Zone | 86 | Acct-Tunnel-Packets-Lost || 40 | Acct-Status-Type | 87 | NAS-Port-Id || 41 | Acct-Delay-Time | 88 | Framed-Pool || 42 | Acct-Input-Octets | 89 | (unassigned) || 43 | Acct-Output-Octets | 90 | Tunnel-Client-Auth-id || 44 | Acct-Session-Id | 91 | Tunnel-Server-Auth-id |












































 

### Appendix B  Descriptions for commonly used standard RADIUS attributes

| No. | Attribute | Description |
| --- | --- | --- |
| 1 | User-Name | Name of the user to be authenticated. || 2 | User-Password | User password for PAP authentication, only present in Access-Request packets when PAP authentication is used. || 3 | CHAP-Password | Digest of the user password for CHAP authentication, only present in Access-Request packets when CHAP authentication is used. || 4 | NAS-IP-Address | IP address for the server to use to identify the client. Typically, a client is identified by the IP address of its access interface. This attribute is only present in Access-Request packets. || 5 | NAS-Port | Physical port of the NAS that the user accesses. || 6 | Service-Type | Type of service that the user has requested or type of service to be provided. || 7 | Framed-Protocol | Encapsulation protocol for framed access. || 8 | Framed-IP-Address | IP address assigned to the user. || 11 | Filter-ID | Name of the filter list.  If the name starts with a digit, it indicates an ACL number.  If the name does not start with a digit, it indicates a user profile name. || 12 | Framed-MTU | MTU for the data link between the user and NAS. For example, this attribute can be used to define the maximum size of EAP packets allowed to be processed in 802.1X EAP authentication. || 14 | Login-IP-Host | IP address of the NAS interface that the user accesses. || 15 | Login-Service | Type of service that the user uses for login. || 18 | Reply-Message | Text to be displayed to the user, which can be used by the server to communicate information, for example, the cause of the authentication failure. || 26 | Vendor-Specific | Vendor-specific proprietary attribute. A packet can contain one or more proprietary attributes, each of which can contain one or more subattributes. || 27 | Session-Timeout | Maximum service duration for the user before termination of the session. || 28 | Idle-Timeout | Maximum idle time permitted for the user before termination of the session. || 31 | Calling-Station-Id | User identification that the NAS sends to the server. For the LAN access service provided by an H3C device, this attribute includes the MAC address of the user. || 32 | NAS-Identifier | Identification that the NAS uses to identify itself to the RADIUS server. || 40 | Acct-Status-Type | Type of the Accounting-Request packet. Possible values include:  ·     1—Start.  ·     2—Stop.  ·     3—Interim-Update.  ·     4—Reset-Charge.  ·     7—Accounting-On. (Defined in the 3rd Generation Partnership Project.)  ·     8—Accounting-Off. (Defined in the 3rd Generation Partnership Project.)  ·     9 to 14—Reserved for tunnel accounting.  ·     15—Reserved for failed. || 45 | Acct-Authentic | Authentication method used by the user. Possible values include:  ·     1—RADIUS.  ·     2—Local.  ·     3—Remote. || 60 | CHAP-Challenge | CHAP challenge generated by the NAS for MD5 calculation during CHAP authentication. || 61 | NAS-Port-Type | Type of the physical port of the NAS that is authenticating the user. Possible values include:  ·     15—Ethernet.  ·     16—Any type of ADSL.  ·     17—Cable. (With cable for cable TV.)  ·     19—WLAN-IEEE 802.11.  ·     201—VLAN.  ·     202—ATM.  If the port is an ATM or Ethernet one and VLANs are implemented on it, the value of this attribute is 201\. || 64 | Tunnel-Type | Tunneling protocols used.  The value 13 represents VLAN. If the value is 13, the device interprets the Tunnel-Type, Tunnel-Medium-Type, and Tunnel-Private-Group-ID attributes as attributes to assign VLANs. || 65 | Tunnel-Medium-Type | Transport medium type to use for creating a tunnel.  For VLAN assignment, the value must be 6 to indicate the 802 media plus Ethernet. || 79 | EAP-Message | Used to encapsulate EAP packets to allow RADIUS to support EAP authentication. || 80 | Message-Authenticator | Used for authentication and verification of authentication packets to prevent spoofing Access-Requests. This attribute is present when EAP authentication is used. || 81 | Tunnel-Private-Group-ID | Group ID for a tunnel session. To assign VLANs, the NAS conveys VLAN IDs by using this attribute. || 87 | NAS-Port-Id | String for describing the port of the NAS that is authenticating the user. || 168 | Framed-IPv6-Address | Server-assigned IPv6 address for the NAS to assign to the host. The address must be unique. |





























 

### Appendix C  RADIUS subattributes (vendor ID 25506\)

[Table 5](#_Ref454545541) lists all RADIUS subattributes with a vendor ID of 25506\. Support
for these subattributes depends on the device model.

Table 5 RADIUS subattributes (vendor ID
25506\)

| No. | Subattribute | Description |
| --- | --- | --- |
| 1 | Input-Peak-Rate | Peak rate in the direction from the user to the NAS, in bps. || 2 | Input-Average-Rate | Average rate in the direction from the user to the NAS, in bps. || 3 | Input-Basic-Rate | Basic rate in the direction from the user to the NAS, in bps. || 4 | Output-Peak-Rate | Peak rate in the direction from the NAS to the user, in bps. || 5 | Output-Average-Rate | Average rate in the direction from the NAS to the user, in bps. || 6 | Output-Basic-Rate | Basic rate in the direction from the NAS to the user, in bps. || 15 | Remanent\_Volume | Total amount of data available for the connection, in different units for different server types. || 17 | ISP-ID | ISP domain where the user obtains authorization information. || 20 | Command | Operation for the session, used for session control. Possible values include:  ·     1—Trigger-Request.  ·     2—Terminate-Request.  ·     3—SetPolicy.  ·     4—Result.  ·     5—PortalClear. || 25 | Result\_Code | Result of the Trigger-Request or SetPolicy operation, zero for success and any other value for failure. || 26 | Connect\_ID | Index of the user connection. || 27 | PortalURL | PADM redirect URL assigned to PPPoE users. || 28 | Ftp\_Directory | FTP, SFTP, or SCP user working directory.  When the RADIUS client acts as the FTP, SFTP, or SCP server, this attribute is used to set the working directory for an FTP, SFTP, or SCP user on the RADIUS client. || 29 | Exec\_Privilege | EXEC user priority. || 32 | NAT-IP-Address | Public IP address assigned to the user when the source IP address and port are translated. || 33 | NAT-Start-Port | Start port number of the port range assigned to the user when the source IP address and port are translated. || 34 | NAT-End-Port | End port number of the port range assigned to the user when the source IP address and port are translated. || 59 | NAS\_Startup\_Timestamp | Startup time of the NAS in seconds, which is represented by the time elapsed after 00:00:00 on Jan. 1, 1970 (UTC). || 60 | Ip\_Host\_Addr | User IP address and MAC address included in authentication and accounting requests, in the format A.B.C.D hh:hh:hh:hh:hh:hh. A space is required between the IP address and the MAC address. || 61 | User\_Notify | Information that must be sent from the server to the client transparently. || 62 | User\_HeartBeat | Hash value assigned after an 802.1X user passes authentication, which is a 32-byte string. This attribute is stored in the user list on the NAS and verifies the handshake packets from the 802.1X user. This attribute only exists in Access-Accept and Accounting-Request packets. || 98 | Multicast\_Receive\_Group | IP address of the multicast group that the user's host joins as a receiver. This subattribute can appear multiple times in a multicast packet to indicate that the user belongs to multiple multicast groups. || 100 | IP6\_Multicast\_Receive\_Group | IPv6 address of the multicast group that the user's host joins as a receiver. This subattribute can appear multiple times in a multicast packet to indicate that the user belongs to multiple multicast groups. || 101 | MLD-Access-Limit | Maximum number of MLD multicast groups that the user can join concurrently. || 102 | local-name | L2TP local tunnel name. || 103 | IGMP-Access-Limit | Maximum number of IGMP multicast groups that the user can join concurrently. || 104 | VPN-Instance | MPLS L3VPN instance to which a user belongs. || 105 | ANCP-Profile | ANCP profile name. || 135 | Client-Primary-DNS | IP address of the primary DNS server. || 136 | Client-Secondary-DNS | IP address of the secondary DNS server. || 140 | User\_Group | User groups assigned after the user passes authentication.  Typically, a user can belong to only one user group. || 144 | Acct\_IPv6\_Input\_Octets | Bytes of IPv6 packets in the inbound direction. The measurement unit depends on the configuration on the device. || 145 | Acct\_IPv6\_Output\_Octets | Bytes of IPv6 packets in the outbound direction. The measurement unit depends on the configuration on the device. || 146 | Acct\_IPv6\_Input\_Packets | Number of IPv6 packets in the inbound direction. The measurement unit depends on the configuration on the device. || 147 | Acct\_IPv6\_Output\_Packets | Number of IPv6 packets in the outbound direction. The measurement unit depends on the configuration on the device. || 148 | Acct\_IPv6\_Input\_Gigawords | Bytes of IPv6 packets in the inbound direction. The measurement unit is 4G bytes. || 149 | Acct\_IPv6\_Output\_Gigawords | Bytes of IPv6 packets in the outbound direction. The measurement unit is 4G bytes. || 155 | User-Roles | List of space-separated user roles. || 182 | Microsegment-Id | Microsegment ID. || 210 | Av-Pair | User-defined attribute pair. Available attribute pairs include:  ·     Server-assigned voice VLAN in the format of device-traffic-class\=voice.  ·     Server-assigned user role in the format of shell:role\=xxx.  ·     Server-assigned ACL in the format of url-redirect-acl\=xxx.  ·     Server-assigned IPv4 Web redirect URL in the format of url-redirect\=xxx.  ·     Server-assigned IPv6 Web redirect URL in the format of urlipv6-redirect\=xxx.  ·     Server-deployed command to reboot a port, in the format of subscriber:command\=bounce-host-port.  ·     Server-assigned port shutdown duration in the format of bounce:seconds\=xxx.  ·     Server-deployed command to shut down a port, in the format of subscriber:command\=disable-host-port.  ·     Server-assigned VSI in the format of vxlan:vsi-name\=xxx.  ·     VSI-based ACL resource assignment capability in the format of ACL:match-by-vsiindex\=x. Value 1 of x indicates that this feature is supported, and the other values of x are reserved.  ·     Server-assigned blackhole MAC address attribute in the format of mac:block-mac\=xxx.  ·     Server-assigned MAC authentication offline detect timer (in seconds) in the format of mac-authentication: offline-detect-time\=xxx. Value 0 of xxx indicates that MAC authentication offline detection is disabled.  ·     Server-assigned MAC authentication offline detection flag in the format of mac-authentication: offline-detect-check\=x. x has the following values:  ¡     0—The device does not search for the ARP snooping entry or ND snooping entry of the MAC address.  ¡     1—The device searches for the ARP snooping entry or ND snooping entry of the MAC address.  ·     Server-assigned dynamic ACL. For more information about the format of this attribute, see "[Appendix D  Format of dynamic authorization ACLs](#_Ref22846207)." Support for this attribute in 802.1X authentication and MAC authentication depends on the device model. If the server assigns a user both this attribute and the Filter-ID attribute, the device will ignore this attribute. The device does not support using CoA messages to change the content assigned by this attribute or assign another ACL to the user. || 216 | Ita-Policy | ITA policy name. || 230 | NAS-Port-Name | Interface through which the user is connected to the NAS. || 246 | Auth\_Detail\_Result | Accounting details. The server sends Access-Accept packets with subattributes 246 and 250 in the following situations:  ·     1—The subscriber charge is overdue. The subscriber is allowed to access network resources in the whitelist. If the subscriber accesses other network resources, the device redirects it to the URL specified by subattribute 250\.  ·     2—The broadband lease of the subscriber expires. The device redirects the subscriber to the URL specified by subattribute 250 when the subscriber requests to access webpages for the first time. || 247 | Input-Committed-Burst-Size | Committed burst size from the user to the NAS, in bits. The total length cannot exceed 4 bytes for this field.  This subattribute must be assigned together with the Input-Average-Rate attribute. || 248 | Output-Committed-Burst-Size | Committed burst size from the NAS to the user, in bits. The total length cannot exceed 4 bytes for this field.  This subattribute must be assigned together with the Output-Average-Rate attribute. || 249 | authentication-type | Authentication type. The value can be:  ·     1—Intranet access authentication.  ·     2—Internet access authentication.  If the packet does not contain this subattribute, common authentication applies. || 250 | WEB-URL | Redirect URL for users.  In single-stack scenarios, use this attribute to assign the authorized IPv4 URL or IPv6 URL.  In dual-stack scenarios, use this attribute to assign the authorized IPv4 URL and use user-defined attribute pair urlipv6-redirect to assign the authorized IPv6 URL. || 251 | Subscriber-ID | Family plan ID. || 252 | Subscriber-Profile | QoS policy name for the family plan of the subscriber. || 255 | Product\_ID | Product name. |


















































‌

### Appendix D  Format of dynamic authorization ACLs

#### Vendor ID 25506

The server might assign a dynamic
authorization ACL that contains multiple rules to a user in different ways:

·     Assign only one Av-Pair subattribute to the
user. In this subattribute, the dynamic ACL contains multiple rules separated
by question marks (?).

·     Assign multiple Av-Pair subattributes to the
user. All the subattributes contain the same dynamic ACL and a different rule.
Support for this method depends on the server model.

The format of a dynamic ACL rule is as
follows:

aclrule?same?acl-name?acl-type?ver-type?rule-id?protocol\=protocol-type?counting?dst-ip\=ip-addr?src-ip\=ip-addr?dst-port\=port-value?src-port\=port-value?action\=action-type

The fields in the rule are described in [Table 6](#_Ref20206059). The
following is an example of a dynamic ACL rule:

aclrule?same?test?1?1?1?protocol\=3?counting?dst-ip\=1.1.1.1/1.1.1.1?src-ip\=1.1.1.1/0?dst-port\=1.2000?src-port\=5.2000-3000?action\=1

Table 6 Fields in a dynamic ACL rule

| Field | Description | Remarks |
| --- | --- | --- |
| aclrule | Indicates that the following part is information about a dynamic ACL rule. | Required || same | Indicates that the current user will inherit the dynamic ACL rules that have been successfully assigned to another authenticated user.  If the server assigns one user the same dynamic ACL as another user but the rules are different for the two users, the device applies the dynamic ACL rules of the user that comes online first to the other user. | Required || acl-name | ACL name, a case-insensitive string of 1 to 63 characters. The ACL name must begin with a letter and it cannot be all or the same as an existing static ACL on the device. | Required || acl-type | ACL type. 1 indicates an advanced ACL. In the current software version, only advanced ACLs are supported. | Required || ver-type | IP protocol type:  ·     1—IPv4.  ·     2—IPv6. | Required || rule-id | ACL rule number, in the range of 0 to 65534\. | Required || protocol-type | Protocol type:  ·     1—IP.  ·     2—ICMP.  ·     3—TCP.  ·     4—UDP.  ·     5—ICMPv6.  ·     6—IPv6. | Optional || counting | Indicates that rule match statistics is enabled. If a rule does not include this field, rule match statistics is disabled for the rule. | Optional || ip-addr | IP address information. For example, 1.1.1.1/1.1.1.1, 1.1.1.1/0, or 3::3/128.  If the value is any, the rule matches any IP address. | Optional || port-value | TCP or UDP port information, in the X.YYY format.  ·     X—Operator.  ¡     1—Equal to.  ¡     2—Greater than.  ¡     3—Smaller than.  ¡     4—Not equal to.  ¡     5—In the range of.  ·     YYY—Port number information.  For example, 1.3000 and 5.2000-3000. | Optional || action-type | Action type:  ·     1—Deny.  ·     2—Permit. | Optional |











 

The following restrictions apply to dynamic
authorization ACLs:

·     For the former six fields (aclrule?same?acl-name?acl-type?ver-type?rule-id) of a
dynamic ACL rule, their positions are fixed. The device cannot interpret a
dynamic ACL rule if the positions of the six fields are changed. For the other
fields, position changes are allowed.

·     The settings for all the fields in the rules
must meet the configuration logic of ACL rules on the device so the device can
correctly interpret the rules.

·     All dynamic ACL rules in one authorization must
belong to the same ACL name.

·     A dynamic ACL must have rules and the format of
the rules must be valid.

#### Vendor ID 9

The server might assign a dynamic ACL to a
user by using the CISCO-AV-Pair subattribute (vendor ID 9). The formats of the
subattribute are as follows:

·     CiscoSecure-Defined-ACL\=#ACSACL#-IP-name\-number

The name argument
represents the ACL name and the number argument
represents the version number.

For example: CiscoSecure-Defined-ACL\=#ACSACL#-IP-UACL-0.

·     ip:inacl#number\=rule

The number
argument represents the ACL rule number and the rule
argument represents the rule content.

For example: ip:inacl#1\=permit udp any any eq 21862.

If the RADIUS server assigns dynamic ACLs
to a user by using both the CISCO-AV-Pair (vendor ID 9\) and Av-Pair (vendor ID
25506\) subattributes, the device ignores the CISCO-AV-Pair subattribute.

The server assigns a dynamic ACL to a user
as follows:

**1\.**The server assigns a dynamic ACL name to a
user by using the CISCO-AV-Pair subattribute in the format of CiscoSecure-Defined-ACL\=#ACSACL#-IP-name\-number after the user passes authentication.

**2\.**The device uses the dynamic ACL name as the
username of the user to initiate authentication again.

**3\.**The server assigns one or multiple ACL rules
to the user by using the CISCO-AV-Pair subattribute in the format of ip:inacl#number\=rule after the user passes
authentication.

**4\.**The device parses the ACL rules received
from the server, creates the ACL and its rules, and deploys the ACL and its
rules to the user.

In the current software version, the
device can parse only the dynamic ACL rules in the following formats:

{ deny \| permit } protocol \[ destination { dest-address dest-wildcard \| any } \| destination-port operator port1 \[ port2 ] \| source { source-address source-wildcard \| any } \| source-port operator port1 \[ port2 ] ]

The value for the operator argument can be lt (lower than), gt (greater than), eq (equal to), or neq (not equal to).

### Appendix E  HWTACACS attributes

HWTACACS authorization and accounting
packets include the HWTACACS attributes assigned by the server to a user and
the HWTACACS attributes uploaded by a user to the server. [Table 7](#_Ref77344050) shows
the HWTACACS attributes supported by the device. The device ignores an HWTACACS
attribute if it does not support that attribute.

Table 7 Supported HWTACACS attributes

| Attribute name | Description |
| --- | --- |
| acl | Number of the ACL assigned to the user. || idletime | Idle timeout period, in seconds. || priv-lvl | User privilege level in the range of level 0 to level 15\. || ftp-directory | Initial working directory of the FTP user. || addr | IP address assigned to the user. || addr-pool | IP address pool assigned to the user. || tunnel-type | Type of the tunnel to be established. Only L2TP is supported. || ip-addresses | LNS IP addresses. || tunnel-id | Group ID of the L2TP tunnel. || gw-password | Authentication password of the L2TP tunnel. || roles | User roles assigned to the user. || allowed-roles | Roles for which the user is allowed to obtain temporary authorization. |












‌

