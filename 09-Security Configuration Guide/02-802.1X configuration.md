
# 802.1Xoverview

## About the 802.1X protocol

802.1X is a port-based network access
control protocol widely used on Ethernet networks. The protocol controls network
access by authenticating the devices connected to 802.1X-enabled LAN ports.

### 802.1X architecture

802.1X operates in the client/server model.
As shown in [Figure 1](#_Ref393286455), 802.1X
authentication includes the following entities:

·     Client (supplicant)—A user terminal seeking access to the LAN. The terminal must have
802.1X software to authenticate to the access device.

·     Access device
(authenticator)—Authenticates the client to
control access to the LAN. In a typical 802.1X environment, the access device
uses an authentication server to perform authentication.

·     Authentication server—Provides authentication services for the access device. The
authentication server first authenticates 802.1X clients by using the data sent
from the access device. Then, the server returns the authentication results to the
access device to make access decisions. The authentication server is typically a
RADIUS server. In a small LAN, you can use the access device as the
authentication server.

Figure 1 802.1X architecture

![](https://resource.h3c.com/en/202407/12/20240712_11705291_x_Img_x_png_0_2216063_294551_0.png)

 

### Controlled/uncontrolled port and port authorization status

802.1X defines two logical ports for the
network access port: controlled port and uncontrolled port. Any packet arriving
at the network access port is visible to both logical ports.

·     Uncontrolled port—Is always open to receive and transmit authentication packets.

·     Controlled port—Filters packets depending on the port state.

¡     Authorized state—The controlled port
is in authorized state when the client has passed authentication. The port allows
traffic to pass through.

¡     Unauthorized state—The port is in
unauthorized state when the client has failed authentication. The port controls
traffic by using one of the following methods:

\-     Performs bidirectional traffic control to deny traffic to and from the
client.

\-     Performs unidirectional traffic control to deny traffic from the client.
The device supports only unidirectional traffic control.

Figure 2 Authorization state of a controlled
port

![](https://resource.h3c.com/en/202407/12/20240712_11705292_x_Img_x_png_1_2216063_294551_0.png)

 

### Packet exchange methods

802.1X uses the Extensible Authentication
Protocol (EAP) to transport authentication information for the client, the access
device, and the authentication server. EAP is an authentication framework that
uses the client/server model. The framework supports a variety of
authentication methods, including MD5-Challenge, EAP-Transport Layer Security
(EAP-TLS), and Protected EAP (PEAP).

802.1X defines EAP over LAN (EAPOL) for
passing EAP packets between the client and the access device over a wired or
wireless LAN. Between the access device and the authentication server, 802.1X
delivers authentication information by either EAP relay or EAP termination.

#### EAP relay

EAP relay is defined in IEEE 802.1X. In
this mode, the network device uses EAP over RADIUS (EAPOR) packets to send
authentication information to the RADIUS server, as shown in [Figure 3](#_Ref456951135).

Figure 3 EAP relay

![](https://resource.h3c.com/en/202407/12/20240712_11705303_x_Img_x_png_2_2216063_294551_0.png)

 

In EAP relay mode, the client must use the
same authentication method as the RADIUS server. On the access device, you only
need to use the dot1x authentication-method eap command to enable EAP relay.

#### EAP termination

As shown in [Figure 4](#_Ref456951166),
the access device performs the following operations in EAP termination mode:

**1\.**Terminates the EAP packets received from the
client.

**2\.**Encapsulates the client authentication
information in standard RADIUS packets.

**3\.**Uses PAP or CHAP to authenticate to the
RADIUS server.

Figure 4 EAP termination

![](https://resource.h3c.com/en/202407/12/20240712_11705314_x_Img_x_png_3_2216063_294551_0.png)

 

#### Comparing EAP relay and EAP termination

| Packet exchange method | Benefits | Limitations |
| --- | --- | --- |
| EAP relay | ·     Supports various EAP authentication methods.  ·     The configuration and processing are simple on the access device. | The RADIUS server must support the EAP-Message and Message-Authenticator attributes, and the EAP authentication method used by the client. || EAP termination | Works with any RADIUS server that supports PAP or CHAP authentication. | ·     Supports only the following EAP authentication methods:  ¡     MD5-Challenge EAP authentication.  ¡     The username and password EAP authentication initiated by an iNode 802.1X client.  ·     The processing is complex on the access device. |


 

### Packet formats

#### EAP packetformat

[Figure 5](#_Ref128297313)
shows the EAP packet format.

Figure 5 EAP
packet format

![](https://resource.h3c.com/en/202407/12/20240712_11705317_x_Img_x_png_4_2216063_294551_0.png)

 

·     Code—Type of the EAP packet. Options include Request (1), Response (2),
Success (3), or Failure (4).

·     Identifier—Used for matching Responses with Requests.

·     Length—Length (in bytes) of the EAP packet. The EAP packet length is the
sum of the Code, Identifier, Length, and Data fields.

·     Data—Content of the EAP packet. This field appears only in a Request or
Response EAP packet. The Data field contains the
request type (or the response type) and the type data. Type 1 (Identity) and
type 4 (MD5-Challenge) are two examples for the type field.

#### EAPOL packet format

[Figure 6](#_Ref128536267)
shows the EAPOL packet format.

Figure 6 EAPOL packet format

![](https://resource.h3c.com/en/202407/12/20240712_11705318_x_Img_x_png_5_2216063_294551_0.png)

 

·     PAE Ethernet type—Protocol type. It takes the value 0x888E for EAPOL.

·     Protocol version—The EAPOL protocol version used by the EAPOL packet sender.

·     Type—Type of the EAPOL packet. [Table 1](#_Ref165263231)
lists the types of EAPOL packets supported by the 802.1X implementation of the
device.

Table 1 Types of
EAPOLpackets

| Value | Type | Description |
| --- | --- | --- |
| 0x00 | EAP-Packet | The client and the access device uses EAP-Packets to transport authentication information. || 0x01 | EAPOL-Start | The client sends an EAPOL-Start message to initiate 802.1X authentication to the access device. || 0x02 | EAPOL-Logoff | The client sends an EAPOL-Logoff message to tell the access device that the client is logging off. |



 

·     Length—Data length in bytes, or length of the Packet body. If packet type
is EAPOL-Start or EAPOL-Logoff, this field is set to 0, and no Packet body
field follows.

·     Packet body—Content of the packet. When the EAPOL packet type is EAP-Packet,
the Packet body field contains an EAP packet.

#### EAP over RADIUS

RADIUS adds two attributes, EAP-Message and
Message-Authenticator, for supporting EAP authentication. For the RADIUS packet
format, see "Configuring AAA."

·     EAP-Message.

RADIUS encapsulates EAP packets in the EAP-Message
attribute, as shown in [Figure 7](#_Ref128304914).
The Type field takes 79, and the Value field can be up to 253 bytes. If an EAP
packet is longer than 253 bytes, RADIUS encapsulates it in multiple EAP-Message
attributes.

Figure 7 EAP-Message
attribute format

![](https://resource.h3c.com/en/202407/12/20240712_11705319_x_Img_x_png_6_2216063_294551_0.png)

 

·     Message-Authenticator.

As shown in [Figure 8](#_Ref381879472), RADIUS
includes the Message-Authenticator attribute in all packets that have an EAP-Message
attribute to check their integrity. The packet receiver drops the packet if the
calculated packet integrity checksum is different from the
Message-Authenticator attribute value. The Message-Authenticator prevents EAP
authentication packets from being tampered with during EAP authentication.

Figure 8 Message-Authenticator attribute format

![](https://resource.h3c.com/en/202407/12/20240712_11705320_x_Img_x_png_7_2216063_294551_0.png)

 

### 802.1X authentication procedures

802.1X authentication has two methods: EAP
relay and EAP termination. You choose either mode depending on support of the
RADIUS server for EAP packets and EAP authentication methods.

#### EAP relay

[Figure 9](#_Ref128539489) shows
the basic 802.1X authentication procedure in EAP relay mode, assuming that MD5-Challenge
EAP authentication is used.

Figure 9 802.1X authentication procedure in
EAP relay mode

![](https://resource.h3c.com/en/202407/12/20240712_11705321_x_Img_x_png_8_2216063_294551_0.png)

 

The following steps describe the 802.1X
authentication procedure:

**1\.**When a user launches the 802.1X client and
enters a registered username and password, the 802.1X client sends an
EAPOL-Start packet to the access device.

**2\.**The access device responds with an
EAP-Request/Identity packet to ask for the client username.

**3\.**In response to the EAP-Request/Identity packet,
the client sends the username in an EAP-Response/Identity packet to the access
device.

**4\.**The access device relays the EAP-Response/Identity
packet in a RADIUS Access-Request packet to the authentication server.

**5\.**The authentication server uses the identity
information in the RADIUS Access-Request to search its user database. If a
matching entry is found, the server uses a randomly generated challenge
(EAP-Request/MD5-Challenge) to encrypt the password in the entry. Then, the
server sends the challenge in a RADIUS Access-Challenge packet to the access
device.

**6\.**The access device transmits the EAP-Request/MD5-Challenge
packet to the client.

**7\.**The client uses the received challenge to
encrypt the password, and sends the encrypted password in an EAP-Response/MD5-Challenge
packet to the access device.

**8\.**The access device relays the EAP-Response/MD5-Challenge
packet in a RADIUS Access-Request packet to the authentication server.

**9\.**The authentication server compares the received
encrypted password with the encrypted password it generated at step 5\. If the
two passwords are identical, the server considers the client valid and sends a
RADIUS Access-Accept packet to the access device.

**10\.**Upon receiving the RADIUS Access-Accept
packet, the access device performs the following operations:

**a.**Sends an EAP-Success packet to the client.

**b.**Sets the controlled port in authorized state.

The client can access the network.

**11\.**After the client comes online, the access
device periodically sends handshake requests to check whether the client is
still online. By default, if two consecutive handshake attempts fail, the
device logs off the client.

**12\.**Upon receiving a handshake request, the client returns a response.
If the client fails to return a response after a number of consecutive
handshake attempts (two by default), the access device logs off the client.
This handshake mechanism enables timely release of the network resources used
by 802.1X users that have abnormally gone offline.

**13\.**The client can also send an EAPOL-Logoff
packet to ask the access device for a logoff.

**14\.**In response to the EAPOL-Logoff packet, the access
device changes the status of the controlled port from authorized to
unauthorized. Then, the access device sends an EAP-Failure packet to the client.

#### EAP termination

[Figure 10](#_Ref128539623) shows
the basic 802.1X authentication procedure in EAP termination mode, assuming
that CHAP authentication is used.

Figure 10 802.1X
authentication procedure in EAP termination mode

![](https://resource.h3c.com/en/202407/12/20240712_11705322_x_Img_x_png_9_2216063_294551_0.png)

 

In EAP termination mode, the access device
rather than the authentication server generates an MD5 challenge for password
encryption. The access device then sends the MD5 challenge together with the
username and encrypted password in a standard RADIUS packet to the RADIUS
server.

### 802.1X authentication initiation

Both the 802.1X client and the access
device can initiate 802.1X authentication.

#### 802.1X client as the initiator

The client sends an EAPOL-Start packet to
the access device to initiate 802.1X authentication. The destination MAC address
of the packet is the IEEE 802.1X specified multicast address 01-80-C2-00-00-03
or the broadcast MAC address. If any intermediate device between the client and
the authentication server does not support the multicast address, you must use
an 802.1X client that can send broadcast EAPOL-Start packets. For example, you
can use the iNode 802.1X client.

#### Access device as the initiator

If the client cannot send EAPOL-Start
packets, configure the access device to initiate authentication.

The access device supports the following modes:

·     Multicast trigger mode—The access device multicasts EAP-Request/Identity packets to
initiate 802.1X authentication at the identity request interval.

·     Unicast trigger mode—Upon receiving a frame from an unknown MAC address, the access
device sends an EAP-Request/Identity packet out of the receiving port to the
MAC address. The device retransmits the packet if no response has been received
within the identity request timeout interval. This process continues until the
maximum number of request attempts set by using the dot1x retry command is reached.

The username request timeout timer sets
both the identity request interval for the multicast trigger and the identity
request timeout interval for the unicast trigger.

## Access control methods

The device implements port-based access control as defined in the
802.1X protocol, and extends the protocol to support MAC-based access control.

·     Port-based access control—Once an 802.1X user passes authentication on a port, any subsequent
user can access the network through the port without authentication. When the
authenticated user logs off, all other users are logged off.

·     MAC-based access control—Each user is separately authenticated on a port. When a user logs
off, no other online users are affected.

## 802.1X VLAN manipulation

### Authorization VLAN

The authorization VLAN controls the access
of an 802.1X user to authorized network resources. The device supports
authorization VLANs assigned locally or by a remote server.

 

| IMPORTANT | IMPORTANT:  Only remote servers can assign tagged authorization VLANs. |
| --- | --- |

‌

#### Remote VLAN authorization

In remote VLAN authorization, you must
configure an authorization VLAN for a user on the remote server. After the user
authenticates to the server, the server assigns authorization VLAN information
to the device. Then, the device assigns the user access port to the
authorization VLAN as a tagged or untagged member.

The device supports assignment of the
following authorization VLAN information by the remote server:

·     VLAN ID.

·     VLAN name, which must be the same as the VLAN
description on the access device.

·     A string of VLAN IDs and VLAN names.

In the string, some VLANs are represented
by their IDs, and some VLANs are represented by their names.

·     VLAN group name.

For more information about VLAN groups,
see Layer 2—LAN Switching Configuration Guide.

·     VLAN ID with a suffix of t
or u.

The t and u suffixes require the device to
assign the access port to the VLAN as a tagged or untagged member,
respectively. For example, 2u indicates assigning the port to VLAN 2 as an untagged member.

If a VLAN name or VLAN group name is
assigned, the device converts the information into a VLAN ID before VLAN
assignment.

 

| IMPORTANT | IMPORTANT:  For a VLAN represented by its VLAN name to be assigned successfully, you must make sure the VLAN has been created on the device.  To assign VLAN IDs with suffixes, make sure the user access port is a hybrid or trunk port that performs port-based access control. |
| --- | --- |

‌

To ensure a successful assignment, the
authorization VLANs assigned by the remote server cannot be any of the
following types:

·     Dynamically learned VLANs.

·     Reserved VLANs.

·     Super VLANs.

·     Private VLANs.

If the server assigns a group of VLANs, the
access device selects a VLAN as described in [Table 2](#_Ref480207385).

Table 2 Authorization VLAN selection from a
group of VLANs

| VLAN information | Authorization VLAN selection |
| --- | --- |
| VLANs by IDs  VLANs by names  VLAN group name | If the 802.1X-enabled port performs MAC-based access control, the device selects an authorization VLAN from the VLAN group for a user according to the following rules:  ·     On a hybrid port with MAC-based VLAN enabled:  ¡     If the port does not have online users, the device selects the VLAN with the lowest ID.  ¡     If the port has online users, the device selects the VLAN that has the fewest online users. If two VLANs have the same number of online 802.1X users, the device selects the VLAN with the lower ID.  ·     On an access, trunk, or MAC-based VLAN disabled hybrid port:  ¡     If the port does not have online users, the device selects the VLAN with the lowest ID.  ¡     If the port has online users, the device examines the VLAN group for the VLAN of the online users. If the VLAN is found, the VLAN is assigned to the user as the authorization VLAN. If the VLAN is not found, VLAN authorization fails.  If the 802.1X-enabled port performs port-based access control, the device selects the VLAN with the lowest ID from the VLAN group. All subsequent 802.1X users are assigned to that VLAN. || VLAN IDs with suffixes | **1\.**The device selects the leftmost VLAN ID without a suffix, or the leftmost VLAN ID suffixed by u as an untagged VLAN, whichever is more leftmost.  **2\.**The device assigns the untagged VLAN to the port as the PVID, and it assigns the remaining as tagged VLANs. If no untagged VLAN is assigned, the PVID of the port does not change. The port permits traffic from these tagged and untagged VLANs to pass through.  For example, the authentication server sends the string 1u 2t 3 to the access device for a user. The device assigns VLAN 1 as an untagged VLAN and all remaining VLANs (including VLAN 3\) as tagged VLANs. VLAN 1 becomes the PVID. |


‌

#### Local VLAN authorization

To perform local VLAN authorization for a user, specify the VLAN ID
in the authorization attribute list of the local user account for that user.
For each local user, you can specify only one authorization VLAN ID.The user access port is assigned to the VLAN as an untagged member.

 

| IMPORTANT | IMPORTANT:  Local VLAN authorization does not support assignment of tagged VLANs. |
| --- | --- |

‌

For more information about local user
configuration, see "Configuring AAA."

#### Authorization VLAN manipulation on an 802.1X-enabled port

[Table 3](#_Ref371765814)
describes how the access device handles VLANs (except for the VLANs specified
with suffixes) on an 802.1X-enabled port.

Table 3 VLAN manipulation

| Port access control method | | VLAN manipulation |
| --- | --- | --- |
| Port-based | | The device assigns the port to the first authenticated user's authorization VLAN. All subsequent 802.1X users can access the VLAN without authentication.  If the authorization VLAN has the untagged attribute, the device assigns the port to the authorization VLAN as an untagged member and sets the VLAN as the PVID.  If the authorization VLAN has the tagged attribute, the device assigns the port to the VLAN as a tagged member without changing the PVID.  NOTE:  The tagged attribute is supported only on trunk and hybrid ports. || MAC-based | Access port | IMPORTANT IMPORTANT:  Make sure the authorization VLAN assigned by the server has the untagged attribute. VLAN assignment will fail if the server issues a VLAN that has the tagged attribute.  The device assigns the port to the authorization VLAN assigned to the first user that passes authentication. || Trunk port | If the authorization VLANs have the tagged attribute, the device maps the MAC address of each user to its own authorization VLAN without changing the PVID of the port.  If the authorization VLANs have the untagged attribute, the device sets the first authenticated user's authorization VLAN as the PVID of the port. || Hybrid port | If the authorization VLAN has the tagged attribute, the device assigns the port to the VLAN as a tagged member without changing the PVID. You can authorize a tagged VLAN to only one user.  If the authorization VLAN has the untagged attribute, the device performs the following operations:  ·     Assigns the port to the authorization VLAN as an untagged member.  ·     If MAC-based VLAN is enabled, dynamically creates MAC address and VLAN mappings without changing the PVID of the port.  ·     If MAC-based VLAN is disabled, the device sets the first authenticated user's authorization VLAN as the PVID of the port. |




 

| IMPORTANT | IMPORTANT:  ·     When you assign VLANs to users attached to an access port, trunk port, or MAC-based VLAN disabled hybrid port, make sure there is only one untagged VLAN. If a different untagged VLAN is assigned to a subsequent user, the user cannot pass authentication.  ·     As a best practice to enhance network security, do not use the port hybrid vlan command to assign a hybrid port to an authorization VLAN as a tagged member. |
| --- | --- |

 

The VLAN assigned by the server to a user
as an authorization VLAN might have been configured on the user access port but
with a different tagging mode. For example, the server assigns an authorization
VLAN with the tagged attribute, but the same VLAN configured on the port has the
untagged attribute. In this situation, the VLAN settings that take effect on
the user depend on the link type of the port.

·     If the link type of the port is access or trunk,
the authorization VLAN settings assigned by the server always take effect on
the user as long as the user is online. After the user goes offline, the VLAN
settings on the port take effect.

·     If the link type of the port is hybrid, the VLAN
settings configured on the port take effect. For example, the server assigns
VLAN 30 with the untagged attribute to a user on the hybrid port. However, VLAN
30 has been configured on the port with the tagged attribute by using the port hybrid
vlan tagged command. Then, the VLAN has the
tagged attribute on the port.

For an 802.1X authenticated user to access
the network on a hybrid port when no authorization VLAN is configured for the
user, perform one of the following tasks:

·     If the port receives tagged authentication
packets from the user in a VLAN, use the port hybrid vlan command to configure the port as a tagged member in the VLAN.

·     If the port receives untagged authentication
packets from the user in a VLAN, use the port hybrid vlan command to configure the port as an untagged member in the VLAN.

On a port with periodic online user
reauthentication enabled, the MAC-based VLAN feature does not take effect on a
user that has been online since before this feature was enabled. The access
device creates a MAC-to-VLAN mapping for the user when the following
requirements are met:

·     The user passes reauthentication.

·     The authorization VLAN for the user is changed.

For more information about VLAN
configuration and MAC-based VLANs, see Layer 2—LAN
Switching Configuration Guide.

### Guest VLAN

The 802.1X guest VLAN on a port accommodates
users that have not performed 802.1X authentication. Users in the guest VLAN can
access a limited set of network resources, such as a software server, to
download antivirus software and system patches. Once a user in the guest VLAN
passes 802.1X authentication, it is removed from the guest VLAN and can access
authorized network resources.

The access device handles VLANs on an
802.1X-enabled port based on its 802.1X access control method. 

#### Port-based access control

| Authentication status | VLAN manipulation |
| --- | --- |
| A user accesses the 802.1X-enabled port when the port is in auto state. | The device assigns the port to the 802.1X guest VLAN. All 802.1X users on this port can access only resources in the guest VLAN.  The guest VLAN assignment varies by port link mode. For more information, see [Table 3](#_Ref371765814) in "[Authorization VLAN](#_Ref519072916)." || A user in the 802.1X guest VLAN fails 802.1X authentication. | If an 802.1X Auth-Fail VLAN is available, the device assigns the port to the Auth-Fail VLAN. All users on this port can access only resources in the Auth-Fail VLAN.  If no Auth-Fail VLAN is configured, the port is still in the 802.1X guest VLAN. All users on the port are in the guest VLAN.  For information about the 802.1X Auth-Fail VLAN, see "[Auth-Fail VLAN](#_Ref326594098)." || A user in the 802.1X guest VLAN passes 802.1X authentication. | The device removes the port from the 802.1X guest VLAN and assigns the port to the authorization VLAN of the user.  If the authentication server does not assign an authorization VLAN, the initial PVID of the port applies. The user and all subsequent 802.1X users are assigned to the initial port VLAN.  After the user logs off, the port is assigned to the guest VLAN again.  NOTE:  The initial PVID of an 802.1X-enabled port refers to the PVID used by the port before the port is assigned to any 802.1X VLANs. |



 

| IMPORTANT | IMPORTANT:  When the port receives a packet with a VLAN tag, the packet will be forwarded within the tagged VLAN if the VLAN is not the guest VLAN. |
| --- | --- |

‌

#### MAC-based access control

| Authentication status | VLAN manipulation |
| --- | --- |
| A user accesses the 802.1X-enabled port and has not performed 802.1X authentication. | The device creates a mapping between the MAC address of the user and the 802.1X guest VLAN. The user can access only resources in the guest VLAN. || A user in the 802.1X guest VLAN fails 802.1X authentication. | If an 802.1X Auth-Fail VLAN is available, the device remaps the MAC address of the user to the Auth-Fail VLAN. The user can access only resources in the Auth-Fail VLAN.  If no 802.1X Auth-Fail VLAN is configured, the user is removed from the guest VLAN and added to the initial PVID. || A user in the 802.1X guest VLAN passes 802.1X authentication. | The device remaps the MAC address of the user to the authorization VLAN.  If the authentication server does not assign an authorization VLAN, the device remaps the MAC address of the user to the initial PVID on the port. |



‌

### Auth-Fail VLAN

The 802.1X Auth-Fail VLAN on a port accommodates
users that have failed 802.1X authentication because of the failure to comply
with the organization's security policy. For example, the VLAN accommodates
users that have entered a wrong password. Users in the Auth-Fail VLAN can
access a limited set of network resources, such as a software server, to
download antivirus software and system patches.

The access device handles VLANs on an
802.1X-enabled port based on its 802.1X access control method. 

#### Port-based access control

| Authentication status | VLAN manipulation |
| --- | --- |
| A user accesses the port and fails 802.1X authentication. | The device assigns the port to the Auth-Fail VLAN. All 802.1X users on this port can access only resources in the Auth-Fail VLAN.  The Auth-Fail VLAN assignment varies by port link mode. For more information, see [Table 3](#_Ref371765814) in "[Authorization VLAN](#_Ref519072916)." || A user in the 802.1X Auth-Fail VLAN fails 802.1X authentication. | The port is still in the Auth-Fail VLAN, and all 802.1X users on this port are in this VLAN. || A user in the 802.1X Auth-Fail VLAN passes 802.1X authentication. | The device assigns the port to the authorization VLAN of the user, and it removes the port from the Auth-Fail VLAN.  If the authentication server does not assign an authorization VLAN, the initial PVID of the port applies. The user and all subsequent 802.1X users are assigned to the initial PVID.  After the user logs off, the port is assigned to the guest VLAN. If no guest VLAN is configured, the port is assigned to the initial PVID of the port. |



‌

#### MAC-based access control

| Authentication status | VLAN manipulation |
| --- | --- |
| A user accesses the port and fails 802.1X authentication. | The device maps the MAC address of the user to the 802.1X Auth-Fail VLAN. The user can access only resources in the Auth-Fail VLAN. || A user in the 802.1X Auth-Fail VLAN fails 802.1X authentication. | The user is still in the Auth-Fail VLAN. || A user in the 802.1X Auth-Fail VLAN passes 802.1X authentication. | The device remaps the MAC address of the user to the authorization VLAN.  If the authentication server does not assign an authorization VLAN, the device remaps the MAC address of the user to the initial PVID on the port. |



‌

### Critical VLAN

The 802.1X critical VLAN on a port accommodates
802.1X users that have failed authentication because none of the RADIUS servers
in their ISP domain are reachable. Users in the critical VLAN can access a
limited set of network resources depending on the configuration.

The critical VLAN feature takes effect when
802.1X authentication is performed only through RADIUS servers. If an 802.1X
user fails local authentication after RADIUS authentication, the user is not
assigned to the critical VLAN. For more information about the authentication
methods, see "Configuring AAA."

The access device handles VLANs on an
802.1X-enabled port based on its 802.1X access control method. 

#### Port-based access control

| Authentication status | VLAN manipulation |
| --- | --- |
| A user accesses the port and fails 802.1X authentication because all the RADIUS servers are unreachable. | The device assigns the port to the critical VLAN. The 802.1X user and all subsequent 802.1X users on this port can access only resources in the 802.1X critical VLAN.  The critical VLAN assignment varies by port link mode. For more information, see [Table 3](#_Ref371765814) in "[Authorization VLAN](#_Ref519072916)." || A user in the 802.1X critical VLAN fails authentication because all the RADIUS servers are unreachable. | The port is still in the critical VLAN. || A user in the 802.1X critical VLAN fails authentication for any reason other than unreachable servers. | If an 802.1X Auth-Fail VLAN has been configured, the port is assigned to the Auth-Fail VLAN. If no 802.1X Auth-Fail VLAN is configured, the port is assigned to the initial PVID of the port. || A user in the 802.1X critical VLAN passes 802.1X authentication. | The device assigns the port to the authorization VLAN of the user, and it removes the port from the 802.1X critical VLAN.  If the authentication server does not assign an authorization VLAN, the initial PVID of the port applies. The user and all subsequent 802.1X users are assigned to this port VLAN.  After the user logs off, the port is assigned to the guest VLAN. If no 802.1X guest VLAN is configured, the initial PVID of the port is restored. || A user in the 802.1X guest VLAN fails authentication because all the RADIUS servers are unreachable. | The device assigns the port to the 802.1X critical VLAN, and all 802.1X users on this port are in this VLAN. || On a port that performs port-based or MAC-based access control, a user in the 802.1X Auth-Fail VLAN fails authentication because all the RADIUS servers are unreachable. | The port is still in the 802.1X Auth-Fail VLAN. All 802.1X users on this port can access only resources in the 802.1X Auth-Fail VLAN. || A user that has passed authentication fails reauthentication because all the RADIUS servers are unreachable, and the user is logged out of the device. | The device assigns the port to the 802.1X critical VLAN. |







‌

If the port is added to the critical VLAN
because no RADIUS servers are reachable, the device performs the following
operations after it detects a reachable RADIUS server:

**1\.**Removes the port from the critical VLAN.

**2\.**Sends a multicast EAP-Request/Identity
message out of the port to trigger authentication.

#### MAC-based access control

| Authentication status | VLAN manipulation |
| --- | --- |
| A user accesses the port and fails 802.1X authentication because all the RADIUS servers are unreachable. | The device maps the MAC address of the user to the 802.1X critical VLAN. The user can access only resources in the 802.1X critical VLAN. || A user in the 802.1X critical VLAN fails authentication because all the RADIUS servers are unreachable. | The user is still in the critical VLAN. || A user in the 802.1X critical VLAN fails 802.1X authentication for any reason other than unreachable servers. | If an 802.1X Auth-Fail VLAN has been configured, the device remaps the MAC address of the user to the Auth-Fail VLAN ID.  If no 802.1X Auth-Fail VLAN has been configured, the device remaps the MAC address of the user to the initial PVID. || A user in the 802.1X critical VLAN passes 802.1X authentication. | The device remaps the MAC address of the user to the authorization VLAN.  If the authentication server does not assign an authorization VLAN to the user, the device remaps the MAC address of the user to the initial PVID on the port. || A user in the 802.1X guest VLAN fails authentication because all the RADIUS servers are unreachable. | The device remaps the MAC address of the user to the 802.1X critical VLAN. The user can access only resources in the 802.1X critical VLAN. || A user in the 802.1X Auth-Fail VLAN fails authentication because all the RADIUS servers are unreachable. | The user remains in the 802.1X Auth-Fail VLAN. |






‌

If a user is added to the critical VLAN
because no RADIUS servers are reachable, the device performs the following
operations after it detects a reachable RADIUS server:

**1\.**Removes the user from the critical VLAN.

**2\.**Sends a unicast EAP-Request/Identity message
out of the port to the user for reauthentication.

### Critical voice VLAN

The 802.1X critical voice VLAN on a port
accommodates 802.1X voice users that have failed authentication because none of
the RADIUS servers in their ISP domain are reachable.

The critical voice VLAN feature takes
effect when 802.1X authentication is performed only through RADIUS servers. If
an 802.1X voice user fails local authentication after RADIUS authentication,
the voice user is not assigned to the critical voice VLAN. For more information
about the authentication methods, see "Configuring AAA."

When a reachable RADIUS server is detected,
the device performs operations on a port based on its 802.1X access control method.

#### Port-based access control

When a reachable RADIUS server is detected,
the device removes the port from the critical voice VLAN. The port sends a
multicast EAP-Request/Identity packet to all 802.1X voice users on the port to
trigger authentication.

#### MAC-based access control

When a reachable RADIUS server is detected,
the device removes 802.1X voice users from the critical voice VLAN. The port
sends a unicast EAP-Request/Identity packet to each 802.1X voice user that was
assigned to the critical voice VLAN to trigger authentication.

## 802.1X VSI manipulation

### 802.1X support for VXLANs

As shown in [Figure 11](#_Ref462235230), when the
device acts as both a VXLAN VTEP and a NAS, users' service information cannot
be identified by VLANs. To resolve this issue, you must configure the RADIUS
server to assign VSIs to authenticated 802.1X users. The NAS will map a user's
traffic to the VXLAN that is associated with the user's authorization VSI. The
mapping criteria include the user's access VLAN, access port, and MAC address.
MAC address information is required only when the access port performs
MAC-based access control.

For information about VSIs and VXLANs, see VXLAN Configuration Guide.

Figure 11 VXLAN
network diagramfor 802.1X authentication

![](https://resource.h3c.com/en/202407/12/20240712_11705299_x_Img_x_png_16_2216063_294551_0.png)

 

### Authorization VSI

An authorization VSI is associated with a
VXLAN that has network resources inaccessible to unauthenticated users.

802.1X supports remote VSI authorization.
When a user passes remote 802.1X authentication, the remote server assigns the
authorization VSI information of the user to the user's access port. Upon
receiving the authorization VSI information, the VTEP performs the following
operations:

·     Dynamically creates an Ethernet service instance
based on the user's access port, VLAN, and MAC address.

·     Maps the Ethernet service instance to the
authorization VSI.

The user then can access resources in the
VXLAN associated with the authorization VSI. 

If the VTEP does not receive authorization
VSI information for the user from the remote server, the user cannot access
resources in any VXLAN after passing authentication.

For information about dynamic creation of Ethernet
service instances, see VXLAN configuration Guide.

### Guest VSI

The 802.1X guest VSI on a port accommodates
users that have not performed 802.1X authentication. You can deploy a limited set
of network resources in the VXLAN that is associated with the guest VSI. For
example, deploy a software server for users to download anti-virus software and
system patches. Once a user in the guest VSI passes 802.1X authentication, the
user is removed from the guest VSI and can access authorized network resources.

| Authentication status | VSI manipulation |
| --- | --- |
| A user accesses the port and has not performed 802.1X authentication. | The VTEP maps the user's MAC address and access VLAN to the 802.1X guest VSI on the port. The user can access only resources in the VXLAN associated with the guest VSI. || A user in the 802.1X guest VSI fails 802.1X authentication. | If an 802.1X Auth-Fail VSI is available on the port, the VTEP remaps the user's MAC address and access VLAN to the Auth-Fail VSI. The user can access only resources in the VXLAN associated with the Auth-Fail VSI.  If no 802.1X Auth-Fail VSI is configured on the port, the user is removed from the 802.1X guest VSI. || A user in the 802.1X guest VSI passes 802.1X authentication. | The VTEP removes the user from the 802.1X guest VSI and remaps the user's MAC address and access VLAN to the authorization VSI. |



‌

### Auth-Fail VSI

The 802.1X Auth-Fail VSI on a port accommodates
users that have failed 802.1X authentication because of the failure to comply
with the organization's security policy. For example, the VSI accommodates
users with wrong passwords entered. Users in the Auth-Fail VSI can access a
limited set of network resources in the VXLAN associated with this VSI. You can
deploy a software server in the Auth-Fail VSI for users to download antivirus
software and system patches.

| Authentication status | VSI manipulation |
| --- | --- |
| A user accesses the port and fails 802.1X authentication. | The VTEP maps the user's MAC address and access VLAN to the 802.1X Auth-Fail VSI on the port. The user can access only resources in the VXLAN associated with the Auth-Fail VSI. || A user in the 802.1X Auth-Fail VSI fails 802.1X authentication because of any reason other than unreachable servers. | The user is still in the Auth-Fail VSI. || A user in the 802.1X Auth-Fail VSI passes 802.1X authentication. | The VTEP removes the user from the 802.1X Auth-Fail VSI and remaps the user's MAC address and access VLAN to the authorization VSI. |



‌

### Critical VSI

The 802.1X critical VSI on a port
accommodates 802.1X users that have failed authentication because none of the
RADIUS servers in their ISP domain are reachable. Users in the critical VSI can
access a limited set of network resources in the VXLAN associated with this VSI.

The critical VSI feature takes effect when
802.1X authentication is performed only through RADIUS servers. If an 802.1X
user fails local authentication after RADIUS authentication, the user is not
assigned to the critical VSI. For more information about the authentication
methods, see "Configuring AAA."

| Authentication status | VSI manipulation |
| --- | --- |
| A user accesses the port and fails 802.1X authentication because all the RADIUS servers are unreachable. | The VTEP maps the user's MAC address and access VLAN to the 802.1X critical VSI on the port. The user can access only resources in the VXLAN associated with the critical VSI. || A user in the 802.1X critical VSI fails authentication because all the RADIUS servers are unreachable. | The user is still in the critical VSI. || A user in the 802.1X critical VSI fails 802.1X authentication for any reason other than unreachable servers. | If an 802.1X Auth-Fail VSI has been configured on the port, the VTEP remaps the user's MAC address and access VLAN to the Auth-Fail VSI.  If no 802.1X Auth-Fail VSI has been configured on the port, the VTEP logs off the user. || A user in the 802.1X critical VSI passes 802.1X authentication. | The VTEP remaps the user's MAC address and access VLAN to the authorization VSI. || A user in the 802.1X guest VSI fails authentication because all the RADIUS servers are unreachable. | The VTEP maps the user's MAC address and access VLAN to the 802.1X critical VSI on the port. The user can access only resources in the VXLAN associated with the critical VSI. || A user in the 802.1X Auth-Fail VSI fails authentication because all the RADIUS servers are unreachable. | The user remains in the 802.1X Auth-Fail VSI. |






‌

## 802.1X microsegment assignment

‌

| IMPORTANT | IMPORTANT:  Only the S5560X-HI switch series and S6520X-HI switch series support this feature. |
| --- | --- |

‌

### Authorization microsegment

A microsegment is a group of traffic that
matches the same criteria. The microsegmentation feature provides group-based
traffic control by applying policy to traffic on a per-microsegment basis. The
RADIUS server can assign a microsegment to a user after that user passes 802.1X
authentication. Then, the device performs microsegment-based traffic filtering
for that user on the user's access port to make sure the user can access only the
network resources available for the microsegment. 

For more information about microsegmentation,
see "Configuring microsegmentation."

 

| IMPORTANT | IMPORTANT:  The following restrictions apply to 802.1X authentication on a microsegmented network:  ·     The server must assign an authorization ACL, redirect URL, and microsegment to an 802.1X user if that user must pass Web authentication.  ·     If the server assigns both an authorization ACL and an authorization microsegment to an 802.1X user that does not require Web authentication, only the authorization microsegment takes effect. |
| --- | --- |

 

### Critical microsegment

The 802.1X critical microsegment on a port
accommodates users that have failed 802.1X authentication because no RADIUS authentication
servers are reachable. Users in an 802.1X critical microsegment can access only
network resources in the critical microsegment. The microsegment can belong to
a VLAN or VXLAN.

The critical microsegment feature takes
effect when 802.1X authentication is performed only through RADIUS servers. If
an 802.1X user fails local authentication after RADIUS authentication, the user
is not assigned to the critical microsegment. For more information about the
authentication methods, see "Configuring AAA."

The access device handles users on an
802.1X-enabled port based on its 802.1X access control method.

#### Port-based access control

The access device assigns or removes 802.1X
users to or from the critical microsegment on a port depending on user authentication
status, as shown in [Table 4](#_Ref66283914).

Table 4 Microsegment manipulation

| Authentication status | VSI manipulation |
| --- | --- |
| A user accesses the port and fails 802.1X authentication because all the RADIUS servers are unreachable. | The device assigns the port to the critical microsegment. The 802.1X user and all subsequent 802.1X users on this port can access only resources in the critical microsegment. || A user in the 802.1X critical microsegment fails authentication because all the RADIUS servers are unreachable. | The port is still in the critical microsegment, and all 802.1X users on this port are in the critical microsegment. || A user in the 802.1X critical microsegment fails authentication for any reason other than unreachable servers. | The device removes the port from the 802.1X critical microsegment. || A user in the 802.1X critical microsegment passes 802.1X authentication. | The device removes the port from the 802.1X critical microsegment and assigns the port to the authorization microsegment. If no authorization microsegment is assigned, the device does not add the port to any microsegment. |




‌

#### MAC-based access control

The access device assigns or removes an
802.1X user to or from the critical microsegment on a port depending on the
user's authentication status, as shown in [Table 5](#_Ref43379805).

Table 5 Microsegment manipulation

| Authentication status | Microsegment manipulation |
| --- | --- |
| A user fails 802.1X authentication because all the RADIUS servers are unreachable. | The access device assigns the user to the 802.1X critical microsegment.  The access device retains the user in the 802.1X critical microsegment if 802.1X reauthentication fails because none of the RADIUS servers is reachable. || A user in the 802.1X critical microsegment fails 802.1X for any reason other than server unreachable. | The access device removes the user from the 802.1X critical microsegment. || A user in the 802.1X critical microsegment passes 802.1X authentication. | The access device assigns the user to the authorization microsegment assigned by the authentication server. |



‌

## ACL assignment

You can specify an authorization ACL for an
802.1X user on a remote server or the access device to control the user's
access to network resources. After the user passes 802.1X authentication, the
server or access device assigns the authorization ACL to the user access port. Then,
the port permits or drops the matching traffic for the user depending on the
rules in the ACL. 

The device supports assignment of static
and dynamic authorization ACLs. 

·     Assignment of static authorization
ACLs—Static ACLs can be assigned by a RADIUS
server or the access device. When the server or access device assigns a static
ACL to a user, it assigns only the ACL number. You must manually create the ACL
and configure its rules on the access device.

To change the access permissions of a
user, you can use one of the following methods:

¡     Modify
ACL rules in the authorization ACL on the access device.

¡     Assign
another ACL to the user as the authorization ACL from the RADIUS server or the
access device.

Static ACLs and their rules can be
manually deleted from the access device.

·     Assignment of dynamic authorization
ACLs—Dynamic ACLs and their rules are
automatically deployed by a RADIUS server, which are not configurable on the
access device. Dynamic ACLs can only be named ACLs. After the device receives a
server-deployed dynamic ACL and its rules, it automatically creates the ACL and
configures its rules.

If the dynamic ACL assigned by the server
to a user has the same name as a static ACL, the dynamic ACL cannot be issued
and the user cannot come online.

A dynamic ACL and its rules are
automatically deleted from the access device after all its users go offline.

Dynamic ACLs and their rules cannot be
manually modified or deleted on the access device. To display information about
dynamic ACLs and their rules, use the display dot1x connection or display acl command.

‌

| IMPORTANT | IMPORTANT:  The supported authorization ACLs include the following types:  ·     Basic ACLs, which are numbered in the range of 2000 to 2999\.  ·     Advanced ACLs, which are numbered in the range of 3000 to 3999\.  ·     Layer 2 ACLs, which are numbered in the range of 4000 to 4999\.  ·     User-defined ACLs, which are numbered in the range of 5000 to 5999\.  For an authorization ACL to take effect, make sure the ACL exists with rules and none of the rules contains the counting, established, fragment, source-mac, or logging keyword.  For more information about ACLs, see ACL and QoS Command Reference. |
| --- | --- |

‌

‌

| IMPORTANT | IMPORTANT:  If the server assigns both an authorization ACL and microsegment to an 802.1X authentication user on a microsegmented network, only the authorization microsegment takes effect. This restriction applies to the S5560X-HI switch series and S6520X-HI switch series. |
| --- | --- |

‌

## User profile assignment

You can specify a user profile for an
802.1X user on the authentication server to control the user's access to
network resources. After the user passes 802.1X authentication, the
authentication server assigns the user profile to the user for filtering
traffic. 

The authentication server can be the local
access device or a RADIUS server. In either case, the server only specifies the
user profile name. You must configure the user profile on the access device.

To change the user's access permissions, use
one of the following methods:

·     Modify the user profile configuration on the
access device.

·     Specify another user profile for the user on the
authentication server.

For more information about user profiles,
see "Configuring user profiles."

## Redirect URL assignment

The device supports the URL attribute
assigned by a RADIUS server when the 802.1X-enabled port performs MAC-based
access control and the port authorization state is auto.
During authentication, the HTTP or HTTPS requests of an 802.1X user are redirected
to the Web interface specified by the server-assigned URL attribute. After the
user passes the Web authentication, the RADIUS server records the MAC address
of the user and uses a DM (Disconnect Message) to log off the user. When the
user initiates 802.1X authentication again, it will pass the authentication and
come online successfully.

This feature is mutually exclusive with the
EAD assistant feature.

By default, the device listens to port 6654
for HTTPS requests to be redirected. To change the redirect listening port
number, see configuring HTTP redirect in Layer 3—IP
Services Configuration Guide.

## CAR attribute assignment

The device can use the CAR attributes
assigned through RADIUS extended attributes to control the access rates of
authenticated online 802.1X users. For information about extended RADIUS
attributes, see "Configuring AAA."

The following CAR attributes are available:

·     Input-Peak-Rate—Peak rate of inbound traffic in bps.

·     Input-Average-Rate—Average rate of inbound traffic in bps.

·     Output-Peak-Rate—Peak rate of outbound traffic in bps.

·     Output-Average-Rate—Average rate of outbound traffic in bps.

If the server assigns CAR attributes for
controlling both the peak and average rates, the device implements double-rate
traffic policing on user traffic.If
the server does not assign the Input-Peak-Rate or Output-Peak-Rate attribute,
the device implements single-rate traffic policing on user traffic.For
more information about traffic policing, see QoS configuration in ACL and QoS Configuration Guide.

## 802.1X support for critical profiles

If all RADIUS servers in a RADIUS scheme
are not reachable for user authentication, users will be unable to get
authenticated to come online. To make sure users can access certain resources
in this situation, you can specify a critical profile for them on their access port.

For users in a VPN instance, the resources defined
for that VPN instance in a critical profile take precedence over the default
resources in the critical profile.

## Periodic 802.1X reauthentication

Periodic 802.1X reauthentication tracks the
connection status of online users and updates the authorization attributes (such
as ACL and VLAN) assigned by the server.

The device reauthenticates online 802.1X
users at the periodic reauthentication interval when the periodic online user
reauthentication feature is enabled. The interval is controlled by a timer and
the timer is user configurable. A change to the periodic reauthentication timer
applies to online users only after the old timer expires and the users pass
authentication.

The server-assigned session timeout timer
(Session-Timeout attribute) and termination action (Termination-Action attribute)
together can affect the periodic online user reauthentication feature. To
display the server-assigned Session-Timeout and Termination-Action attributes,
use the display dot1x connection command (see Security Command Reference).

·     If the termination action is Default (logoff), periodic online user reauthentication
on the device takes effect only when the periodic reauthentication timer is
shorter than the session timeout timer.

·     If the termination action is Radius-request, the periodic online user reauthentication
settings on the device do not take effect. The device reauthenticates the
online 802.1X users after the session timeout timer expires.

If no session timeout timer is assigned by
the server, whether the device performs periodic 802.1X reauthentication
depends on the periodic reauthentication configuration on the device. Support
for the assignment of Session-Timeout and Termination-Action attributes depends
on the server model.

With the RADIUS DAS feature enabled, the
device immediately reauthenticates a user upon receiving a CoA message that
carries the reauthentication attribute from a RADIUS authentication server. In
this case, reauthentication will be performed regardless of whether 802.1X
periodic reauthentication is enabled on the device. For more information about
RADIUS DAS configuration, see "Configuring AAA."

By default, the device logs off online
802.1X users if no server is reachable for 802.1X reauthentication. The
keep-online feature keeps authenticated 802.1X users online when no server is
reachable for 802.1X reauthentication.

The VLANs assigned to an online user before
and after reauthentication can be the same or different.

## EAD assistant

Endpoint Admission Defense (EAD) is an
integrated endpoint access control solution to improve the threat defensive
capability of a network. The solution enables the security client, security
policy server, access device, and third-party server to operate together. If a
terminal device seeks to access an EAD network, it must have an EAD client,
which performs 802.1X authentication.

The EAD assistant feature enables the
access device to redirect the HTTP or HTTPS requests of a user to a redirect
URL for downloading and installing an EAD client. This feature eliminates the administrative
task to deploy EAD clients. 

EAD assistant is implemented by the
following functionality:

·     Free IP.

A free IP is a freely accessible network
segment, which has a limited set of network resources such as software and DHCP
servers. To ensure security policy compliance, an unauthenticated user can
access only this segment to perform operations. For example, the user can
download EAD client from a software server or obtain a dynamic IP address from a
DHCP server.

·     Free microsegment.

A free microsegment is a freely
accessible microsegment, which has a limited set of network resources such as software
and DHCP servers. To ensure security policy compliance, an unauthenticated user
can access only this microsegment to perform operations. For example, the user
can download EAD client from a software server or obtain a dynamic IP address
from a DHCP server.

·     Redirect URL.

If an unauthenticated 802.1X user is
using a Web browser to access the network, EAD assistant redirects the network
access requests of the user to a specific URL. For example, you can use this
feature to redirect the user to the EAD client software download page.

The EAD assistant feature creates an ACL-based
EAD rule automatically to open access to the redirect URL for each redirected
user.

EAD rules are implemented by using ACL
resources. When the EAD rule timer expires or the user passes authentication,
the rule is removed. If users fail to download EAD client or fail to pass
authentication before the timer expires, they must reconnect to the network to
access the free IP or microsegment.

